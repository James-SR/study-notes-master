<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Study notes</title>
  <meta name="description" content="Study notes taken from courses and self learning.">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="Study notes" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://github.com/James-SR/study-notes-master" />
  
  <meta property="og:description" content="Study notes taken from courses and self learning." />
  <meta name="github-repo" content="James-SR/study-notes-master" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Study notes" />
  
  <meta name="twitter:description" content="Study notes taken from courses and self learning." />
  

<meta name="author" content="James Solomon-Rounce">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="references.html">
<link rel="next" href="joining-data-in-r-with-dplyr.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Study Notes</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="importing-data-part-1.html"><a href="importing-data-part-1.html"><i class="fa fa-check"></i><b>1</b> Importing data - Part 1</a><ul>
<li class="chapter" data-level="1.1" data-path="importing-data-part-1.html"><a href="importing-data-part-1.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="importing-data-part-1.html"><a href="importing-data-part-1.html#reading-csv-files"><i class="fa fa-check"></i><b>1.2</b> Reading CSV files</a></li>
<li class="chapter" data-level="1.3" data-path="importing-data-part-1.html"><a href="importing-data-part-1.html#reading-tab-deliminated-files-or-other-table-formats"><i class="fa fa-check"></i><b>1.3</b> Reading tab deliminated files or other table formats</a></li>
<li class="chapter" data-level="1.4" data-path="importing-data-part-1.html"><a href="importing-data-part-1.html#readr-and-data.table"><i class="fa fa-check"></i><b>1.4</b> Readr and data.table</a><ul>
<li class="chapter" data-level="1.4.1" data-path="importing-data-part-1.html"><a href="importing-data-part-1.html#data.table-fread"><i class="fa fa-check"></i><b>1.4.1</b> data.table fread</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="importing-data-part-1.html"><a href="importing-data-part-1.html#reading-excel-files"><i class="fa fa-check"></i><b>1.5</b> Reading Excel files</a><ul>
<li class="chapter" data-level="1.5.1" data-path="importing-data-part-1.html"><a href="importing-data-part-1.html#alternatives-for-importing-excel-files"><i class="fa fa-check"></i><b>1.5.1</b> Alternatives for importing Excel files</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="importing-data-part-1.html"><a href="importing-data-part-1.html#xlconnect---read-and-write-to-excel"><i class="fa fa-check"></i><b>1.6</b> XLConnect - read and write to excel</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="importing-data-part-2.html"><a href="importing-data-part-2.html"><i class="fa fa-check"></i><b>2</b> Importing data - Part 2</a><ul>
<li class="chapter" data-level="2.1" data-path="importing-data-part-2.html"><a href="importing-data-part-2.html#importing-from-databases---1"><i class="fa fa-check"></i><b>2.1</b> Importing from Databases - 1</a></li>
<li class="chapter" data-level="2.2" data-path="importing-data-part-2.html"><a href="importing-data-part-2.html#sql-queries-inside-r"><i class="fa fa-check"></i><b>2.2</b> SQL Queries Inside R</a></li>
<li class="chapter" data-level="2.3" data-path="importing-data-part-2.html"><a href="importing-data-part-2.html#web-data"><i class="fa fa-check"></i><b>2.3</b> Web Data</a></li>
<li class="chapter" data-level="2.4" data-path="importing-data-part-2.html"><a href="importing-data-part-2.html#json-and-apis"><i class="fa fa-check"></i><b>2.4</b> JSON and APIs</a></li>
<li class="chapter" data-level="2.5" data-path="importing-data-part-2.html"><a href="importing-data-part-2.html#importing-from-other-statistical-software"><i class="fa fa-check"></i><b>2.5</b> Importing from other statistical software</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="3" data-path="writing-functions-in-r.html"><a href="writing-functions-in-r.html"><i class="fa fa-check"></i><b>3</b> Writing Functions in R</a><ul>
<li class="chapter" data-level="3.1" data-path="writing-functions-in-r.html"><a href="writing-functions-in-r.html#function-overview"><i class="fa fa-check"></i><b>3.1</b> Function overview</a><ul>
<li class="chapter" data-level="3.1.1" data-path="writing-functions-in-r.html"><a href="writing-functions-in-r.html#scoping"><i class="fa fa-check"></i><b>3.1.1</b> Scoping</a></li>
<li class="chapter" data-level="3.1.2" data-path="writing-functions-in-r.html"><a href="writing-functions-in-r.html#data-structures"><i class="fa fa-check"></i><b>3.1.2</b> Data Structures</a></li>
<li class="chapter" data-level="3.1.3" data-path="writing-functions-in-r.html"><a href="writing-functions-in-r.html#for-loops"><i class="fa fa-check"></i><b>3.1.3</b> For loops</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="writing-functions-in-r.html"><a href="writing-functions-in-r.html#when-and-how-you-should-write-a-function"><i class="fa fa-check"></i><b>3.2</b> When and how you should write a function</a><ul>
<li class="chapter" data-level="3.2.1" data-path="writing-functions-in-r.html"><a href="writing-functions-in-r.html#rescale-example"><i class="fa fa-check"></i><b>3.2.1</b> Rescale example</a></li>
<li class="chapter" data-level="3.2.2" data-path="writing-functions-in-r.html"><a href="writing-functions-in-r.html#write-a-function-step-by-step"><i class="fa fa-check"></i><b>3.2.2</b> Write a function step by step</a></li>
<li class="chapter" data-level="3.2.3" data-path="writing-functions-in-r.html"><a href="writing-functions-in-r.html#how-can-you-write-a-good-function"><i class="fa fa-check"></i><b>3.2.3</b> How can you write a good function?</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="writing-functions-in-r.html"><a href="writing-functions-in-r.html#functional-programming"><i class="fa fa-check"></i><b>3.3</b> Functional Programming</a><ul>
<li class="chapter" data-level="3.3.1" data-path="writing-functions-in-r.html"><a href="writing-functions-in-r.html#using-purrr"><i class="fa fa-check"></i><b>3.3.1</b> Using purrr</a></li>
<li class="chapter" data-level="3.3.2" data-path="writing-functions-in-r.html"><a href="writing-functions-in-r.html#shortcuts"><i class="fa fa-check"></i><b>3.3.2</b> Shortcuts</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="writing-functions-in-r.html"><a href="writing-functions-in-r.html#advanced-inputs-and-outputs"><i class="fa fa-check"></i><b>3.4</b> Advanced Inputs and Outputs</a><ul>
<li class="chapter" data-level="3.4.1" data-path="writing-functions-in-r.html"><a href="writing-functions-in-r.html#maps-over-multiple-arguments"><i class="fa fa-check"></i><b>3.4.1</b> Maps over multiple arguments</a></li>
<li class="chapter" data-level="3.4.2" data-path="writing-functions-in-r.html"><a href="writing-functions-in-r.html#side-effect-functions"><i class="fa fa-check"></i><b>3.4.2</b> Side effect functions</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="writing-functions-in-r.html"><a href="writing-functions-in-r.html#robust-functions"><i class="fa fa-check"></i><b>3.5</b> Robust Functions</a><ul>
<li class="chapter" data-level="3.5.1" data-path="writing-functions-in-r.html"><a href="writing-functions-in-r.html#unstable-types"><i class="fa fa-check"></i><b>3.5.1</b> Unstable types</a></li>
<li class="chapter" data-level="3.5.2" data-path="writing-functions-in-r.html"><a href="writing-functions-in-r.html#non-standard-evaluation-nse"><i class="fa fa-check"></i><b>3.5.2</b> Non standard evaluation (NSE)</a></li>
<li class="chapter" data-level="3.5.3" data-path="writing-functions-in-r.html"><a href="writing-functions-in-r.html#hidden-arguments"><i class="fa fa-check"></i><b>3.5.3</b> Hidden arguments</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html"><i class="fa fa-check"></i><b>4</b> Joining Data in R with dplyr</a><ul>
<li class="chapter" data-level="4.1" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#mutating-joins"><i class="fa fa-check"></i><b>4.1</b> Mutating joins</a><ul>
<li class="chapter" data-level="4.1.1" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#keys"><i class="fa fa-check"></i><b>4.1.1</b> Keys</a></li>
<li class="chapter" data-level="4.1.2" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#left-and-right-joins"><i class="fa fa-check"></i><b>4.1.2</b> Left and right joins</a></li>
<li class="chapter" data-level="4.1.3" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#inner-and-full-joins"><i class="fa fa-check"></i><b>4.1.3</b> Inner and full joins</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#filtering-joins-and-set-operations"><i class="fa fa-check"></i><b>4.2</b> Filtering joins and set operations</a></li>
<li class="chapter" data-level="4.3" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#set-operations"><i class="fa fa-check"></i><b>4.3</b> Set Operations</a></li>
<li class="chapter" data-level="4.4" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#bind-in-dplyr"><i class="fa fa-check"></i><b>4.4</b> Bind in Dplyr</a><ul>
<li class="chapter" data-level="4.4.1" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#data-frames"><i class="fa fa-check"></i><b>4.4.1</b> Data frames</a></li>
<li class="chapter" data-level="4.4.2" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#data-types"><i class="fa fa-check"></i><b>4.4.2</b> Data Types</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#advanced-joining"><i class="fa fa-check"></i><b>4.5</b> Advanced Joining</a></li>
<li class="chapter" data-level="4.6" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#joining-mutiple-tables"><i class="fa fa-check"></i><b>4.6</b> Joining mutiple tables</a></li>
<li class="chapter" data-level="4.7" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#other-implentations"><i class="fa fa-check"></i><b>4.7</b> Other implentations</a></li>
<li class="chapter" data-level="4.8" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#case-study---lahman-db"><i class="fa fa-check"></i><b>4.8</b> Case Study - Lahman DB</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="cleaning-data.html"><a href="cleaning-data.html"><i class="fa fa-check"></i><b>5</b> Cleaning Data</a><ul>
<li class="chapter" data-level="5.1" data-path="cleaning-data.html"><a href="cleaning-data.html#tidying-data"><i class="fa fa-check"></i><b>5.1</b> Tidying data</a></li>
<li class="chapter" data-level="5.2" data-path="cleaning-data.html"><a href="cleaning-data.html#preparing-data-for-analysis"><i class="fa fa-check"></i><b>5.2</b> Preparing data for analysis</a></li>
<li class="chapter" data-level="5.3" data-path="cleaning-data.html"><a href="cleaning-data.html#string-manipulation"><i class="fa fa-check"></i><b>5.3</b> String manipulation</a></li>
<li class="chapter" data-level="5.4" data-path="cleaning-data.html"><a href="cleaning-data.html#missing-specials-and-outliers"><i class="fa fa-check"></i><b>5.4</b> Missing, Specials and Outliers</a></li>
<li class="chapter" data-level="5.5" data-path="cleaning-data.html"><a href="cleaning-data.html#examples"><i class="fa fa-check"></i><b>5.5</b> Examples</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="importing-cleaning-data-in-r-case-studies.html"><a href="importing-cleaning-data-in-r-case-studies.html"><i class="fa fa-check"></i><b>6</b> Importing &amp; Cleaning Data in R: Case Studies</a><ul>
<li class="chapter" data-level="6.1" data-path="importing-cleaning-data-in-r-case-studies.html"><a href="importing-cleaning-data-in-r-case-studies.html#ticket-sales-data"><i class="fa fa-check"></i><b>6.1</b> Ticket Sales Data</a><ul>
<li class="chapter" data-level="6.1.1" data-path="importing-cleaning-data-in-r-case-studies.html"><a href="importing-cleaning-data-in-r-case-studies.html#removing-redundant-info"><i class="fa fa-check"></i><b>6.1.1</b> Removing redundant info</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="importing-cleaning-data-in-r-case-studies.html"><a href="importing-cleaning-data-in-r-case-studies.html#working-with-dates"><i class="fa fa-check"></i><b>6.2</b> Working with dates</a></li>
<li class="chapter" data-level="6.3" data-path="importing-cleaning-data-in-r-case-studies.html"><a href="importing-cleaning-data-in-r-case-studies.html#mbta-ridership-data"><i class="fa fa-check"></i><b>6.3</b> MBTA Ridership Data</a></li>
<li class="chapter" data-level="6.4" data-path="importing-cleaning-data-in-r-case-studies.html"><a href="importing-cleaning-data-in-r-case-studies.html#world-food-facts"><i class="fa fa-check"></i><b>6.4</b> World Food Facts</a></li>
<li class="chapter" data-level="6.5" data-path="importing-cleaning-data-in-r-case-studies.html"><a href="importing-cleaning-data-in-r-case-studies.html#school-attendance-data"><i class="fa fa-check"></i><b>6.5</b> School Attendance Data</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-visualization.html"><a href="data-visualization.html"><i class="fa fa-check"></i><b>7</b> Data Visualization</a><ul>
<li class="chapter" data-level="7.1" data-path="data-visualization.html"><a href="data-visualization.html#base-r-graphics"><i class="fa fa-check"></i><b>7.1</b> Base R Graphics</a><ul>
<li class="chapter" data-level="7.1.1" data-path="data-visualization.html"><a href="data-visualization.html#avoiding-pie-charts"><i class="fa fa-check"></i><b>7.1.1</b> Avoiding pie charts</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="data-visualization.html"><a href="data-visualization.html#different-plot-types"><i class="fa fa-check"></i><b>7.2</b> Different Plot Types</a></li>
<li class="chapter" data-level="7.3" data-path="data-visualization.html"><a href="data-visualization.html#adding-details-to-plots"><i class="fa fa-check"></i><b>7.3</b> Adding details to plots</a></li>
<li class="chapter" data-level="7.4" data-path="data-visualization.html"><a href="data-visualization.html#adding-text"><i class="fa fa-check"></i><b>7.4</b> Adding text</a><ul>
<li class="chapter" data-level="7.4.1" data-path="data-visualization.html"><a href="data-visualization.html#adding-details-to-plots-1"><i class="fa fa-check"></i><b>7.4.1</b> Adding details to plots</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="data-visualization.html"><a href="data-visualization.html#how-much-is-too-much"><i class="fa fa-check"></i><b>7.5</b> How much is too much</a><ul>
<li class="chapter" data-level="7.5.1" data-path="data-visualization.html"><a href="data-visualization.html#mutiple-plots"><i class="fa fa-check"></i><b>7.5.1</b> Mutiple Plots</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="data-visualization.html"><a href="data-visualization.html#advanced-plot-customisation"><i class="fa fa-check"></i><b>7.6</b> Advanced Plot Customisation</a><ul>
<li class="chapter" data-level="7.6.1" data-path="data-visualization.html"><a href="data-visualization.html#using-colour-effectively"><i class="fa fa-check"></i><b>7.6.1</b> Using colour effectively</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="data-visualization.html"><a href="data-visualization.html#other-graphics-systems"><i class="fa fa-check"></i><b>7.7</b> Other graphics systems</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="intermediate-ggplot2.html"><a href="intermediate-ggplot2.html"><i class="fa fa-check"></i><b>8</b> Intermediate ggplot2</a><ul>
<li class="chapter" data-level="8.1" data-path="intermediate-ggplot2.html"><a href="intermediate-ggplot2.html#statistics"><i class="fa fa-check"></i><b>8.1</b> Statistics</a><ul>
<li class="chapter" data-level="8.1.1" data-path="intermediate-ggplot2.html"><a href="intermediate-ggplot2.html#stats-outside-geoms"><i class="fa fa-check"></i><b>8.1.1</b> Stats outside geoms</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="intermediate-ggplot2.html"><a href="intermediate-ggplot2.html#coordinates-layer"><i class="fa fa-check"></i><b>8.2</b> Coordinates Layer</a></li>
<li class="chapter" data-level="8.3" data-path="intermediate-ggplot2.html"><a href="intermediate-ggplot2.html#facets"><i class="fa fa-check"></i><b>8.3</b> Facets</a></li>
<li class="chapter" data-level="8.4" data-path="intermediate-ggplot2.html"><a href="intermediate-ggplot2.html#themes"><i class="fa fa-check"></i><b>8.4</b> Themes</a><ul>
<li class="chapter" data-level="8.4.1" data-path="intermediate-ggplot2.html"><a href="intermediate-ggplot2.html#recycling-themes"><i class="fa fa-check"></i><b>8.4.1</b> Recycling themes</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="intermediate-ggplot2.html"><a href="intermediate-ggplot2.html#best-practice"><i class="fa fa-check"></i><b>8.5</b> Best Practice</a><ul>
<li class="chapter" data-level="8.5.1" data-path="intermediate-ggplot2.html"><a href="intermediate-ggplot2.html#bar-plots"><i class="fa fa-check"></i><b>8.5.1</b> Bar Plots</a></li>
<li class="chapter" data-level="8.5.2" data-path="intermediate-ggplot2.html"><a href="intermediate-ggplot2.html#pie-charts"><i class="fa fa-check"></i><b>8.5.2</b> Pie Charts</a></li>
<li class="chapter" data-level="8.5.3" data-path="intermediate-ggplot2.html"><a href="intermediate-ggplot2.html#heat-maps"><i class="fa fa-check"></i><b>8.5.3</b> Heat Maps</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="intermediate-ggplot2.html"><a href="intermediate-ggplot2.html#case-study---descriptive-statistics"><i class="fa fa-check"></i><b>8.6</b> Case Study - Descriptive statistics</a><ul>
<li class="chapter" data-level="8.6.1" data-path="intermediate-ggplot2.html"><a href="intermediate-ggplot2.html#mosaic-plots"><i class="fa fa-check"></i><b>8.6.1</b> Mosaic Plots</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="advanced-ggplot2.html"><a href="advanced-ggplot2.html"><i class="fa fa-check"></i><b>9</b> Advanced ggplot2</a><ul>
<li class="chapter" data-level="9.1" data-path="advanced-ggplot2.html"><a href="advanced-ggplot2.html#refresher"><i class="fa fa-check"></i><b>9.1</b> Refresher</a></li>
<li class="chapter" data-level="9.2" data-path="advanced-ggplot2.html"><a href="advanced-ggplot2.html#statistical-plots"><i class="fa fa-check"></i><b>9.2</b> Statistical plots</a><ul>
<li class="chapter" data-level="9.2.1" data-path="advanced-ggplot2.html"><a href="advanced-ggplot2.html#box-plots"><i class="fa fa-check"></i><b>9.2.1</b> Box plots</a></li>
<li class="chapter" data-level="9.2.2" data-path="advanced-ggplot2.html"><a href="advanced-ggplot2.html#density-plots"><i class="fa fa-check"></i><b>9.2.2</b> Density Plots</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="advanced-ggplot2.html"><a href="advanced-ggplot2.html#multiple-groups-or-variables"><i class="fa fa-check"></i><b>9.3</b> Multiple groups or variables</a></li>
<li class="chapter" data-level="9.4" data-path="advanced-ggplot2.html"><a href="advanced-ggplot2.html#plots-for-specific-data-1"><i class="fa fa-check"></i><b>9.4</b> Plots for Specific Data 1</a><ul>
<li class="chapter" data-level="9.4.1" data-path="advanced-ggplot2.html"><a href="advanced-ggplot2.html#big-data"><i class="fa fa-check"></i><b>9.4.1</b> Big data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="introduction-to-data.html"><a href="introduction-to-data.html"><i class="fa fa-check"></i><b>10</b> Introduction to Data</a><ul>
<li class="chapter" data-level="10.1" data-path="introduction-to-data.html"><a href="introduction-to-data.html#language-of-data"><i class="fa fa-check"></i><b>10.1</b> Language of Data</a></li>
<li class="chapter" data-level="10.2" data-path="introduction-to-data.html"><a href="introduction-to-data.html#observational-studies-and-experiments"><i class="fa fa-check"></i><b>10.2</b> Observational Studies and Experiments</a></li>
<li class="chapter" data-level="10.3" data-path="introduction-to-data.html"><a href="introduction-to-data.html#sampling-strategies-and-experimental-design"><i class="fa fa-check"></i><b>10.3</b> Sampling strategies and experimental design</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="11" data-path="foundations-of-inference.html"><a href="foundations-of-inference.html"><i class="fa fa-check"></i><b>11</b> Foundations of Inference</a><ul>
<li class="chapter" data-level="11.1" data-path="foundations-of-inference.html"><a href="foundations-of-inference.html#introduction-to-inference"><i class="fa fa-check"></i><b>11.1</b> Introduction to Inference</a></li>
<li class="chapter" data-level="11.2" data-path="foundations-of-inference.html"><a href="foundations-of-inference.html#home-ownership-by-gender"><i class="fa fa-check"></i><b>11.2</b> Home Ownership by Gender</a></li>
<li class="chapter" data-level="11.3" data-path="foundations-of-inference.html"><a href="foundations-of-inference.html#density-plots-1"><i class="fa fa-check"></i><b>11.3</b> Density Plots</a></li>
<li class="chapter" data-level="11.4" data-path="foundations-of-inference.html"><a href="foundations-of-inference.html#gender-discrimination-p-values"><i class="fa fa-check"></i><b>11.4</b> Gender Discrimination (p-values)</a></li>
<li class="chapter" data-level="11.5" data-path="foundations-of-inference.html"><a href="foundations-of-inference.html#opportunity-cost"><i class="fa fa-check"></i><b>11.5</b> Opportunity Cost</a></li>
<li class="chapter" data-level="11.6" data-path="foundations-of-inference.html"><a href="foundations-of-inference.html#type-i-and-type-ii-errors"><i class="fa fa-check"></i><b>11.6</b> Type I and Type II errors</a></li>
<li class="chapter" data-level="11.7" data-path="foundations-of-inference.html"><a href="foundations-of-inference.html#bootstrapping"><i class="fa fa-check"></i><b>11.7</b> Bootstrapping</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-2.html"><a href="references-2.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="12" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>12</b> Exploratory Data Analysis</a><ul>
<li class="chapter" data-level="12.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#categorical-data"><i class="fa fa-check"></i><b>12.1</b> Categorical Data</a></li>
<li class="chapter" data-level="12.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#numerical-data"><i class="fa fa-check"></i><b>12.2</b> Numerical Data</a></li>
<li class="chapter" data-level="12.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#numerical-summaries"><i class="fa fa-check"></i><b>12.3</b> Numerical Summaries</a><ul>
<li class="chapter" data-level="12.3.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#transformations"><i class="fa fa-check"></i><b>12.3.1</b> Transformations</a></li>
<li class="chapter" data-level="12.3.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#outliers"><i class="fa fa-check"></i><b>12.3.2</b> Outliers</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#email-case-study"><i class="fa fa-check"></i><b>12.4</b> Email Case Study</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html"><i class="fa fa-check"></i><b>13</b> Correlation and Regression</a><ul>
<li class="chapter" data-level="13.1" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#visualizing-two-variables"><i class="fa fa-check"></i><b>13.1</b> Visualizing two variables</a><ul>
<li class="chapter" data-level="13.1.1" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#transformations-1"><i class="fa fa-check"></i><b>13.1.1</b> Transformations</a></li>
<li class="chapter" data-level="13.1.2" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#identifying-outliers"><i class="fa fa-check"></i><b>13.1.2</b> Identifying Outliers</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#correlation"><i class="fa fa-check"></i><b>13.2</b> Correlation</a><ul>
<li class="chapter" data-level="13.2.1" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#anscombe-dataset"><i class="fa fa-check"></i><b>13.2.1</b> Anscombe Dataset</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#linear-regression"><i class="fa fa-check"></i><b>13.3</b> Linear Regression</a><ul>
<li class="chapter" data-level="13.3.1" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#regression-to-the-mean"><i class="fa fa-check"></i><b>13.3.1</b> Regression to the Mean</a></li>
<li class="chapter" data-level="13.3.2" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#fitting-linear-models"><i class="fa fa-check"></i><b>13.3.2</b> Fitting linear models</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#model-fit"><i class="fa fa-check"></i><b>13.4</b> Model fit</a><ul>
<li class="chapter" data-level="13.4.1" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#unusual-points"><i class="fa fa-check"></i><b>13.4.1</b> Unusual points</a></li>
<li class="chapter" data-level="13.4.2" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#high-leverage-points"><i class="fa fa-check"></i><b>13.4.2</b> High leverage Points</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="supervised-learning.html"><a href="supervised-learning.html"><i class="fa fa-check"></i><b>14</b> Supervised Learning</a><ul>
<li class="chapter" data-level="14.1" data-path="supervised-learning.html"><a href="supervised-learning.html#tree-based-models"><i class="fa fa-check"></i><b>14.1</b> Tree Based Models</a><ul>
<li class="chapter" data-level="14.1.1" data-path="supervised-learning.html"><a href="supervised-learning.html#random-forests"><i class="fa fa-check"></i><b>14.1.1</b> Random Forests</a></li>
<li class="chapter" data-level="14.1.2" data-path="supervised-learning.html"><a href="supervised-learning.html#one-hot-encoding-categorical-variables"><i class="fa fa-check"></i><b>14.1.2</b> One-Hot-Encoding Categorical Variables</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="supervised-learning.html"><a href="supervised-learning.html#gradient-boosting-machines"><i class="fa fa-check"></i><b>14.2</b> Gradient Boosting Machines</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="dimensional-modelling.html"><a href="dimensional-modelling.html"><i class="fa fa-check"></i><b>15</b> Dimensional Modelling</a><ul>
<li class="chapter" data-level="15.1" data-path="dimensional-modelling.html"><a href="dimensional-modelling.html#introduction-to-dimensional-data"><i class="fa fa-check"></i><b>15.1</b> Introduction to Dimensional Data</a><ul>
<li class="chapter" data-level="15.1.1" data-path="dimensional-modelling.html"><a href="dimensional-modelling.html#data-modelling-levels"><i class="fa fa-check"></i><b>15.1.1</b> Data Modelling levels</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="dimensional-modelling.html"><a href="dimensional-modelling.html#architecture-considerations"><i class="fa fa-check"></i><b>15.2</b> Architecture considerations</a></li>
<li class="chapter" data-level="15.3" data-path="dimensional-modelling.html"><a href="dimensional-modelling.html#graphical-representations"><i class="fa fa-check"></i><b>15.3</b> Graphical Representations</a></li>
<li class="chapter" data-level="15.4" data-path="dimensional-modelling.html"><a href="dimensional-modelling.html#kimball-approach"><i class="fa fa-check"></i><b>15.4</b> Kimball Approach</a></li>
<li class="chapter" data-level="15.5" data-path="dimensional-modelling.html"><a href="dimensional-modelling.html#four-step-dimensional-design-process"><i class="fa fa-check"></i><b>15.5</b> Four-Step Dimensional Design Process</a></li>
<li class="chapter" data-level="15.6" data-path="dimensional-modelling.html"><a href="dimensional-modelling.html#tips"><i class="fa fa-check"></i><b>15.6</b> Tips</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-3.html"><a href="references-3.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Study notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="writing-functions-in-r" class="section level1">
<h1><span class="header-section-number">3</span> Writing Functions in R</h1>
<hr />
<p>Notes taken during/inspired by the Datacamp course ‘Writing Functions in R’ by Hadley and Charlotte Wickham.</p>
<p>R can create functions using a basic ‘receipe’ as Hadley calls it</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_fun &lt;-<span class="st"> </span><span class="cf">function</span>(arg1, arg2) {
   body
}</code></pre></div>
<blockquote>

</blockquote>
<p>Unlike in other languages, there is no special syntax for naming a function. Once created, there is no difference between the functions you create and the functions created by other developers such as those in base R.</p>
<p>Every function has three components</p>
<ul>
<li>The formal arguments</li>
<li>The body of the function</li>
<li>The environment - usually invisible but determines where the function looks for variables</li>
</ul>
<p>The environemnt is where the function was defined, if just coding the function in this will be the global environment.</p>
<p>The output from a function is usually the last expression evaluated. However, it is possible to use a return statement to return(value) which will stop the function at that point. It is possible to have functions without a name, so called ‘anonymous’ functions, which are covered later in this chapter. Anonymous functions can be called, but have to be done on the same line.</p>
<p>Course slides: * <a href="https://s3.amazonaws.com/assets.datacamp.com/production/course_1008/slides/ch1_pdf_slides_v2.pdf">Part 1 - Refresher</a> * <a href="https://s3.amazonaws.com/assets.datacamp.com/production/course_1008/slides/ch2_pdf_slides.pdf">Part 2 - When and how you should write a function</a> * <a href="https://s3.amazonaws.com/assets.datacamp.com/production/course_1008/slides/ch3_pdf_slides.pdf">Part 3 - Functional programming</a> * <a href="https://s3.amazonaws.com/assets.datacamp.com/production/course_1008/slides/ch4_pdf_slides.pdf">Part 4 - Advanced inputs and outputs</a> * <a href="https://s3.amazonaws.com/assets.datacamp.com/production/course_1008/slides/ch5_pdf_slides.pdf">Part 5 - Robust functions</a></p>
<p>Other useful info:</p>
<ul>
<li><a href="http://rpubs.com/hadley/157957">Hadley’s Non-standard evaluation functions vignette</a></li>
</ul>
<div id="function-overview" class="section level2">
<h2><span class="header-section-number">3.1</span> Function overview</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Define ratio() function</span>
ratio &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {
  x <span class="op">/</span><span class="st"> </span>y
}

<span class="co"># Call ratio() with arguments 3 and 4</span>
<span class="kw">ratio</span>(<span class="dv">3</span>, <span class="dv">4</span>)</code></pre></div>
<pre><code>## [1] 0.75</code></pre>
<p>There are two ways to specify the arguments - ratio(3, 4), which relies on matching by position, or ratio(x = 3, y = 4), which relies on matching by name.</p>
<p>For functions you and others use often, it’s okay to use positional matching for the first one or two arguments. These are usually the data to be computed on. Good examples are the x argument to the summary functions (mean(), sd(), etc.) and the x and y arguments to plotting functions.</p>
<p>However, beyond the first couple of arguments you should always use matching by name. It makes your code much easier for you and others to read. This is particularly important if the argument is optional, because it has a default. When overriding a default value, it’s good practice to use the name.</p>
<p>Notice that when you call a function, you should place a space around = in function calls, and always put a space after a comma, not before (just like in regular English). Using whitespace makes it easier to skim the function for the important components.</p>
<p>In the follwing example we tidy up the function to follow best practice and make it easier to understand and repeat if needed in the future.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Original</span>
<span class="kw">mean</span>(<span class="fl">0.1</span>,<span class="dt">x=</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>, <span class="ot">NA</span>),<span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Rewrite the call to follow best practices</span>
<span class="kw">mean</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>, <span class="ot">NA</span>), <span class="dt">trim =</span> <span class="fl">0.1</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] 5</code></pre>
<div id="scoping" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Scoping</h3>
<p>Scoping describes how R looks up values when given a name. When creating a function, R will look within that function first for a name e.g. x. If it doesn’t exist in that environment, it will look one level up, so if you’ve defined x but not y in a function, R will look for y in the next environment up - if within a single function, this next level up will be the gobal environment. Every time you cann a function, it will get a ‘clean’ environment.</p>
</div>
<div id="data-structures" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Data Structures</h3>
<p>There are two main typers of data structure in R - atomic vectors and lists (which are multiple vectors). Lists are useful because they can be used to have different data ypes within them, they have nested vectors in effect. Lists can be referenced either with a single brackedt [], a double braket [[]] which will strip out a level of hierachy or the usual dollar notation $.</p>
<div class="figure">
<img src="images/ListSubsetting.png" alt="Subsetting List flavours"  />
<p class="caption">
(#fig:Subsetting Lists)Subsetting List flavours
</p>
</div>
<p>There are a few ways to subset a list. Throughout the course we’ll mostly use double bracket ([[]]) subsetting by index and by name.</p>
<p>That is, my_list[[1]] extracts the first element of the list my_list, and my_list[[“name”]] extracts the element in my_list that is called name. If the list is nested you can travel down the heirarchy by recursive subsetting. For example, mylist[[1]][[“name”]] is the element called name inside the first element of my_list.</p>
<p>A data frame is just a special kind of list, so you can use double bracket subsetting on data frames too. my_df[[1]] will extract the first column of a data frame and my_df[[“name”]] will extract the column named name from the data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 2nd element in tricky_list</span>
<span class="kw">typeof</span>(tricky_list[[<span class="dv">2</span>]])

<span class="co"># Element called x in tricky_list</span>
<span class="kw">typeof</span>(tricky_list[[<span class="st">&quot;x&quot;</span>]])

<span class="co"># 2nd element inside the element called x in tricky_list</span>
<span class="kw">typeof</span>(tricky_list[[<span class="st">&quot;x&quot;</span>]][[<span class="dv">2</span>]])</code></pre></div>
<p>Sometimes the output of models can be quite challenging to get out, with many lists inside a single list.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Guess where the regression model is stored</span>
<span class="kw">names</span>(tricky_list)

<span class="co"># Use names() and str() on the model element</span>
<span class="kw">names</span>(tricky_list[[<span class="st">&quot;model&quot;</span>]])
<span class="kw">str</span>(tricky_list[[<span class="st">&quot;model&quot;</span>]])

<span class="co"># Subset the coefficients element</span>
tricky_list[[<span class="st">&quot;model&quot;</span>]][[<span class="st">&quot;coefficients&quot;</span>]]

<span class="co"># Subset the wt element</span>
tricky_list[[<span class="st">&quot;model&quot;</span>]][[<span class="st">&quot;coefficients&quot;</span>]][[<span class="st">&quot;wt&quot;</span>]]</code></pre></div>
</div>
<div id="for-loops" class="section level3">
<h3><span class="header-section-number">3.1.3</span> For loops</h3>
<p>For loops are used for iteraction. There are a number of parts within a loop:</p>
<ul>
<li><strong>1</strong>: The sequence - describes the name of an object with indexes an iteration e.g. i, and the values that this index should iterate over</li>
<li><strong>2</strong>: The body - between the curly braces {} and describes the operations to iterate over, referring back to the index (e.g. i)</li>
<li><strong>3</strong>: The output - where should the results of the loop go? OFten this might print to the screen rather than saving the output</li>
</ul>
<p>If you want to repeat a function for each column where the data frame is empty, rather than use the sequence for (i in 1:ncol(df)), it is better to use seq_along(df), since our sequence is now the somewhat non-sensical: 1, 0. You might think you wouldn’t be silly enough to use a for loop with an empty data frame, but once you start writing your own functions, there’s no telling what the input will be.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>()
<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(df)

<span class="co"># doesn&#39;t handle the empty data well</span>
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(df)) {
  <span class="kw">print</span>(<span class="kw">median</span>(df[[i]]))
}

<span class="co"># Replace the 1:ncol(df) sequence</span>
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df)) {
  <span class="kw">print</span>(<span class="kw">median</span>(df[[i]]))
}</code></pre></div>
<p>Our for loop does a good job displaying the column medians, but we might want to store these medians in a vector for future use.</p>
<p>Before you start the loop, you must always allocate sufficient space for the output, let’s say an object called output. This is very important for efficiency: if you grow the for loop at each iteration (e.g. using c()), your for loop will be very slow.</p>
<p>A general way of creating an empty vector of given length is the vector() function. It has two arguments: the type of the vector (“logical”, “integer”, “double”, “character”, etc.) and the length of the vector.</p>
<p>Then, at each iteration of the loop you must store the output in the corresponding entry of the output vector, i.e. assign the result to output[[i]]. (You might ask why we are using double brackets here when output is a vector. It’s primarily for generalizability: this subsetting will work whether output is a vector or a list.)</p>
<p>Let’s edit our loop to store the medians, rather than printing them to the console.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create new double vector: output</span>
output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">ncol</span>(df))

<span class="co"># Alter the loop</span>
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df)) {
  <span class="co"># Change code to store result in output</span>
  output[i] &lt;-<span class="st"> </span><span class="kw">median</span>(df[[i]])
}

<span class="co"># Print output</span>
output</code></pre></div>
</div>
</div>
<div id="when-and-how-you-should-write-a-function" class="section level2">
<h2><span class="header-section-number">3.2</span> When and how you should write a function</h2>
<p>Why might you write a function? Doing the same thing many times is not efficient and it can lead to errors - you copy the same function/formula from a previous exercise, but forget to change a variable name to fit your new instance.</p>
<blockquote>
<p>If you have copied and pasted twice, meaning you now have three copies, it is time to write a function</p>
</blockquote>
<p>As it takes less effort to check the intent of the code - there is just one function to check - more time can be spent on checking the validity or quality of the data and outputs. In addition, since we have created a function, we can use other packages such as the map function in purrr, to repeat (map) our functions repeatadly.</p>
<div id="rescale-example" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Rescale example</h3>
<p>We have a snippet of code that successfully rescales a column to be between 0 and 1:</p>
<p>(df<span class="math inline">\(a - min(df\)</span>a, na.rm = TRUE)) /<br />
(max(df<span class="math inline">\(a, na.rm = TRUE) - min(df\)</span>a, na.rm = TRUE))</p>
<p>Our goal over the next few exercises is to turn this snippet, written to work on the a column in the data frame df, into a general purpose rescale01() function that we can apply to any vector.</p>
<p>The first step of turning a snippet into a function is to examine the snippet and decide how many inputs there are, then rewrite the snippet to refer to these inputs using temporary names. These inputs will become the arguments to our function, so choosing good names for them is important. (We’ll talk more about naming arguments in a later exercise.)</p>
<p>In this snippet, there is one input: the numeric vector to be rescaled (currently df$a). What would be a good name for this input? It’s quite common in R to refer to a vector of data simply as x (like in the mean function), so we will follow that convention here.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Define example vector x</span>
x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)

<span class="co"># Rewrite this snippet to refer to x</span>
(x <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">/</span>
<span class="st">  </span>(<span class="kw">max</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>##  [1] 0.0000000 0.1111111 0.2222222 0.3333333 0.4444444 0.5555556 0.6666667
##  [8] 0.7777778 0.8888889 1.0000000</code></pre>
<p>Our next step is to examine our snippet and see if we can write it more clearly.</p>
<p>Take a close look at our rewritten snippet. Do you see any duplication?</p>
<p>(x - min(x, na.rm = TRUE)) / (max(x, na.rm = TRUE) - min(x, na.rm = TRUE))</p>
<p>One obviously duplicated statement is min(x, na.rm = TRUE). It makes more sense for us just to calculate it once, store the result, and then refer to it when needed. In fact, since we also need the maximum value of x, it would be even better to calculate the range once, then refer to the first and second elements when they are needed.</p>
<p>What should we call this intermediate variable? You’ll soon get the message that using good names is an important part of writing clear code! I suggest we call it rng (for “range”).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Define example vector x</span>
x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>

<span class="co"># Define rng</span>
rng &lt;-<span class="st"> </span><span class="kw">range</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)

<span class="co"># Rewrite this snippet to refer to the elements of rng</span>
(x <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>]) <span class="op">/</span>
<span class="st">  </span>(rng[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>])</code></pre></div>
<pre><code>##  [1] 0.0000000 0.1111111 0.2222222 0.3333333 0.4444444 0.5555556 0.6666667
##  [8] 0.7777778 0.8888889 1.0000000</code></pre>
<p>What do you need to write a function? You need a name for the function, you need to know the arguments to the function, and you need code that forms the body of the function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Define example vector x</span>
x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span> 

<span class="co"># Use the function template to create the rescale01 function</span>
rescale01 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="co"># body</span>
  rng &lt;-<span class="st"> </span><span class="kw">range</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) 
  (x <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>]) <span class="op">/</span><span class="st"> </span>(rng[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>])
}

<span class="co"># Test your function, call rescale01 using the vector x as the argument</span>
<span class="kw">rescale01</span>(x)</code></pre></div>
<pre><code>##  [1] 0.0000000 0.1111111 0.2222222 0.3333333 0.4444444 0.5555556 0.6666667
##  [8] 0.7777778 0.8888889 1.0000000</code></pre>
</div>
<div id="write-a-function-step-by-step" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Write a function step by step</h3>
<p>Typically we go through a similar process in order to write a function:</p>
<ol style="list-style-type: decimal">
<li>Start with a simiple problem</li>
<li>Get a working snippet of code</li>
<li>Rewrite the code to use temporary variables</li>
<li>See if there is any duplication that we can minimise and rewrite to remove this</li>
<li>With this clearly working version, we can turn it in to a function, by wrapping the code in a function</li>
</ol>
<p>In this next section we are going to go through these steps in order to write a function - both_na() - that counts at how many positions two vectors, x and y, both have a missing value.</p>
<p>So first, we start writing some simple code to see how we get something workable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Define example vectors x and y</span>
x &lt;-<span class="st"> </span><span class="kw">c</span>( <span class="dv">1</span>, <span class="dv">2</span>, <span class="ot">NA</span>, <span class="dv">3</span>, <span class="ot">NA</span>)
y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">NA</span>, <span class="dv">3</span>, <span class="ot">NA</span>, <span class="dv">3</span>,  <span class="dv">4</span>)

<span class="co"># Count how many elements are missing in both x and y</span>
<span class="kw">sum</span>(<span class="kw">is.na</span>(x) <span class="op">&amp;</span><span class="st"> </span><span class="kw">is.na</span>(y))</code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>So the function appears to be doing what we want, the function is already quite simple so we don’t need to simplify further, so we proceed to wrap the function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Turn this snippet into a function: both_na()</span>
both_na &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {
  <span class="kw">sum</span>(<span class="kw">is.na</span>(x) <span class="op">&amp;</span><span class="st"> </span><span class="kw">is.na</span>(y))
}</code></pre></div>
<p>Now we can test whether the function operates as intended by using some other examples.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Define x, y1 and y2</span>
x &lt;-<span class="st">  </span><span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>)
y1 &lt;-<span class="st"> </span><span class="kw">c</span>( <span class="dv">1</span>, <span class="ot">NA</span>, <span class="ot">NA</span>)
y2 &lt;-<span class="st"> </span><span class="kw">c</span>( <span class="dv">1</span>, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>)


<span class="co"># Call both_na on x, y1</span>
<span class="kw">both_na</span>(x, y1)</code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Call both_na on x, y2</span>
<span class="kw">both_na</span>(x, y2)</code></pre></div>
<pre><code>## Warning in is.na(x) &amp; is.na(y): longer object length is not a multiple of
## shorter object length</code></pre>
<pre><code>## [1] 3</code></pre>
</div>
<div id="how-can-you-write-a-good-function" class="section level3">
<h3><span class="header-section-number">3.2.3</span> How can you write a good function?</h3>
<p>It should have the following criteria fulfilled</p>
<ul>
<li>It should be correct</li>
<li>It should be understandable to other people</li>
<li>Correct + understandable = obvioulsy correct</li>
</ul>
<p>Good names can help make the data more understandable. Good naming applies to all aspects in R - objects, functions or arguments. Some examples are below, it doesn’t matter which convention you follow although it is important to stick to the approach i.e. be consistent.</p>
<ul>
<li>Long names - these should be lower case and seperated with underscores e.g. row_maxes</li>
<li>Other names - don’t override existing variables or functions e.g. T &lt;- FALSE or c &lt;- 10</li>
<li>Function names - use a verb as a name, since the function does something</li>
<li>Argument names - use nouns or naming words</li>
<li>Argument length - use short names when appropriate e.g. x,y or z</li>
<li>Data frames - usually referred to as df</li>
<li>Numeric indices - use i and j typically rows and columns</li>
<li>Others - n for the number of rows, p for the number of columns</li>
<li>Argument order - usually we placed data objects first, like x or df, then things that control the computation next (detail) which should be given default values</li>
</ul>
<p>Also think about having an <a href="http://adv-r.had.co.nz/Style.html">R style guide</a>.</p>
</div>
</div>
<div id="functional-programming" class="section level2">
<h2><span class="header-section-number">3.3</span> Functional Programming</h2>
<p>Writing for loops in R is not best practice. They are like detailed recipe books which outline very detailed step in a recipe, they don’t rely on any pre-existing knowledge so as a consequence, become very long. This can make it hard to understand and see differences and similarities between different recipes (for loops). For loops tend to relegate the verbs by hiding them in a sea of nouns. Using functional programming allows you to create ‘meta recipes’ which helps to identify what is different and what is the same, by simplifying some of the steps.</p>
<p>In the following example we will create a data frame, then try to calculate a median for each column. This could be achieved by repeating median(df[[p]]) for each column p in the df, but it would be a lot of repetition. The following shows how you would use a for loop</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create the dataframe</span>
df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">a =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">b =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">c =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">d =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>)
)

<span class="co"># Initialize output vector</span>
output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">ncol</span>(df))  

<span class="co"># Fill in the body of the for loop</span>
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df)) {            
  output[i] &lt;-<span class="st"> </span><span class="kw">median</span>(df[[i]])
}

<span class="co"># View the result</span>
output</code></pre></div>
<pre><code>## [1]  0.30104359  0.07076497 -0.58144482 -0.04331344</code></pre>
<p>Now if we had two more data frames, df2 and df3 we would have something similar to the following</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create the dataframe2</span>
df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">a =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">b =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">c =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">d =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>)
)

<span class="co"># Create the dataframe3</span>
df3 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">a =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">b =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">c =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">d =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>)
)

output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">ncol</span>(df2))  
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df2)) {            
  output[[i]] &lt;-<span class="st"> </span><span class="kw">median</span>(df2[[i]])      
}
output</code></pre></div>
<pre><code>## [1] -0.0641349  0.2422641 -0.2854498 -0.2563127</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">ncol</span>(df3))  
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df3)) {            
  output[[i]] &lt;-<span class="st"> </span><span class="kw">median</span>(df3[[i]])      
}
output</code></pre></div>
<pre><code>## [1]  0.4657658  0.1358885 -0.2084402 -0.1577409</code></pre>
<p>It would be easier to write a function in this instance.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Turn this code into col_median()</span>
col_median &lt;-<span class="st"> </span><span class="cf">function</span>(df) {
  output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">ncol</span>(df))
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df)) {            
    output[[i]] &lt;-<span class="st"> </span><span class="kw">median</span>(df[[i]])      
  }
  output
}

<span class="kw">col_median</span>(df2)</code></pre></div>
<pre><code>## [1] -0.0641349  0.2422641 -0.2854498 -0.2563127</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">col_median</span>(df3)</code></pre></div>
<pre><code>## [1]  0.4657658  0.1358885 -0.2084402 -0.1577409</code></pre>
<p>And if we wanted means instead of medians we could write a similar function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create col_mean() function to find column means</span>
col_mean &lt;-<span class="st"> </span><span class="cf">function</span>(df) {
  output &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">length</span>(df))
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df)) {
    output[[i]] &lt;-<span class="st"> </span><span class="kw">mean</span>(df[[i]])
  }
  output
}
<span class="kw">col_mean</span>(df2)</code></pre></div>
<pre><code>## [1]  0.1970742  0.1477954 -0.1617852 -0.1566563</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">col_mean</span>(df3)</code></pre></div>
<pre><code>## [1] 0.45339778 0.34380317 0.12075255 0.06709137</code></pre>
<p>And if we wanted standard deviations</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Define col_sd() function</span>
col_sd &lt;-<span class="st"> </span><span class="cf">function</span>(df) {
  output &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">length</span>(df))
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df)) {
    output[[i]] &lt;-<span class="st"> </span><span class="kw">sd</span>(df[[i]])
  }
  output
}
<span class="kw">col_sd</span>(df2)</code></pre></div>
<pre><code>## [1] 1.0386878 0.6958183 1.3089331 0.8902624</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">col_sd</span>(df3)</code></pre></div>
<pre><code>## [1] 1.1144186 1.3909175 1.2245477 0.8780557</code></pre>
<p>We have now copied our median function twice - to create mean and sd functions. It would be writter to write a function which will take column summaries for any summary function we provide.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f &lt;-<span class="st"> </span><span class="cf">function</span>(x, power) {
    <span class="co"># Edit the body to return absolute deviations raised to power</span>
    <span class="kw">abs</span>(x <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(x)) <span class="op">^</span><span class="st"> </span>power
}</code></pre></div>
<p>We can also use functions as arguments, by replacing the mean or median elements with fun, where fun = the summary function desired.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">col_summary &lt;-<span class="st"> </span><span class="cf">function</span>(df, fun) {
  output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="kw">length</span>(df))
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df)) {
    output[[i]] &lt;-<span class="st"> </span><span class="kw">fun</span>(df[[i]])
  }
  output
}</code></pre></div>
<div id="using-purrr" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Using purrr</h3>
<p>Passing functions as arguments is quite a common task in R, we can use the map function in purrr to achieve this. Every function in the purrr package takes a vector to begin with (.x) and loops over it to do something (.f) e.g. map_dbl(.x, .f, …). The types of map functions are:</p>
<ul>
<li>map() returns a list</li>
<li>map_dbl() returns a double vector</li>
<li>map_lgl() returns a logical vector</li>
<li>map_int() returns a integer vector</li>
<li>map_chr() returns a character vector</li>
</ul>
<p>Arguments to map() are .x and .f and not x and f because .x and .f are very unlikely to be argument names you might pass through the …, thereby preventing confusion about whether an argument belongs to map() or to the function being mapped.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load the package and examine the data</span>
<span class="kw">library</span>(purrr)
<span class="kw">library</span>(nycflights13)</code></pre></div>
<pre><code>## Warning: package &#39;nycflights13&#39; was built under R version 3.4.2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr) <span class="co"># to select just the numeric columns of our dataset </span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(planes)</code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    3322 obs. of  9 variables:
##  $ tailnum     : chr  &quot;N10156&quot; &quot;N102UW&quot; &quot;N103US&quot; &quot;N104UW&quot; ...
##  $ year        : int  2004 1998 1999 1999 2002 1999 1999 1999 1999 1999 ...
##  $ type        : chr  &quot;Fixed wing multi engine&quot; &quot;Fixed wing multi engine&quot; &quot;Fixed wing multi engine&quot; &quot;Fixed wing multi engine&quot; ...
##  $ manufacturer: chr  &quot;EMBRAER&quot; &quot;AIRBUS INDUSTRIE&quot; &quot;AIRBUS INDUSTRIE&quot; &quot;AIRBUS INDUSTRIE&quot; ...
##  $ model       : chr  &quot;EMB-145XR&quot; &quot;A320-214&quot; &quot;A320-214&quot; &quot;A320-214&quot; ...
##  $ engines     : int  2 2 2 2 2 2 2 2 2 2 ...
##  $ seats       : int  55 182 182 182 55 182 182 182 182 182 ...
##  $ speed       : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ engine      : chr  &quot;Turbo-fan&quot; &quot;Turbo-fan&quot; &quot;Turbo-fan&quot; &quot;Turbo-fan&quot; ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">planes2 &lt;-<span class="st"> </span><span class="kw">select_if</span>(planes, is.numeric)

<span class="co"># Find the mean of each column</span>
<span class="kw">map_dbl</span>(planes2, mean)</code></pre></div>
<pre><code>##       year    engines      seats      speed 
##         NA   1.995184 154.316376         NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Find the mean of each column, excluding missing values</span>
<span class="kw">map_dbl</span>(planes2, mean, <span class="dt">na.rm =</span> T)</code></pre></div>
<pre><code>##        year     engines       seats       speed 
## 2000.484010    1.995184  154.316376  236.782609</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Find the 5th percentile of each column, excluding missing values</span>
<span class="kw">map_dbl</span>(planes2, quantile, <span class="dt">probs =</span> .<span class="dv">05</span>, <span class="dt">na.rm =</span> T)</code></pre></div>
<pre><code>##    year engines   seats   speed 
##  1988.0     2.0    55.0    90.5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Find the columns that are numeric</span>
<span class="kw">map_lgl</span>(df3, is.numeric)</code></pre></div>
<pre><code>##    a    b    c    d 
## TRUE TRUE TRUE TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Find the type of each column</span>
<span class="kw">map_chr</span>(df3, typeof)</code></pre></div>
<pre><code>##        a        b        c        d 
## &quot;double&quot; &quot;double&quot; &quot;double&quot; &quot;double&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Find a summary of each column</span>
<span class="kw">map</span>(df3, summary)</code></pre></div>
<pre><code>## $a
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## -1.3180 -0.3523  0.4658  0.4534  1.4880  1.9203 
## 
## $b
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## -1.2480 -0.5321  0.1359  0.3438  0.7812  3.5138 
## 
## $c
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## -1.7018 -0.4845 -0.2084  0.1208  0.4456  2.7308 
## 
## $d
##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## -0.84672 -0.56942 -0.15774  0.06709  0.57799  1.87096</code></pre>
</div>
<div id="shortcuts" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Shortcuts</h3>
<p>You can define an anonymous function on the fly like</p>
<blockquote>
<p>map(df, function(x) sum(is.na(x)))</p>
</blockquote>
<p>Which will count how many missing values are in x. This allows you to create and map your own functions.</p>
<p>In the next set of exercises we will use the mtcars data, but split the dataset in to a set for each number of cylinders in the engine e.g. 4, 6 and 8 cylinders.</p>
<p>Our goal is to fit a separate linear regression of miles per gallon (mpg) against weight (wt) for each group of cars in our list of data frames, where each data frame in our list represents a different group. How should we get started?</p>
<p>First, let’s confirm the structure of this list of data frames. Then, we’ll solve a simpler problem first: fit the regression to the first group of cars.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Split the data</span>
cyl &lt;-<span class="st"> </span><span class="kw">split</span>(mtcars, mtcars<span class="op">$</span>cyl)

<span class="co"># Examine the structure of cyl</span>
<span class="kw">str</span>(cyl)</code></pre></div>
<pre><code>## List of 3
##  $ 4:&#39;data.frame&#39;:   11 obs. of  11 variables:
##   ..$ mpg : num [1:11] 22.8 24.4 22.8 32.4 30.4 33.9 21.5 27.3 26 30.4 ...
##   ..$ cyl : num [1:11] 4 4 4 4 4 4 4 4 4 4 ...
##   ..$ disp: num [1:11] 108 146.7 140.8 78.7 75.7 ...
##   ..$ hp  : num [1:11] 93 62 95 66 52 65 97 66 91 113 ...
##   ..$ drat: num [1:11] 3.85 3.69 3.92 4.08 4.93 4.22 3.7 4.08 4.43 3.77 ...
##   ..$ wt  : num [1:11] 2.32 3.19 3.15 2.2 1.61 ...
##   ..$ qsec: num [1:11] 18.6 20 22.9 19.5 18.5 ...
##   ..$ vs  : num [1:11] 1 1 1 1 1 1 1 1 0 1 ...
##   ..$ am  : num [1:11] 1 0 0 1 1 1 0 1 1 1 ...
##   ..$ gear: num [1:11] 4 4 4 4 4 4 3 4 5 5 ...
##   ..$ carb: num [1:11] 1 2 2 1 2 1 1 1 2 2 ...
##  $ 6:&#39;data.frame&#39;:   7 obs. of  11 variables:
##   ..$ mpg : num [1:7] 21 21 21.4 18.1 19.2 17.8 19.7
##   ..$ cyl : num [1:7] 6 6 6 6 6 6 6
##   ..$ disp: num [1:7] 160 160 258 225 168 ...
##   ..$ hp  : num [1:7] 110 110 110 105 123 123 175
##   ..$ drat: num [1:7] 3.9 3.9 3.08 2.76 3.92 3.92 3.62
##   ..$ wt  : num [1:7] 2.62 2.88 3.21 3.46 3.44 ...
##   ..$ qsec: num [1:7] 16.5 17 19.4 20.2 18.3 ...
##   ..$ vs  : num [1:7] 0 0 1 1 1 1 0
##   ..$ am  : num [1:7] 1 1 0 0 0 0 1
##   ..$ gear: num [1:7] 4 4 3 3 4 4 5
##   ..$ carb: num [1:7] 4 4 1 1 4 4 6
##  $ 8:&#39;data.frame&#39;:   14 obs. of  11 variables:
##   ..$ mpg : num [1:14] 18.7 14.3 16.4 17.3 15.2 10.4 10.4 14.7 15.5 15.2 ...
##   ..$ cyl : num [1:14] 8 8 8 8 8 8 8 8 8 8 ...
##   ..$ disp: num [1:14] 360 360 276 276 276 ...
##   ..$ hp  : num [1:14] 175 245 180 180 180 205 215 230 150 150 ...
##   ..$ drat: num [1:14] 3.15 3.21 3.07 3.07 3.07 2.93 3 3.23 2.76 3.15 ...
##   ..$ wt  : num [1:14] 3.44 3.57 4.07 3.73 3.78 ...
##   ..$ qsec: num [1:14] 17 15.8 17.4 17.6 18 ...
##   ..$ vs  : num [1:14] 0 0 0 0 0 0 0 0 0 0 ...
##   ..$ am  : num [1:14] 0 0 0 0 0 0 0 0 0 0 ...
##   ..$ gear: num [1:14] 3 3 3 3 3 3 3 3 3 3 ...
##   ..$ carb: num [1:14] 2 4 3 3 3 4 4 4 2 2 ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Extract the first element into four_cyls</span>
four_cyls &lt;-<span class="st"> </span>cyl[[<span class="dv">1</span>]]

<span class="co"># Fit a linear regression of mpg on wt using four_cyls</span>
<span class="kw">lm</span>(wt <span class="op">~</span><span class="st"> </span>mpg, four_cyls)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = wt ~ mpg, data = four_cyls)
## 
## Coefficients:
## (Intercept)          mpg  
##     4.68734     -0.09007</code></pre>
<p>We now have a snippet of code that performs the operation we want on one data frame. One option would be to turn this into a function, for example:</p>
<blockquote>
<p>fit_reg &lt;- function(df) { lm(mpg ~ wt, data = df) }</p>
</blockquote>
<p>Then pass this function into map():</p>
<blockquote>
<p>map(cyl, fit_reg)</p>
</blockquote>
<p>But it seems a bit much to define a function for such a specific model when we only want to do this once. Instead of defining the function in the global environment, we will just use the function anonymously inside our call to map().</p>
<p>What does this mean? Instead of referring to our function by name in map(), we define it on the fly in the .f argument to map()</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Rewrite to call an anonymous function</span>
<span class="kw">map</span>(cyl, <span class="cf">function</span>(df) <span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt, <span class="dt">data =</span> df))</code></pre></div>
<pre><code>## $`4`
## 
## Call:
## lm(formula = mpg ~ wt, data = df)
## 
## Coefficients:
## (Intercept)           wt  
##      39.571       -5.647  
## 
## 
## $`6`
## 
## Call:
## lm(formula = mpg ~ wt, data = df)
## 
## Coefficients:
## (Intercept)           wt  
##       28.41        -2.78  
## 
## 
## $`8`
## 
## Call:
## lm(formula = mpg ~ wt, data = df)
## 
## Coefficients:
## (Intercept)           wt  
##      23.868       -2.192</code></pre>
<p>Writing anonymous functions takes a lot of extra key strokes, so purrr provides a shortcut that allows you to write an anonymous function as a one-sided formula instead.</p>
<p>In R, a one-sided formula starts with a ~, followed by an R expression. In purrr’s map functions, the R expression can refer to an element of the .x argument using the . character.</p>
<p>Let’s take a look at an example. Imagine, instead of a regression on each data frame in cyl, we wanted to know the mean displacement for each data frame. One way to do this would be to use an anonymous function:</p>
<blockquote>
<p>map_dbl(cyl, function(df) mean(df$disp))</p>
</blockquote>
<p>To perform the same operation using the formula shortcut, we replace the function definition (function(df)) with the ~, then when we need to refer to the element of cyl the function operates on (in this case df), we use a ..</p>
<blockquote>
<p>map_dbl(cyl, ~ mean(.$disp))</p>
</blockquote>
<p>Much less typing. It also saves you from coming up with an argument name. Lets rewrite our previous anonymous function using this formula shortcut instead.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Rewrite to use the formula shortcut instead</span>
<span class="kw">map</span>(cyl, <span class="op">~</span><span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt, <span class="dt">data =</span> .))</code></pre></div>
<pre><code>## $`4`
## 
## Call:
## lm(formula = mpg ~ wt, data = .)
## 
## Coefficients:
## (Intercept)           wt  
##      39.571       -5.647  
## 
## 
## $`6`
## 
## Call:
## lm(formula = mpg ~ wt, data = .)
## 
## Coefficients:
## (Intercept)           wt  
##       28.41        -2.78  
## 
## 
## $`8`
## 
## Call:
## lm(formula = mpg ~ wt, data = .)
## 
## Coefficients:
## (Intercept)           wt  
##      23.868       -2.192</code></pre>
<p>There are also some useful shortcuts that come in handy when you want to subset each element of the .x argument. If the .f argument to a map function is set equal to a string, let’s say “name”, then purrr extracts the “name” element from every element of .x.</p>
<p>This is a really common situation you find yourself in when you work with nested lists. For example, if we have a list of where every element contains an a and b element:</p>
<blockquote>
<p>list_of_results &lt;- list( list(a = 1, b = “A”), list(a = 2, b = “C”), list(a = 3, b = “D”) )</p>
</blockquote>
<p>We might want to pull out the a element from every entry. We could do it with the string shortcut like this:</p>
<blockquote>
<p>map(list_of_results, “a”)</p>
</blockquote>
<p>Now take our list of regresssion models:</p>
<blockquote>
<p>map(cyl, ~ lm(mpg ~ wt, data = .))</p>
</blockquote>
<p>It might be nice to extract the slope coefficient from each model. You’ll do this in a few steps: first fit the models, then get the coefficients from each model using the coef() function, then pull out the wt estimate using the string shortcut.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Save the result from the previous exercise to the variable models</span>
models &lt;-<span class="st"> </span><span class="kw">map</span>(cyl, <span class="op">~</span><span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt, <span class="dt">data =</span> .))

<span class="co"># Use map and coef to get the coefficients for each model: coefs</span>
coefs &lt;-<span class="st"> </span><span class="kw">map</span>(models, <span class="op">~</span><span class="st"> </span><span class="kw">coef</span>(.))

<span class="co"># Use string shortcut to extract the wt coefficient </span>
<span class="kw">map</span>(coefs, <span class="st">&quot;wt&quot;</span>)</code></pre></div>
<pre><code>## $`4`
## [1] -5.647025
## 
## $`6`
## [1] -2.780106
## 
## $`8`
## [1] -2.192438</code></pre>
<p>Another useful shortcut for subsetting is to pass a numeric vector as the .f argument. This works just like passing a string but subsets by index rather than name. For example, with your previous list_of_results:</p>
<blockquote>
<p>list_of_results &lt;- list( list(a = 1, b = “A”), list(a = 2, b = “C”), list(a = 3, b = “D”) )</p>
</blockquote>
<p>Another way to pull out the a element from each list, is to pull out the first element:</p>
<blockquote>
<p>map(list_of_results, 1)</p>
</blockquote>
<p>Let’s pull out the slopes from our models again, but this time using numeric subsetting. Also, since we are pulling out a single numeric value from each element, let’s use map_dbl().</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># use map_dbl with the numeric shortcut to pull out the second element</span>
<span class="kw">map_dbl</span>(coefs, <span class="dv">1</span>)</code></pre></div>
<pre><code>##        4        6        8 
## 39.57120 28.40884 23.86803</code></pre>
<p>purrr also includes a pipe operator: %&gt;%. The pipe operator is another shortcut that saves typing, but also increases readability. The example below pulls out the R2 from each model. Rewrite the last two lines to use a pipe instead.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Define models (don&#39;t change)</span>
models &lt;-<span class="st"> </span>mtcars <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">split</span>(mtcars<span class="op">$</span>cyl) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt, <span class="dt">data =</span> .))

<span class="co"># Original code</span>
<span class="co"># summaries &lt;- map(models, summary) </span>
<span class="co"># map_dbl(summaries, &quot;r.squared&quot;)</span>

<span class="co"># Re-writen to single command with pipes</span>
models <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">map</span>(summary) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">map_dbl</span>(<span class="st">&quot;r.squared&quot;</span>)</code></pre></div>
<pre><code>##         4         6         8 
## 0.5086326 0.4645102 0.4229655</code></pre>
</div>
</div>
<div id="advanced-inputs-and-outputs" class="section level2">
<h2><span class="header-section-number">3.4</span> Advanced Inputs and Outputs</h2>
<p>When using purrr, problems like errors with a single item within the map function, for instance char instead of numeric data in a list of lists, can cause errors with all the map functions. We don’t know which element caused the error and we cant access any of the succesful runs. Purrr comes with a function called safely, which will return both successful elements and errors. It will take a function and return a variaton of that function which will never give an error - it will return two results, those successful (result) and those not (errors). This is one adverb for dealing with unusual output:</p>
<ul>
<li>safely() captures the successful result or the error, always returns a list</li>
<li>possibly() always succeeds, you give it a default value to return when there is an error</li>
<li>quietly() captures printed output, messages, and warnings instead of capturing errors</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create safe_readLines() by passing readLines() to safely()</span>
safe_readLines &lt;-<span class="st"> </span><span class="kw">safely</span>(readLines)

<span class="co"># Call safe_readLines() on &quot;http://example.org&quot;</span>
<span class="kw">safe_readLines</span>(<span class="st">&quot;http://example.org&quot;</span>)</code></pre></div>
<pre><code>## $result
##  [1] &quot;&lt;!doctype html&gt;&quot;                                                                                      
##  [2] &quot;&lt;html&gt;&quot;                                                                                               
##  [3] &quot;&lt;head&gt;&quot;                                                                                               
##  [4] &quot;    &lt;title&gt;Example Domain&lt;/title&gt;&quot;                                                                    
##  [5] &quot;&quot;                                                                                                     
##  [6] &quot;    &lt;meta charset=\&quot;utf-8\&quot; /&gt;&quot;                                                                       
##  [7] &quot;    &lt;meta http-equiv=\&quot;Content-type\&quot; content=\&quot;text/html; charset=utf-8\&quot; /&gt;&quot;                        
##  [8] &quot;    &lt;meta name=\&quot;viewport\&quot; content=\&quot;width=device-width, initial-scale=1\&quot; /&gt;&quot;                       
##  [9] &quot;    &lt;style type=\&quot;text/css\&quot;&gt;&quot;                                                                        
## [10] &quot;    body {&quot;                                                                                           
## [11] &quot;        background-color: #f0f0f2;&quot;                                                                   
## [12] &quot;        margin: 0;&quot;                                                                                   
## [13] &quot;        padding: 0;&quot;                                                                                  
## [14] &quot;        font-family: \&quot;Open Sans\&quot;, \&quot;Helvetica Neue\&quot;, Helvetica, Arial, sans-serif;&quot;                
## [15] &quot;        &quot;                                                                                             
## [16] &quot;    }&quot;                                                                                                
## [17] &quot;    div {&quot;                                                                                            
## [18] &quot;        width: 600px;&quot;                                                                                
## [19] &quot;        margin: 5em auto;&quot;                                                                            
## [20] &quot;        padding: 50px;&quot;                                                                               
## [21] &quot;        background-color: #fff;&quot;                                                                      
## [22] &quot;        border-radius: 1em;&quot;                                                                          
## [23] &quot;    }&quot;                                                                                                
## [24] &quot;    a:link, a:visited {&quot;                                                                              
## [25] &quot;        color: #38488f;&quot;                                                                              
## [26] &quot;        text-decoration: none;&quot;                                                                       
## [27] &quot;    }&quot;                                                                                                
## [28] &quot;    @media (max-width: 700px) {&quot;                                                                      
## [29] &quot;        body {&quot;                                                                                       
## [30] &quot;            background-color: #fff;&quot;                                                                  
## [31] &quot;        }&quot;                                                                                            
## [32] &quot;        div {&quot;                                                                                        
## [33] &quot;            width: auto;&quot;                                                                             
## [34] &quot;            margin: 0 auto;&quot;                                                                          
## [35] &quot;            border-radius: 0;&quot;                                                                        
## [36] &quot;            padding: 1em;&quot;                                                                            
## [37] &quot;        }&quot;                                                                                            
## [38] &quot;    }&quot;                                                                                                
## [39] &quot;    &lt;/style&gt;    &quot;                                                                                     
## [40] &quot;&lt;/head&gt;&quot;                                                                                              
## [41] &quot;&quot;                                                                                                     
## [42] &quot;&lt;body&gt;&quot;                                                                                               
## [43] &quot;&lt;div&gt;&quot;                                                                                                
## [44] &quot;    &lt;h1&gt;Example Domain&lt;/h1&gt;&quot;                                                                          
## [45] &quot;    &lt;p&gt;This domain is established to be used for illustrative examples in documents. You may use this&quot;
## [46] &quot;    domain in examples without prior coordination or asking for permission.&lt;/p&gt;&quot;                      
## [47] &quot;    &lt;p&gt;&lt;a href=\&quot;http://www.iana.org/domains/example\&quot;&gt;More information...&lt;/a&gt;&lt;/p&gt;&quot;                   
## [48] &quot;&lt;/div&gt;&quot;                                                                                               
## [49] &quot;&lt;/body&gt;&quot;                                                                                              
## [50] &quot;&lt;/html&gt;&quot;                                                                                              
## 
## $error
## NULL</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Call safe_readLines() on &quot;http://asdfasdasdkfjlda&quot;</span>
<span class="kw">safe_readLines</span>(<span class="st">&quot;http://asdfasdasdkfjlda&quot;</span>)</code></pre></div>
<pre><code>## Warning in file(con, &quot;r&quot;): InternetOpenUrl failed: &#39;The server name or
## address could not be resolved&#39;</code></pre>
<pre><code>## $result
## NULL
## 
## $error
## &lt;simpleError in file(con, &quot;r&quot;): cannot open the connection&gt;</code></pre>
<p>Safely also works with map functions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Define safe_readLines()</span>
safe_readLines &lt;-<span class="st"> </span><span class="kw">safely</span>(readLines)

urls &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">example =</span> <span class="st">&quot;http://example.org&quot;</span>,
  <span class="dt">rproj =</span> <span class="st">&quot;http://www.r-project.org&quot;</span>,
  <span class="dt">asdf =</span> <span class="st">&quot;http://asdfasdasdkfjlda&quot;</span>
)

<span class="co"># Use the safe_readLines() function with map(): html</span>
html &lt;-<span class="st"> </span><span class="kw">map</span>(urls, safe_readLines)</code></pre></div>
<pre><code>## Warning in file(con, &quot;r&quot;): InternetOpenUrl failed: &#39;The server name or
## address could not be resolved&#39;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Call str() on html</span>
<span class="kw">str</span>(html)</code></pre></div>
<pre><code>## List of 3
##  $ example:List of 2
##   ..$ result: chr [1:50] &quot;&lt;!doctype html&gt;&quot; &quot;&lt;html&gt;&quot; &quot;&lt;head&gt;&quot; &quot;    &lt;title&gt;Example Domain&lt;/title&gt;&quot; ...
##   ..$ error : NULL
##  $ rproj  :List of 2
##   ..$ result: chr [1:122] &quot;&lt;!DOCTYPE html&gt;&quot; &quot;&lt;html lang=\&quot;en\&quot;&gt;&quot; &quot;  &lt;head&gt;&quot; &quot;    &lt;meta charset=\&quot;utf-8\&quot;&gt;&quot; ...
##   ..$ error : NULL
##  $ asdf   :List of 2
##   ..$ result: NULL
##   ..$ error :List of 2
##   .. ..$ message: chr &quot;cannot open the connection&quot;
##   .. ..$ call   : language file(con, &quot;r&quot;)
##   .. ..- attr(*, &quot;class&quot;)= chr [1:3] &quot;simpleError&quot; &quot;error&quot; &quot;condition&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Extract the result from one of the successful elements</span>
html[[<span class="dv">1</span>]]</code></pre></div>
<pre><code>## $result
##  [1] &quot;&lt;!doctype html&gt;&quot;                                                                                      
##  [2] &quot;&lt;html&gt;&quot;                                                                                               
##  [3] &quot;&lt;head&gt;&quot;                                                                                               
##  [4] &quot;    &lt;title&gt;Example Domain&lt;/title&gt;&quot;                                                                    
##  [5] &quot;&quot;                                                                                                     
##  [6] &quot;    &lt;meta charset=\&quot;utf-8\&quot; /&gt;&quot;                                                                       
##  [7] &quot;    &lt;meta http-equiv=\&quot;Content-type\&quot; content=\&quot;text/html; charset=utf-8\&quot; /&gt;&quot;                        
##  [8] &quot;    &lt;meta name=\&quot;viewport\&quot; content=\&quot;width=device-width, initial-scale=1\&quot; /&gt;&quot;                       
##  [9] &quot;    &lt;style type=\&quot;text/css\&quot;&gt;&quot;                                                                        
## [10] &quot;    body {&quot;                                                                                           
## [11] &quot;        background-color: #f0f0f2;&quot;                                                                   
## [12] &quot;        margin: 0;&quot;                                                                                   
## [13] &quot;        padding: 0;&quot;                                                                                  
## [14] &quot;        font-family: \&quot;Open Sans\&quot;, \&quot;Helvetica Neue\&quot;, Helvetica, Arial, sans-serif;&quot;                
## [15] &quot;        &quot;                                                                                             
## [16] &quot;    }&quot;                                                                                                
## [17] &quot;    div {&quot;                                                                                            
## [18] &quot;        width: 600px;&quot;                                                                                
## [19] &quot;        margin: 5em auto;&quot;                                                                            
## [20] &quot;        padding: 50px;&quot;                                                                               
## [21] &quot;        background-color: #fff;&quot;                                                                      
## [22] &quot;        border-radius: 1em;&quot;                                                                          
## [23] &quot;    }&quot;                                                                                                
## [24] &quot;    a:link, a:visited {&quot;                                                                              
## [25] &quot;        color: #38488f;&quot;                                                                              
## [26] &quot;        text-decoration: none;&quot;                                                                       
## [27] &quot;    }&quot;                                                                                                
## [28] &quot;    @media (max-width: 700px) {&quot;                                                                      
## [29] &quot;        body {&quot;                                                                                       
## [30] &quot;            background-color: #fff;&quot;                                                                  
## [31] &quot;        }&quot;                                                                                            
## [32] &quot;        div {&quot;                                                                                        
## [33] &quot;            width: auto;&quot;                                                                             
## [34] &quot;            margin: 0 auto;&quot;                                                                          
## [35] &quot;            border-radius: 0;&quot;                                                                        
## [36] &quot;            padding: 1em;&quot;                                                                            
## [37] &quot;        }&quot;                                                                                            
## [38] &quot;    }&quot;                                                                                                
## [39] &quot;    &lt;/style&gt;    &quot;                                                                                     
## [40] &quot;&lt;/head&gt;&quot;                                                                                              
## [41] &quot;&quot;                                                                                                     
## [42] &quot;&lt;body&gt;&quot;                                                                                               
## [43] &quot;&lt;div&gt;&quot;                                                                                                
## [44] &quot;    &lt;h1&gt;Example Domain&lt;/h1&gt;&quot;                                                                          
## [45] &quot;    &lt;p&gt;This domain is established to be used for illustrative examples in documents. You may use this&quot;
## [46] &quot;    domain in examples without prior coordination or asking for permission.&lt;/p&gt;&quot;                      
## [47] &quot;    &lt;p&gt;&lt;a href=\&quot;http://www.iana.org/domains/example\&quot;&gt;More information...&lt;/a&gt;&lt;/p&gt;&quot;                   
## [48] &quot;&lt;/div&gt;&quot;                                                                                               
## [49] &quot;&lt;/body&gt;&quot;                                                                                              
## [50] &quot;&lt;/html&gt;&quot;                                                                                              
## 
## $error
## NULL</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Extract the error from the element that was unsuccessful</span>
html[[<span class="dv">3</span>]]</code></pre></div>
<pre><code>## $result
## NULL
## 
## $error
## &lt;simpleError in file(con, &quot;r&quot;): cannot open the connection&gt;</code></pre>
<p>We now have output that contains the HTML for each of the two URLs on which readLines() was successful and the error for the other. But the output isn’t that easy to work with, since the results and errors are buried in the inner-most level of the list.</p>
<p>purrr provides a function transpose() that reshapes a list so the inner-most level becomes the outer-most level. In otherwords, it turns a list-of-lists “inside-out”. Consider the following list:</p>
<blockquote>
<p>nested_list &lt;- list( x1 = list(a = 1, b = 2), x2 = list(a = 3, b = 4) )</p>
</blockquote>
<p>If I need to extract the a element in x1, I could do nested_list[[“x1”]][[“a”]]. However, if I transpose the list first, the order of subsetting reverses. That is, to extract the same element I could also do transpose(nested_list)[[“a”]][[“x1”]].</p>
<p>This is really handy for safe output, since we can grab all the results or all the errors really easily.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Define save_readLines() and html</span>
safe_readLines &lt;-<span class="st"> </span><span class="kw">safely</span>(readLines)
html &lt;-<span class="st"> </span><span class="kw">map</span>(urls, safe_readLines)</code></pre></div>
<pre><code>## Warning in file(con, &quot;r&quot;): InternetOpenUrl failed: &#39;The server name or
## address could not be resolved&#39;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Examine the structure of transpose(html)</span>
<span class="kw">str</span>(<span class="kw">transpose</span>(html))</code></pre></div>
<pre><code>## List of 2
##  $ result:List of 3
##   ..$ example: chr [1:50] &quot;&lt;!doctype html&gt;&quot; &quot;&lt;html&gt;&quot; &quot;&lt;head&gt;&quot; &quot;    &lt;title&gt;Example Domain&lt;/title&gt;&quot; ...
##   ..$ rproj  : chr [1:122] &quot;&lt;!DOCTYPE html&gt;&quot; &quot;&lt;html lang=\&quot;en\&quot;&gt;&quot; &quot;  &lt;head&gt;&quot; &quot;    &lt;meta charset=\&quot;utf-8\&quot;&gt;&quot; ...
##   ..$ asdf   : NULL
##  $ error :List of 3
##   ..$ example: NULL
##   ..$ rproj  : NULL
##   ..$ asdf   :List of 2
##   .. ..$ message: chr &quot;cannot open the connection&quot;
##   .. ..$ call   : language file(con, &quot;r&quot;)
##   .. ..- attr(*, &quot;class&quot;)= chr [1:3] &quot;simpleError&quot; &quot;error&quot; &quot;condition&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Extract the results: res</span>
res &lt;-<span class="st"> </span><span class="kw">transpose</span>(html)[[<span class="st">&quot;result&quot;</span>]]

<span class="co"># Extract the errors: errs</span>
errs &lt;-<span class="st"> </span><span class="kw">transpose</span>(html)[[<span class="st">&quot;error&quot;</span>]]</code></pre></div>
<p>What you do with the errors and results is up to you. But, commonly you’ll want to collect all the results for the elements that were successful and examine the inputs for all those that weren’t.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Initialize some objects</span>
safe_readLines &lt;-<span class="st"> </span><span class="kw">safely</span>(readLines)
html &lt;-<span class="st"> </span><span class="kw">map</span>(urls, safe_readLines)</code></pre></div>
<pre><code>## Warning in file(con, &quot;r&quot;): InternetOpenUrl failed: &#39;The server name or
## address could not be resolved&#39;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res &lt;-<span class="st"> </span><span class="kw">transpose</span>(html)[[<span class="st">&quot;result&quot;</span>]]
errs &lt;-<span class="st"> </span><span class="kw">transpose</span>(html)[[<span class="st">&quot;error&quot;</span>]]

<span class="co"># Create a logical vector is_ok</span>
is_ok &lt;-<span class="st"> </span><span class="kw">map_lgl</span>(errs, is_null)

<span class="co"># Extract the successful results</span>
res[is_ok]</code></pre></div>
<pre><code>## $example
##  [1] &quot;&lt;!doctype html&gt;&quot;                                                                                      
##  [2] &quot;&lt;html&gt;&quot;                                                                                               
##  [3] &quot;&lt;head&gt;&quot;                                                                                               
##  [4] &quot;    &lt;title&gt;Example Domain&lt;/title&gt;&quot;                                                                    
##  [5] &quot;&quot;                                                                                                     
##  [6] &quot;    &lt;meta charset=\&quot;utf-8\&quot; /&gt;&quot;                                                                       
##  [7] &quot;    &lt;meta http-equiv=\&quot;Content-type\&quot; content=\&quot;text/html; charset=utf-8\&quot; /&gt;&quot;                        
##  [8] &quot;    &lt;meta name=\&quot;viewport\&quot; content=\&quot;width=device-width, initial-scale=1\&quot; /&gt;&quot;                       
##  [9] &quot;    &lt;style type=\&quot;text/css\&quot;&gt;&quot;                                                                        
## [10] &quot;    body {&quot;                                                                                           
## [11] &quot;        background-color: #f0f0f2;&quot;                                                                   
## [12] &quot;        margin: 0;&quot;                                                                                   
## [13] &quot;        padding: 0;&quot;                                                                                  
## [14] &quot;        font-family: \&quot;Open Sans\&quot;, \&quot;Helvetica Neue\&quot;, Helvetica, Arial, sans-serif;&quot;                
## [15] &quot;        &quot;                                                                                             
## [16] &quot;    }&quot;                                                                                                
## [17] &quot;    div {&quot;                                                                                            
## [18] &quot;        width: 600px;&quot;                                                                                
## [19] &quot;        margin: 5em auto;&quot;                                                                            
## [20] &quot;        padding: 50px;&quot;                                                                               
## [21] &quot;        background-color: #fff;&quot;                                                                      
## [22] &quot;        border-radius: 1em;&quot;                                                                          
## [23] &quot;    }&quot;                                                                                                
## [24] &quot;    a:link, a:visited {&quot;                                                                              
## [25] &quot;        color: #38488f;&quot;                                                                              
## [26] &quot;        text-decoration: none;&quot;                                                                       
## [27] &quot;    }&quot;                                                                                                
## [28] &quot;    @media (max-width: 700px) {&quot;                                                                      
## [29] &quot;        body {&quot;                                                                                       
## [30] &quot;            background-color: #fff;&quot;                                                                  
## [31] &quot;        }&quot;                                                                                            
## [32] &quot;        div {&quot;                                                                                        
## [33] &quot;            width: auto;&quot;                                                                             
## [34] &quot;            margin: 0 auto;&quot;                                                                          
## [35] &quot;            border-radius: 0;&quot;                                                                        
## [36] &quot;            padding: 1em;&quot;                                                                            
## [37] &quot;        }&quot;                                                                                            
## [38] &quot;    }&quot;                                                                                                
## [39] &quot;    &lt;/style&gt;    &quot;                                                                                     
## [40] &quot;&lt;/head&gt;&quot;                                                                                              
## [41] &quot;&quot;                                                                                                     
## [42] &quot;&lt;body&gt;&quot;                                                                                               
## [43] &quot;&lt;div&gt;&quot;                                                                                                
## [44] &quot;    &lt;h1&gt;Example Domain&lt;/h1&gt;&quot;                                                                          
## [45] &quot;    &lt;p&gt;This domain is established to be used for illustrative examples in documents. You may use this&quot;
## [46] &quot;    domain in examples without prior coordination or asking for permission.&lt;/p&gt;&quot;                      
## [47] &quot;    &lt;p&gt;&lt;a href=\&quot;http://www.iana.org/domains/example\&quot;&gt;More information...&lt;/a&gt;&lt;/p&gt;&quot;                   
## [48] &quot;&lt;/div&gt;&quot;                                                                                               
## [49] &quot;&lt;/body&gt;&quot;                                                                                              
## [50] &quot;&lt;/html&gt;&quot;                                                                                              
## 
## $rproj
##   [1] &quot;&lt;!DOCTYPE html&gt;&quot;                                                                                                                                                                                                                                                                                                                                     
##   [2] &quot;&lt;html lang=\&quot;en\&quot;&gt;&quot;                                                                                                                                                                                                                                                                                                                                  
##   [3] &quot;  &lt;head&gt;&quot;                                                                                                                                                                                                                                                                                                                                            
##   [4] &quot;    &lt;meta charset=\&quot;utf-8\&quot;&gt;&quot;                                                                                                                                                                                                                                                                                                                        
##   [5] &quot;    &lt;meta http-equiv=\&quot;X-UA-Compatible\&quot; content=\&quot;IE=edge\&quot;&gt;&quot;                                                                                                                                                                                                                                                                                       
##   [6] &quot;    &lt;meta name=\&quot;viewport\&quot; content=\&quot;width=device-width, initial-scale=1\&quot;&gt;&quot;                                                                                                                                                                                                                                                                        
##   [7] &quot;    &lt;title&gt;R: The R Project for Statistical Computing&lt;/title&gt;&quot;                                                                                                                                                                                                                                                                                       
##   [8] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                    
##   [9] &quot;    &lt;link rel=\&quot;icon\&quot; type=\&quot;image/png\&quot; href=\&quot;/favicon-32x32.png\&quot; sizes=\&quot;32x32\&quot; /&gt;&quot;                                                                                                                                                                                                                                                            
##  [10] &quot;    &lt;link rel=\&quot;icon\&quot; type=\&quot;image/png\&quot; href=\&quot;/favicon-16x16.png\&quot; sizes=\&quot;16x16\&quot; /&gt;&quot;                                                                                                                                                                                                                                                            
##  [11] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                    
##  [12] &quot;    &lt;!-- Bootstrap --&gt;&quot;                                                                                                                                                                                                                                                                                                                              
##  [13] &quot;    &lt;link href=\&quot;/css/bootstrap.min.css\&quot; rel=\&quot;stylesheet\&quot;&gt;&quot;                                                                                                                                                                                                                                                                                       
##  [14] &quot;    &lt;link href=\&quot;/css/R.css\&quot; rel=\&quot;stylesheet\&quot;&gt;&quot;                                                                                                                                                                                                                                                                                                   
##  [15] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                    
##  [16] &quot;    &lt;!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries --&gt;&quot;                                                                                                                                                                                                                                                          
##  [17] &quot;    &lt;!-- WARNING: Respond.js doesn&#39;t work if you view the page via file:// --&gt;&quot;                                                                                                                                                                                                                                                                      
##  [18] &quot;    &lt;!--[if lt IE 9]&gt;&quot;                                                                                                                                                                                                                                                                                                                               
##  [19] &quot;      &lt;script src=\&quot;https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js\&quot;&gt;&lt;/script&gt;&quot;                                                                                                                                                                                                                                                             
##  [20] &quot;      &lt;script src=\&quot;https://oss.maxcdn.com/respond/1.4.2/respond.min.js\&quot;&gt;&lt;/script&gt;&quot;                                                                                                                                                                                                                                                                 
##  [21] &quot;    &lt;![endif]--&gt;&quot;                                                                                                                                                                                                                                                                                                                                    
##  [22] &quot;  &lt;/head&gt;&quot;                                                                                                                                                                                                                                                                                                                                           
##  [23] &quot;  &lt;body&gt;&quot;                                                                                                                                                                                                                                                                                                                                            
##  [24] &quot;    &lt;div class=\&quot;container page\&quot;&gt;&quot;                                                                                                                                                                                                                                                                                                                  
##  [25] &quot;      &lt;div class=\&quot;row\&quot;&gt;&quot;                                                                                                                                                                                                                                                                                                                           
##  [26] &quot;        &lt;div class=\&quot;col-xs-12 col-sm-offset-1 col-sm-2 sidebar\&quot; role=\&quot;navigation\&quot;&gt;&quot;                                                                                                                                                                                                                                                              
##  [27] &quot;&lt;div class=\&quot;row\&quot;&gt;&quot;                                                                                                                                                                                                                                                                                                                                 
##  [28] &quot;&lt;div class=\&quot;col-xs-6 col-sm-12\&quot;&gt;&quot;                                                                                                                                                                                                                                                                                                                  
##  [29] &quot;&lt;p&gt;&lt;a href=\&quot;/\&quot;&gt;&lt;img src=\&quot;/Rlogo.png\&quot; width=\&quot;100\&quot; height=\&quot;78\&quot; alt = \&quot;R\&quot; /&gt;&lt;/a&gt;&lt;/p&gt;&quot;                                                                                                                                                                                                                                                         
##  [30] &quot;&lt;p&gt;&lt;small&gt;&lt;a href=\&quot;/\&quot;&gt;[Home]&lt;/a&gt;&lt;/small&gt;&lt;/p&gt;&quot;                                                                                                                                                                                                                                                                                                      
##  [31] &quot;&lt;h2 id=\&quot;download\&quot;&gt;Download&lt;/h2&gt;&quot;                                                                                                                                                                                                                                                                                                                   
##  [32] &quot;&lt;p&gt;&lt;a href=\&quot;http://cran.r-project.org/mirrors.html\&quot;&gt;CRAN&lt;/a&gt;&lt;/p&gt;&quot;                                                                                                                                                                                                                                                                                  
##  [33] &quot;&lt;h2 id=\&quot;r-project\&quot;&gt;R Project&lt;/h2&gt;&quot;                                                                                                                                                                                                                                                                                                                 
##  [34] &quot;&lt;ul&gt;&quot;                                                                                                                                                                                                                                                                                                                                                
##  [35] &quot;&lt;li&gt;&lt;a href=\&quot;/about.html\&quot;&gt;About R&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                                                        
##  [36] &quot;&lt;li&gt;&lt;a href=\&quot;/logo/\&quot;&gt;Logo&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                                                                
##  [37] &quot;&lt;li&gt;&lt;a href=\&quot;/contributors.html\&quot;&gt;Contributors&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                                            
##  [38] &quot;&lt;li&gt;&lt;a href=\&quot;/news.html\&quot;&gt;Whatâs New?&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                                                   
##  [39] &quot;&lt;li&gt;&lt;a href=\&quot;/bugs.html\&quot;&gt;Reporting Bugs&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                                                  
##  [40] &quot;&lt;li&gt;&lt;a href=\&quot;http://developer.R-project.org\&quot;&gt;Development Site&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                            
##  [41] &quot;&lt;li&gt;&lt;a href=\&quot;/conferences.html\&quot;&gt;Conferences&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                                              
##  [42] &quot;&lt;li&gt;&lt;a href=\&quot;/search.html\&quot;&gt;Search&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                                                        
##  [43] &quot;&lt;/ul&gt;&quot;                                                                                                                                                                                                                                                                                                                                               
##  [44] &quot;&lt;/div&gt;&quot;                                                                                                                                                                                                                                                                                                                                              
##  [45] &quot;&lt;div class=\&quot;col-xs-6 col-sm-12\&quot;&gt;&quot;                                                                                                                                                                                                                                                                                                                  
##  [46] &quot;&lt;h2 id=\&quot;r-foundation\&quot;&gt;R Foundation&lt;/h2&gt;&quot;                                                                                                                                                                                                                                                                                                           
##  [47] &quot;&lt;ul&gt;&quot;                                                                                                                                                                                                                                                                                                                                                
##  [48] &quot;&lt;li&gt;&lt;a href=\&quot;/foundation/\&quot;&gt;Foundation&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                                                    
##  [49] &quot;&lt;li&gt;&lt;a href=\&quot;/foundation/board.html\&quot;&gt;Board&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                                               
##  [50] &quot;&lt;li&gt;&lt;a href=\&quot;/foundation/members.html\&quot;&gt;Members&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                                           
##  [51] &quot;&lt;li&gt;&lt;a href=\&quot;/foundation/donors.html\&quot;&gt;Donors&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                                             
##  [52] &quot;&lt;li&gt;&lt;a href=\&quot;/foundation/donations.html\&quot;&gt;Donate&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                                          
##  [53] &quot;&lt;/ul&gt;&quot;                                                                                                                                                                                                                                                                                                                                               
##  [54] &quot;&lt;h2 id=\&quot;help-with-r\&quot;&gt;Help With R&lt;/h2&gt;&quot;                                                                                                                                                                                                                                                                                                             
##  [55] &quot;&lt;ul&gt;&quot;                                                                                                                                                                                                                                                                                                                                                
##  [56] &quot;&lt;li&gt;&lt;a href=\&quot;/help.html\&quot;&gt;Getting Help&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                                                    
##  [57] &quot;&lt;/ul&gt;&quot;                                                                                                                                                                                                                                                                                                                                               
##  [58] &quot;&lt;h2 id=\&quot;documentation\&quot;&gt;Documentation&lt;/h2&gt;&quot;                                                                                                                                                                                                                                                                                                         
##  [59] &quot;&lt;ul&gt;&quot;                                                                                                                                                                                                                                                                                                                                                
##  [60] &quot;&lt;li&gt;&lt;a href=\&quot;http://cran.r-project.org/manuals.html\&quot;&gt;Manuals&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                             
##  [61] &quot;&lt;li&gt;&lt;a href=\&quot;http://cran.r-project.org/faqs.html\&quot;&gt;FAQs&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                                   
##  [62] &quot;&lt;li&gt;&lt;a href=\&quot;http://journal.r-project.org\&quot;&gt;The R Journal&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                                 
##  [63] &quot;&lt;li&gt;&lt;a href=\&quot;/doc/bib/R-books.html\&quot;&gt;Books&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                                                
##  [64] &quot;&lt;li&gt;&lt;a href=\&quot;/certification.html\&quot;&gt;Certification&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                                          
##  [65] &quot;&lt;li&gt;&lt;a href=\&quot;/other-docs.html\&quot;&gt;Other&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                                                     
##  [66] &quot;&lt;/ul&gt;&quot;                                                                                                                                                                                                                                                                                                                                               
##  [67] &quot;&lt;h2 id=\&quot;links\&quot;&gt;Links&lt;/h2&gt;&quot;                                                                                                                                                                                                                                                                                                                         
##  [68] &quot;&lt;ul&gt;&quot;                                                                                                                                                                                                                                                                                                                                                
##  [69] &quot;&lt;li&gt;&lt;a href=\&quot;http://www.bioconductor.org\&quot;&gt;Bioconductor&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                                   
##  [70] &quot;&lt;li&gt;&lt;a href=\&quot;/other-projects.html\&quot;&gt;Related Projects&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                                      
##  [71] &quot;&lt;li&gt;&lt;a href=\&quot;/gsoc.html\&quot;&gt;GSoC&lt;/a&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                                                            
##  [72] &quot;&lt;/ul&gt;&quot;                                                                                                                                                                                                                                                                                                                                               
##  [73] &quot;&lt;/div&gt;&quot;                                                                                                                                                                                                                                                                                                                                              
##  [74] &quot;&lt;/div&gt;&quot;                                                                                                                                                                                                                                                                                                                                              
##  [75] &quot;        &lt;/div&gt;&quot;                                                                                                                                                                                                                                                                                                                                      
##  [76] &quot;        &lt;div class=\&quot;col-xs-12 col-sm-7\&quot;&gt;&quot;                                                                                                                                                                                                                                                                                                          
##  [77] &quot;        &lt;h1&gt;The R Project for Statistical Computing&lt;/h1&gt;&quot;                                                                                                                                                                                                                                                                                            
##  [78] &quot;&lt;h2 id=\&quot;getting-started\&quot;&gt;Getting Started&lt;/h2&gt;&quot;                                                                                                                                                                                                                                                                                                     
##  [79] &quot;&lt;p&gt;R is a free software environment for statistical computing and graphics. It compiles and runs on a wide variety of UNIX platforms, Windows and MacOS. To &lt;strong&gt;&lt;a href=\&quot;http://cran.r-project.org/mirrors.html\&quot;&gt;download R&lt;/a&gt;&lt;/strong&gt;, please choose your preferred &lt;a href=\&quot;http://cran.r-project.org/mirrors.html\&quot;&gt;CRAN mirror&lt;/a&gt;.&lt;/p&gt;&quot;
##  [80] &quot;&lt;p&gt;If you have questions about R like how to download and install the software, or what the license terms are, please read our &lt;a href=\&quot;http://cran.R-project.org/faqs.html\&quot;&gt;answers to frequently asked questions&lt;/a&gt; before you send an email.&lt;/p&gt;&quot;                                                                                              
##  [81] &quot;&lt;h2 id=\&quot;news\&quot;&gt;News&lt;/h2&gt;&quot;                                                                                                                                                                                                                                                                                                                           
##  [82] &quot;&lt;ul&gt;&quot;                                                                                                                                                                                                                                                                                                                                                
##  [83] &quot;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;http://cran.r-project.org/src/base-prerelease\&quot;&gt;&lt;strong&gt;R version 3.4.3 (Kite-Eating Tree) prerelease versions&lt;/strong&gt;&lt;/a&gt; will appear starting Monday 2017-11-20. Final release is scheduled for Thursday 2017-11-30.&lt;/p&gt;&lt;/li&gt;&quot;                                                                                                   
##  [84] &quot;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;http://cran.r-project.org/src/base/R-3\&quot;&gt;&lt;strong&gt;R version 3.4.2 (Short Summer)&lt;/strong&gt;&lt;/a&gt; has been released on Thursday 2017-09-28.&lt;/p&gt;&lt;/li&gt;&quot;                                                                                                                                                                                    
##  [85] &quot;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://journal.r-project.org/archive/2017-1\&quot;&gt;&lt;strong&gt;The R Journal Volume 9/1&lt;/strong&gt;&lt;/a&gt; is available.&lt;/p&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                
##  [86] &quot;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;http://cran.r-project.org/src/base/R-3\&quot;&gt;&lt;strong&gt;R version 3.3.3 (Another Canoe)&lt;/strong&gt;&lt;/a&gt; has been released on Monday 2017-03-06.&lt;/p&gt;&lt;/li&gt;&quot;                                                                                                                                                                                     
##  [87] &quot;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;https://journal.r-project.org/archive/2016-2\&quot;&gt;&lt;strong&gt;The R Journal Volume 8/2&lt;/strong&gt;&lt;/a&gt; is available.&lt;/p&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                
##  [88] &quot;&lt;li&gt;&lt;p&gt;&lt;strong&gt;useR! 2017&lt;/strong&gt; (July 4 - 7 in Brussels) has opened registration and more at http://user2017.brussels/&lt;/p&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                  
##  [89] &quot;&lt;li&gt;&lt;p&gt;Tomas Kalibera has joined the R core team.&lt;/p&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                                                                          
##  [90] &quot;&lt;li&gt;&lt;p&gt;The R Foundation welcomes five new ordinary members: Jennifer Bryan, Dianne Cook, Julie Josse, Tomas Kalibera, and Balasubramanian Narasimhan.&lt;/p&gt;&lt;/li&gt;&quot;                                                                                                                                                                                      
##  [91] &quot;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;http://journal.r-project.org\&quot;&gt;&lt;strong&gt;The R Journal Volume 8/1&lt;/strong&gt;&lt;/a&gt; is available.&lt;/p&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                
##  [92] &quot;&lt;li&gt;&lt;p&gt;The &lt;strong&gt;useR! 2017&lt;/strong&gt; conference will take place in Brussels, July 4 - 7, 2017.&lt;/p&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                           
##  [93] &quot;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;http://cran.r-project.org/src/base/R-3\&quot;&gt;&lt;strong&gt;R version 3.2.5 (Very, Very Secure Dishes)&lt;/strong&gt;&lt;/a&gt; has been released on 2016-04-14. This is a rebadging of the quick-fix release 3.2.4-revised.&lt;/p&gt;&lt;/li&gt;&quot;                                                                                                                     
##  [94] &quot;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Notice XQuartz users (Mac OS X)&lt;/strong&gt; A security issue has been detected with the Sparkle update mechanism used by XQuartz. Avoid updating over insecure channels.&lt;/p&gt;&lt;/li&gt;&quot;                                                                                                                                                       
##  [95] &quot;&lt;li&gt;&lt;p&gt;The &lt;a href=\&quot;http://www.r-project.org/logo\&quot;&gt;&lt;strong&gt;R Logo&lt;/strong&gt;&lt;/a&gt; is available for download in high-resolution PNG or SVG formats.&lt;/p&gt;&lt;/li&gt;&quot;                                                                                                                                                                                          
##  [96] &quot;&lt;li&gt;&lt;p&gt;&lt;strong&gt;&lt;a href=\&quot;http://www.r-project.org/useR-2016\&quot;&gt;useR! 2016&lt;/a&gt;&lt;/strong&gt;, has taken place at Stanford University, CA, USA, June 27 - June 30, 2016.&lt;/p&gt;&lt;/li&gt;&quot;                                                                                                                                                                           
##  [97] &quot;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;http://journal.r-project.org\&quot;&gt;&lt;strong&gt;The R Journal Volume 7/2&lt;/strong&gt;&lt;/a&gt; is available.&lt;/p&gt;&lt;/li&gt;&quot;                                                                                                                                                                                                                                
##  [98] &quot;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;http://cran.r-project.org/src/base/R-3\&quot;&gt;&lt;strong&gt;R version 3.2.3 (Wooden Christmas-Tree)&lt;/strong&gt;&lt;/a&gt; has been released on 2015-12-10.&lt;/p&gt;&lt;/li&gt;&quot;                                                                                                                                                                                    
##  [99] &quot;&lt;li&gt;&lt;p&gt;&lt;a href=\&quot;http://cran.r-project.org/src/base/R-3\&quot;&gt;&lt;strong&gt;R version 3.1.3 (Smooth Sidewalk)&lt;/strong&gt;&lt;/a&gt; has been released on 2015-03-09.&lt;/p&gt;&lt;/li&gt;&quot;                                                                                                                                                                                          
## [100] &quot;&lt;/ul&gt;&quot;                                                                                                                                                                                                                                                                                                                                               
## [101] &quot;&lt;!--- (Boilerplate for release run-in)&quot;                                                                                                                                                                                                                                                                                                              
## [102] &quot;-   [**R version 3.1.3 (Smooth Sidewalk) prerelease versions**](http://cran.r-project.org/src/base-prerelease) will appear starting February 28. Final release is scheduled for 2015-03-09.&quot;                                                                                                                                                         
## [103] &quot;--&gt;&quot;                                                                                                                                                                                                                                                                                                                                                 
## [104] &quot;        &lt;/div&gt;&quot;                                                                                                                                                                                                                                                                                                                                      
## [105] &quot;      &lt;/div&gt;&quot;                                                                                                                                                                                                                                                                                                                                        
## [106] &quot;      &lt;div class=\&quot;raw footer\&quot;&gt;&quot;                                                                                                                                                                                                                                                                                                                    
## [107] &quot;        &amp;copy; The R Foundation. For queries about this web site, please contact&quot;                                                                                                                                                                                                                                                                    
## [108] &quot;\t&lt;script type=&#39;text/javascript&#39;&gt;&quot;                                                                                                                                                                                                                                                                                                                    
## [109] &quot;&lt;!--&quot;                                                                                                                                                                                                                                                                                                                                                
## [110] &quot;var s=\&quot;=b!isfg&gt;#nbjmup;xfcnbtufsAs.qspkfdu/psh#?uif!xfcnbtufs=0b?\&quot;;&quot;                                                                                                                                                                                                                                                                               
## [111] &quot;m=\&quot;\&quot;; for (i=0; i&lt;s.length; i++) {if(s.charCodeAt(i) == 28){m+= &#39;&amp;&#39;;} else if (s.charCodeAt(i) == 23) {m+= &#39;!&#39;;} else {m+=String.fromCharCode(s.charCodeAt(i)-1);}}document.write(m);//--&gt;&quot;                                                                                                                                                        
## [112] &quot;\t&lt;/script&gt;;&quot;                                                                                                                                                                                                                                                                                                                                         
## [113] &quot;        for queries about R itself, please consult the &quot;                                                                                                                                                                                                                                                                                             
## [114] &quot;        &lt;a href=\&quot;help.html\&quot;&gt;Getting Help&lt;/a&gt; section.&quot;                                                                                                                                                                                                                                                                                             
## [115] &quot;      &lt;/div&gt;&quot;                                                                                                                                                                                                                                                                                                                                        
## [116] &quot;    &lt;/div&gt;&quot;                                                                                                                                                                                                                                                                                                                                          
## [117] &quot;    &lt;!-- jQuery (necessary for Bootstrap&#39;s JavaScript plugins) --&gt;&quot;                                                                                                                                                                                                                                                                                  
## [118] &quot;    &lt;script src=\&quot;https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js\&quot;&gt;&lt;/script&gt;&quot;                                                                                                                                                                                                                                                     
## [119] &quot;    &lt;!-- Include all compiled plugins (below), or include individual files as needed --&gt;&quot;                                                                                                                                                                                                                                                            
## [120] &quot;    &lt;script src=\&quot;/js/bootstrap.min.js\&quot;&gt;&lt;/script&gt;&quot;                                                                                                                                                                                                                                                                                                  
## [121] &quot;  &lt;/body&gt;&quot;                                                                                                                                                                                                                                                                                                                                           
## [122] &quot;&lt;/html&gt;&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Extract the input from the unsuccessful results</span>
urls[<span class="op">!</span>is_ok]</code></pre></div>
<pre><code>## $asdf
## [1] &quot;http://asdfasdasdkfjlda&quot;</code></pre>
<div id="maps-over-multiple-arguments" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Maps over multiple arguments</h3>
<p>If we want to add multiple arguments - for instance creating a normal distribution using rnorm() with two arguments, one for the number of rows (n) and one for the desired mean - we can use the map2 function which now takes the form</p>
<blockquote>
<p>map2(.x, .y, .f …) # iterate over two arguments</p>
</blockquote>
<p>But if we wanted to extend this, by adding saying the standard deviation (sd) rather than use map3 and so on for more arguments, purr has a pmap function that takes lists as inputs</p>
<blockquote>
<p>pmap(.l, .f, …) # iterate over many arguments</p>
</blockquote>
<p>Or if we wanted to do a similar exercise but use different functions, say to run distributions for expontial as well as rnorm, we use the invoke map() functions</p>
<blockquote>
<p>invoke_map(.f, .x = list(NULL), …) # iterate over functions and arguments</p>
</blockquote>
<p>This next section will use the random number generator rnorm().</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create a list n containing the values: 5, 10, and 20</span>
n &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>)

<span class="co"># Call map() on n with rnorm() to simulate three samples</span>
<span class="kw">map</span>(n, rnorm)</code></pre></div>
<pre><code>## [[1]]
## [1] -0.4366686  1.4324114 -1.5956013 -1.1505808  0.2122502
## 
## [[2]]
##  [1]  0.3243319 -0.9960460 -0.7376161  0.3113217 -0.2849793 -0.2588673
##  [7] -0.3798126 -0.9622933  2.3591024 -1.3414916
## 
## [[3]]
##  [1]  2.0575641 -0.2063629  1.5997894 -0.9344443 -1.0462768  0.4878357
##  [7]  1.2556464  1.4165219 -0.8103948 -1.1889049  0.9819992 -0.1521257
## [13]  1.3140112  1.2322927 -1.0607637 -0.3193866  0.1884801  0.3432868
## [19]  0.8239909 -0.8821097</code></pre>
<p>If we also want to vary the mean, the mean can be specified in rnorm() by the argument mean. Now there are two arguments to rnorm() we want to vary: n and mean.</p>
<p>The map2() function is designed exactly for this purpose; it allows iteration over two objects. The first two arguments to map2() are the objects to iterate over and the third argument .f is the function to apply.</p>
<p>Let’s use map2() to simulate three samples with different sample sizes and different means.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Initialize n</span>
n &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>)

<span class="co"># Create a list mu containing the values: 1, 5, and 10</span>
mu &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>)

<span class="co"># Edit to call map2() on n and mu with rnorm() to simulate three samples</span>
<span class="kw">map2</span>(n, mu, rnorm)</code></pre></div>
<pre><code>## [[1]]
## [1]  1.720083  1.656689  0.798450  2.075659 -1.213459
## 
## [[2]]
##  [1] 6.059364 4.866746 5.195483 5.948219 5.237326 5.880230 5.762817
##  [8] 2.770638 4.808516 5.295286
## 
## [[3]]
##  [1] 11.466687 10.622913  9.661050  9.517950  9.780029  8.685184 12.568060
##  [8] 11.306317  9.724562 11.219939  9.858983  9.636000  9.934999 10.446160
## [15]  9.322075  8.903951 11.063303 10.899909  9.619289 10.003181</code></pre>
<p>We might want to vary: sd, the standard deviation of the Normal distribution. You might think there is a map3() function, but there isn’t. Instead purrr provides a pmap() function that iterates over 2 or more arguments.</p>
<p>First, let’s take a look at pmap() for the situation we just solved: iterating over two arguments. Instead of providing each item to iterate over as arguments, pmap() takes a list of arguments as its input. For example, we could replicate our previous example, iterating over both n and mu with the following:</p>
<blockquote>
<p>n &lt;- list(5, 10, 20) mu &lt;- list(1, 5, 10)</p>
</blockquote>
<blockquote>
<p>pmap(list(n, mu), rnorm)</p>
</blockquote>
<p>Notice how we had to put our two items to iterate over (n and mu) into a list.</p>
<p>Let’s expand this code to iterate over varying standard deviations too.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Initialize n and mu</span>
n &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>)
mu &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>)

<span class="co"># Create a sd list with the values: 0.1, 1 and 0.1</span>
sd &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)

<span class="co"># Edit this call to pmap() to iterate over the sd list as well</span>
<span class="kw">pmap</span>(<span class="kw">list</span>(n, mu, sd), rnorm)</code></pre></div>
<pre><code>## [[1]]
## [1] 0.8698591 1.0009957 0.9710751 0.9496946 1.0495229
## 
## [[2]]
##  [1] 6.472870 5.854239 4.528828 4.874714 4.466589 6.146899 4.184024
##  [8] 2.707230 4.097509 6.853301
## 
## [[3]]
##  [1] 10.296885 10.152149  9.871139 10.070173 10.187305 10.126474 10.100678
##  [8]  9.930911 10.030108  9.962779 10.104376 10.128644  9.952670 10.190224
## [15]  9.992032  9.890755  9.976874 10.139623  9.957864 10.028125</code></pre>
<p>By default pmap() matches the elements of the list to the arguments in the function by position.</p>
<p>Instead of relying on this positional matching, a safer alternative is to provide names in our list. The name of each element should be the argument name we want to match it to.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Name the elements so they are read correctly</span>
<span class="kw">pmap</span>(<span class="kw">list</span>(<span class="dt">mean =</span> mu, <span class="dt">n =</span> n , <span class="dt">sd =</span> sd), rnorm)</code></pre></div>
<pre><code>## [[1]]
## [1] 0.9576075 0.9636535 1.0238025 1.0513216 1.2082554
## 
## [[2]]
##  [1] 3.185946 6.555173 5.636418 4.991143 6.161679 4.698976 4.847455
##  [8] 5.882055 4.035050 5.180936
## 
## [[3]]
##  [1] 10.185981 10.095582 10.090515 10.070867  9.965686  9.851724  9.991329
##  [8]  9.780453 10.113041 10.093998 10.227955  9.987986 10.035544  9.980724
## [15]  9.989603  9.911811  9.943535  9.954504  9.944317  9.955925</code></pre>
<p>Sometimes it’s not the arguments to a function you want to iterate over, but a set of functions themselves. Imagine that instead of varying the parameters to rnorm() we want to simulate from different distributions, say, using rnorm(), runif(), and rexp(). How do we iterate over calling these functions?</p>
<p>In purrr, this is handled by the invoke_map() function. The first argument is a list of functions. In our example, something like:</p>
<blockquote>
<p>f &lt;- list(“rnorm”, “runif”, “rexp”)</p>
</blockquote>
<p>The second argument specifies the arguments to the functions. In the simplest case, all the functions take the same argument, and we can specify it directly, relying on … to pass it to each function. In this case, call each function with the argument n = 5:</p>
<blockquote>
<p>invoke_map(f, n = 5)</p>
</blockquote>
<p>In more complicated cases, the functions may take different arguments, or we may want to pass different values to each function. In this case, we need to supply invoke_map() with a list, where each element specifies the arguments to the corresponding function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Define list of functions</span>
f &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;rnorm&quot;</span>, <span class="st">&quot;runif&quot;</span>, <span class="st">&quot;rexp&quot;</span>)

<span class="co"># Parameter list for rnorm()</span>
rnorm_params &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">mean =</span> <span class="dv">10</span>)

<span class="co"># Add a min element with value 0 and max element with value 5</span>
runif_params &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">min =</span><span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">5</span>)

<span class="co"># Add a rate element with value 5</span>
rexp_params &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">rate =</span> <span class="dv">5</span>)

<span class="co"># Define params for each function</span>
params &lt;-<span class="st"> </span><span class="kw">list</span>(
  rnorm_params,
  runif_params,
  rexp_params
)

<span class="co"># Call invoke_map() on f supplying params as the second argument</span>
<span class="kw">invoke_map</span>(f, params, <span class="dt">n =</span> <span class="dv">5</span>)</code></pre></div>
<pre><code>## [[1]]
## [1] 10.443370  8.959307 10.637096 10.571040  9.406870
## 
## [[2]]
## [1] 1.4220193 2.9846494 0.9510743 4.6481254 4.5609494
## 
## [[3]]
## [1] 0.32896695 0.36738067 0.06013094 0.12338600 0.11387700</code></pre>
</div>
<div id="side-effect-functions" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Side effect functions</h3>
<p>In R we have functions that are so called ‘side effect’ functions, for example saving files or producing plots. They don’t manipulate data per se. In purrr we have a function, walk(), which is designed for use with these side effect functions rather than map(). You can also walk over 2 or more functions, like map 2 and pmap we saw earlier. Walk can be used in pipe operations also.</p>
<p>First, let’s check that our simulated samples are in fact what we think they are by plotting a histogram for each one.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Define list of functions</span>
f &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">Normal =</span> <span class="st">&quot;rnorm&quot;</span>, <span class="dt">Uniform =</span> <span class="st">&quot;runif&quot;</span>, <span class="dt">Exp =</span> <span class="st">&quot;rexp&quot;</span>)

<span class="co"># Define params</span>
params &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">Normal =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="dv">10</span>),
  <span class="dt">Uniform =</span> <span class="kw">list</span>(<span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">5</span>),
  <span class="dt">Exp =</span> <span class="kw">list</span>(<span class="dt">rate =</span> <span class="dv">5</span>)
)

<span class="co"># Assign the simulated samples to sims</span>
sims &lt;-<span class="st"> </span><span class="kw">invoke_map</span>(f, params, <span class="dt">n =</span> <span class="dv">50</span>)

<span class="co"># Use walk() to make a histogram of each element in sims</span>
<span class="kw">walk</span>(sims, hist)</code></pre></div>
<p><img src="WritingFunctionsInR_files/figure-html/unnamed-chunk-38-1.png" width="672" /><img src="WritingFunctionsInR_files/figure-html/unnamed-chunk-38-2.png" width="672" /><img src="WritingFunctionsInR_files/figure-html/unnamed-chunk-38-3.png" width="672" /></p>
<p>We need better breaks for the bins on the x-axis. That means we need to vary two arguments to hist(): x and breaks. Remember map2()? That allowed us to iterate over two arguments. Guess what? There is a walk2(), too! Let’s use walk2() to improve those histograms with better breaks.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Replace &quot;Sturges&quot; with reasonable breaks for each sample</span>
breaks_list &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">Normal =</span> <span class="kw">seq</span>(<span class="dv">6</span>, <span class="dv">16</span>, <span class="fl">0.5</span>),
  <span class="dt">Uniform =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="fl">0.25</span>),
  <span class="dt">Exp =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">1.5</span>, <span class="fl">0.1</span>)
)

<span class="co"># Use walk2() to make histograms with the right breaks</span>
<span class="kw">walk2</span>(sims, breaks_list, hist)</code></pre></div>
<p><img src="WritingFunctionsInR_files/figure-html/unnamed-chunk-39-1.png" width="672" /><img src="WritingFunctionsInR_files/figure-html/unnamed-chunk-39-2.png" width="672" /><img src="WritingFunctionsInR_files/figure-html/unnamed-chunk-39-3.png" width="672" /></p>
<p>An extension of these hard coded break values for the bins, would be to use a function to calculate them whenever our data changes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Variable rather than hard coded range finder</span>

  find_breaks &lt;-<span class="st"> </span><span class="cf">function</span>(x){
    rng &lt;-<span class="st"> </span><span class="kw">range</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
    <span class="kw">seq</span>(rng[<span class="dv">1</span>], rng[<span class="dv">2</span>], <span class="dt">length.out =</span> <span class="dv">30</span>)
  }

<span class="co"># Call find_breaks() on sims[[1]]</span>
<span class="kw">find_breaks</span>(sims[[<span class="dv">1</span>]])</code></pre></div>
<pre><code>##  [1]  7.859287  7.995212  8.131137  8.267062  8.402987  8.538912  8.674837
##  [8]  8.810762  8.946687  9.082612  9.218537  9.354462  9.490387  9.626312
## [15]  9.762237  9.898162 10.034087 10.170012 10.305937 10.441862 10.577787
## [22] 10.713712 10.849637 10.985562 11.121487 11.257412 11.393337 11.529262
## [29] 11.665187 11.801112</code></pre>
<p>We can now use these breaks for our histograms.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Use map() to iterate find_breaks() over sims: nice_breaks</span>
nice_breaks &lt;-<span class="st"> </span><span class="kw">map</span>(sims, find_breaks)

<span class="co"># Use nice_breaks as the second argument to walk2()</span>
<span class="kw">walk2</span>(sims, nice_breaks, hist)</code></pre></div>
<p><img src="WritingFunctionsInR_files/figure-html/unnamed-chunk-41-1.png" width="672" /><img src="WritingFunctionsInR_files/figure-html/unnamed-chunk-41-2.png" width="672" /><img src="WritingFunctionsInR_files/figure-html/unnamed-chunk-41-3.png" width="672" /></p>
<p>Next we want to tidy the labels. We can use the … argument to any of the map() or walk() functions to pass in further arguments to the function .f. In this case, we might decide we don’t want any labels on the x-axis, in which case we need to pass an empty string to the xlab argument of hist():</p>
<blockquote>
<p>walk2(sims, nice_breaks, hist, xlab = “”)</p>
</blockquote>
<p>For the titles, we don’t want them to be the same for each plot. How can we iterate over the arguments x, breaks and main? There is a pwalk() function that works just like pmap().</p>
<p>Note that in the following example, xlab = “” is kept outside of the list of arguments being iterated over since it’s the same value for all three histograms.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Increase sample size to 1000</span>
sims &lt;-<span class="st"> </span><span class="kw">invoke_map</span>(f, params, <span class="dt">n =</span> <span class="dv">1000</span>)

<span class="co"># Compute nice_breaks (don&#39;t change this)</span>
nice_breaks &lt;-<span class="st"> </span><span class="kw">map</span>(sims, find_breaks)

<span class="co"># Create a vector nice_titles</span>
nice_titles &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="st">&quot;Normal(10, 1)&quot;</span>, 
  <span class="st">&quot;Uniform(0, 5)&quot;</span>, 
  <span class="st">&quot;Exp(5)&quot;</span>
  )

<span class="co"># Use pwalk() instead of walk2()</span>
<span class="kw">pwalk</span>(<span class="kw">list</span>(<span class="dt">x =</span> sims, <span class="dt">breaks =</span> nice_breaks, <span class="dt">main =</span> nice_titles), hist, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>)</code></pre></div>
<p><img src="WritingFunctionsInR_files/figure-html/unnamed-chunk-42-1.png" width="672" /><img src="WritingFunctionsInR_files/figure-html/unnamed-chunk-42-2.png" width="672" /><img src="WritingFunctionsInR_files/figure-html/unnamed-chunk-42-3.png" width="672" /></p>
<p>One of the nice things about the walk() functions is that they return the object you passed to them. This means they can easily be used in pipelines (a pipeline is just a short way of saying “a statement with lots of pipes”). WE can, for instance, calculate summary statistics as shown below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Pipe this along to map(), using summary() as .f</span>
sims <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">walk</span>(hist) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">map</span>(summary)</code></pre></div>
<p><img src="WritingFunctionsInR_files/figure-html/unnamed-chunk-43-1.png" width="672" /><img src="WritingFunctionsInR_files/figure-html/unnamed-chunk-43-2.png" width="672" /><img src="WritingFunctionsInR_files/figure-html/unnamed-chunk-43-3.png" width="672" /></p>
<pre><code>## $Normal
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   6.544   9.387   9.972  10.010  10.684  13.890 
## 
## $Uniform
##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## 0.000235 1.230563 2.507549 2.525777 3.772409 4.999888 
## 
## $Exp
##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
## 0.0001179 0.0636020 0.1467002 0.2097436 0.2804284 1.5812353</code></pre>
</div>
</div>
<div id="robust-functions" class="section level2">
<h2><span class="header-section-number">3.5</span> Robust Functions</h2>
<p>Robust functions either work or give error messages that can be understood. R is both an interactive analytical environment (helpful) and programming environment (strict). Interactive functions are designed to iterate over things quickly to help with analysis, the programming/robust functions on the other hand want to get things right. Interactive functions try to guess at the type of things you want to achieve, which can cause problems later on. There are 3 main types of problem functions:</p>
<ol style="list-style-type: decimal">
<li>TYpe-unstable functions - they return different types of things. For example, with one type of input they might return a vector, but with another type they return a dataframe or a matrix.<br />
</li>
<li>Non standard evaluation - ‘an important part of R’s magic’ says Hadley. It allows you to use succinct APIs like ggplot and dpylr, but it can introduce ambiguity when programming</li>
<li>Hidden arguments - R has global options that can affect the operation of some functions. The most notorious of these are strings as factors.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Define troublesome x and y</span>
x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>)
y &lt;-<span class="st"> </span><span class="kw">c</span>( <span class="dv">1</span>, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>)

both_na &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {
  <span class="co"># Add stopifnot() to check length of x and y</span>
  <span class="kw">stopifnot</span>(<span class="kw">length</span>(x) <span class="op">==</span><span class="st"> </span><span class="kw">length</span>(y))
  <span class="kw">sum</span>(<span class="kw">is.na</span>(x) <span class="op">&amp;</span><span class="st"> </span><span class="kw">is.na</span>(y))
}

<span class="co"># Call both_na() on x and y</span>
<span class="kw">both_na</span>(x, y)</code></pre></div>
<p>We might want a more informative error message. To do so, we use the stop() rather than the stopifnot() function, which has more options including specifying the error message.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Define troublesome x and y</span>
x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>)
y &lt;-<span class="st"> </span><span class="kw">c</span>( <span class="dv">1</span>, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>)

both_na &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {
    <span class="cf">if</span> (<span class="kw">length</span>(x) <span class="op">!=</span><span class="st"> </span><span class="kw">length</span>(y)) {
    <span class="kw">stop</span>(<span class="st">&quot;x and y must have the same length&quot;</span>, <span class="dt">call. =</span> <span class="ot">FALSE</span>)
  }  
  <span class="kw">sum</span>(<span class="kw">is.na</span>(x) <span class="op">&amp;</span><span class="st"> </span><span class="kw">is.na</span>(y))
}

<span class="co"># Call both_na() </span>
<span class="kw">both_na</span>(x, y)</code></pre></div>
<div id="unstable-types" class="section level3">
<h3><span class="header-section-number">3.5.1</span> Unstable types</h3>
<p>An unstable type is a function whose output can’t be known without being fully aware of what it’s inputs are. They can be hard to program with, since you need to write cases which handle all the different input types. Most of the time this doesn’t matter, but problems can arise when type inconsistent functions are burried within your own functions.</p>
<p>Where possible you should try to avoid writing type unstable functions. The first step in this is to avoid using such functions inside your own functions, which comes from knowing what the common type-inconsistent functions are e.g. sapply. You also need to know a set of type consistent functions that can be used, which include those from the purrr package.</p>
</div>
<div id="non-standard-evaluation-nse" class="section level3">
<h3><span class="header-section-number">3.5.2</span> Non standard evaluation (NSE)</h3>
<p>These are functions that don’t use the usual lookup rules. One example is the subset function, which takes a dataset then a control function, such as disp &gt; 400, to subset the data e.g. subset(mtcars, disp &gt; 400). Because disp only exists within the mtcars data frame, we can only evaluation disp &gt; 400 inside the mtcars data, not in the global environment. Non standard evaulation functions are great as they can save a lot of typing, but they can cause problems inside your own functions.</p>
<p>Another example of NSE is within ggplot, where we can call a data frame initially, but don’t have to apply the $ sign notation for all the aesthetic mappings within the ggplot call, we only need to specify the data frame once. Dplyr also has a number of NSE functions. BUT these functions can call objects from the global enironment also, for instance a grid search / control object or vector for ML can be called within a model (e.g. caret package). These speed benefits can make programming with such functions difficult.</p>
<p>To get around NSE, you can avoid using them in your own functions, or try to protect against where they cause problems. As within unstable types, the majority of the time (95%) such things may not cause problems and it is the edge cases we need to be aware of.</p>
<p>More information is available in <a href="http://rpubs.com/hadley/157957">Hadley’s NSE vignette</a>.</p>
<p>For example, if we had the following NSE function (filter from dplyr) within our own function</p>
<blockquote>
<p>big_x &lt;- function(df, threshold) { dplyr::filter(df, x &gt; threshold) }</p>
</blockquote>
<p>There are two ways this could fail</p>
<ol style="list-style-type: decimal">
<li>The x column doesn’t exist in df - but may exist in the global environment, causing the function to find a value there</li>
<li>There is a threshold column in df - causing dplyr to look inside the dataframe first and finding the incorrect value, rather our desired value as an argument to the custom/user defined function.</li>
</ol>
<p>We could we write our function previously outlined with stop controls to handle these two instances.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">big_x &lt;-<span class="st"> </span><span class="cf">function</span>(df, threshold) {
  <span class="co"># Write a check for x not being in df</span>
  <span class="cf">if</span> (<span class="op">!</span><span class="st">&quot;x&quot;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">names</span>(df)) {
    <span class="kw">stop</span>(<span class="st">&quot;df must contain variable called x&quot;</span>, <span class="dt">call. =</span> <span class="ot">FALSE</span>)
  } 
  
  <span class="co"># Write a check for threshold being in df</span>
  <span class="cf">if</span> (<span class="st">&quot;threshold&quot;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">names</span>(df)) {
    <span class="kw">stop</span>(<span class="st">&quot;df must not contain variable called threshold&quot;</span>, <span class="dt">call. =</span> <span class="ot">FALSE</span>)
  }
  
  dplyr<span class="op">::</span><span class="kw">filter</span>(df, x <span class="op">&gt;</span><span class="st"> </span>threshold)
}</code></pre></div>
</div>
<div id="hidden-arguments" class="section level3">
<h3><span class="header-section-number">3.5.3</span> Hidden arguments</h3>
<p>Pure functions only have outputs that depend on their inputs and also don’t affect the outside world, except through their return value.</p>
<p>Hidden arguments are function inputs that may be different for different users or sessions. This can commonly occur when argument defaults depend on global options. You can view global options in R by typing options(). Some packages can change their options, they can vary dependent on the OS or other custom user defined setups. Such options include the number of digits to be displayed, how warning and error messages are handled and what to do with missing values. The help page provides more information ?options.</p>
<p>A classic example of a hidden dependence is the stringsAsFactors argument to the read.csv() function (and a few other data frame functions.)</p>
<p>When you see the following code, you don’t know exactly what the result will be:</p>
<blockquote>
<p>pools &lt;- read.csv(“swimming_pools.csv”)</p>
</blockquote>
<p>That’s because if the argument stringsAsFactors isn’t specified, it inherits its value from getOption(“stringsAsFactors”), a global option that a user may change.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="references.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="joining-data-in-r-with-dplyr.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["Study-Notes.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
