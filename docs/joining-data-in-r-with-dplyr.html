<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Study notes</title>
  <meta name="description" content="Study notes taken from courses and self learning.">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="Study notes" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://github.com/James-SR/study-notes-master" />
  
  <meta property="og:description" content="Study notes taken from courses and self learning." />
  <meta name="github-repo" content="James-SR/study-notes-master" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Study notes" />
  
  <meta name="twitter:description" content="Study notes taken from courses and self learning." />
  

<meta name="author" content="James Solomon-Rounce">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="references.html">
<link rel="next" href="cleaning-data.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Study Notes</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="importing-data-part-1.html"><a href="importing-data-part-1.html"><i class="fa fa-check"></i><b>1</b> Importing data - Part 1</a><ul>
<li class="chapter" data-level="1.1" data-path="importing-data-part-1.html"><a href="importing-data-part-1.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="importing-data-part-1.html"><a href="importing-data-part-1.html#reading-csv-files"><i class="fa fa-check"></i><b>1.2</b> Reading CSV files</a></li>
<li class="chapter" data-level="1.3" data-path="importing-data-part-1.html"><a href="importing-data-part-1.html#reading-tab-deliminated-files-or-other-table-formats"><i class="fa fa-check"></i><b>1.3</b> Reading tab deliminated files or other table formats</a></li>
<li class="chapter" data-level="1.4" data-path="importing-data-part-1.html"><a href="importing-data-part-1.html#readr-and-data.table"><i class="fa fa-check"></i><b>1.4</b> Readr and data.table</a><ul>
<li class="chapter" data-level="1.4.1" data-path="importing-data-part-1.html"><a href="importing-data-part-1.html#data.table-fread"><i class="fa fa-check"></i><b>1.4.1</b> data.table fread</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="importing-data-part-1.html"><a href="importing-data-part-1.html#reading-excel-files"><i class="fa fa-check"></i><b>1.5</b> Reading Excel files</a><ul>
<li class="chapter" data-level="1.5.1" data-path="importing-data-part-1.html"><a href="importing-data-part-1.html#alternatives-for-importing-excel-files"><i class="fa fa-check"></i><b>1.5.1</b> Alternatives for importing Excel files</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="importing-data-part-1.html"><a href="importing-data-part-1.html#xlconnect---read-and-write-to-excel"><i class="fa fa-check"></i><b>1.6</b> XLConnect - read and write to excel</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="importing-data-part-2.html"><a href="importing-data-part-2.html"><i class="fa fa-check"></i><b>2</b> Importing data - Part 2</a><ul>
<li class="chapter" data-level="2.1" data-path="importing-data-part-2.html"><a href="importing-data-part-2.html#importing-from-databases---1"><i class="fa fa-check"></i><b>2.1</b> Importing from Databases - 1</a></li>
<li class="chapter" data-level="2.2" data-path="importing-data-part-2.html"><a href="importing-data-part-2.html#sql-queries-inside-r"><i class="fa fa-check"></i><b>2.2</b> SQL Queries Inside R</a></li>
<li class="chapter" data-level="2.3" data-path="importing-data-part-2.html"><a href="importing-data-part-2.html#web-data"><i class="fa fa-check"></i><b>2.3</b> Web Data</a></li>
<li class="chapter" data-level="2.4" data-path="importing-data-part-2.html"><a href="importing-data-part-2.html#json-and-apis"><i class="fa fa-check"></i><b>2.4</b> JSON and APIs</a></li>
<li class="chapter" data-level="2.5" data-path="importing-data-part-2.html"><a href="importing-data-part-2.html#importing-from-other-statistical-software"><i class="fa fa-check"></i><b>2.5</b> Importing from other statistical software</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="3" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html"><i class="fa fa-check"></i><b>3</b> Joining Data in R with dplyr</a><ul>
<li class="chapter" data-level="3.1" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#mutating-joins"><i class="fa fa-check"></i><b>3.1</b> Mutating joins</a><ul>
<li class="chapter" data-level="3.1.1" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#keys"><i class="fa fa-check"></i><b>3.1.1</b> Keys</a></li>
<li class="chapter" data-level="3.1.2" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#left-and-right-joins"><i class="fa fa-check"></i><b>3.1.2</b> Left and right joins</a></li>
<li class="chapter" data-level="3.1.3" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#inner-and-full-joins"><i class="fa fa-check"></i><b>3.1.3</b> Inner and full joins</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#filtering-joins-and-set-operations"><i class="fa fa-check"></i><b>3.2</b> Filtering joins and set operations</a></li>
<li class="chapter" data-level="3.3" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#set-operations"><i class="fa fa-check"></i><b>3.3</b> Set Operations</a></li>
<li class="chapter" data-level="3.4" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#bind-in-dplyr"><i class="fa fa-check"></i><b>3.4</b> Bind in Dplyr</a><ul>
<li class="chapter" data-level="3.4.1" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#data-frames"><i class="fa fa-check"></i><b>3.4.1</b> Data frames</a></li>
<li class="chapter" data-level="3.4.2" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#data-types"><i class="fa fa-check"></i><b>3.4.2</b> Data Types</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#advanced-joining"><i class="fa fa-check"></i><b>3.5</b> Advanced Joining</a></li>
<li class="chapter" data-level="3.6" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#joining-mutiple-tables"><i class="fa fa-check"></i><b>3.6</b> Joining mutiple tables</a></li>
<li class="chapter" data-level="3.7" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#other-implentations"><i class="fa fa-check"></i><b>3.7</b> Other implentations</a></li>
<li class="chapter" data-level="3.8" data-path="joining-data-in-r-with-dplyr.html"><a href="joining-data-in-r-with-dplyr.html#case-study---lahman-db"><i class="fa fa-check"></i><b>3.8</b> Case Study - Lahman DB</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cleaning-data.html"><a href="cleaning-data.html"><i class="fa fa-check"></i><b>4</b> Cleaning Data</a><ul>
<li class="chapter" data-level="4.1" data-path="cleaning-data.html"><a href="cleaning-data.html#tidying-data"><i class="fa fa-check"></i><b>4.1</b> Tidying data</a></li>
<li class="chapter" data-level="4.2" data-path="cleaning-data.html"><a href="cleaning-data.html#preparing-data-for-analysis"><i class="fa fa-check"></i><b>4.2</b> Preparing data for analysis</a></li>
<li class="chapter" data-level="4.3" data-path="cleaning-data.html"><a href="cleaning-data.html#string-manipulation"><i class="fa fa-check"></i><b>4.3</b> String manipulation</a></li>
<li class="chapter" data-level="4.4" data-path="cleaning-data.html"><a href="cleaning-data.html#missing-specials-and-outliers"><i class="fa fa-check"></i><b>4.4</b> Missing, Specials and Outliers</a></li>
<li class="chapter" data-level="4.5" data-path="cleaning-data.html"><a href="cleaning-data.html#examples"><i class="fa fa-check"></i><b>4.5</b> Examples</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="importing-cleaning-data-in-r-case-studies.html"><a href="importing-cleaning-data-in-r-case-studies.html"><i class="fa fa-check"></i><b>5</b> Importing &amp; Cleaning Data in R: Case Studies</a><ul>
<li class="chapter" data-level="5.1" data-path="importing-cleaning-data-in-r-case-studies.html"><a href="importing-cleaning-data-in-r-case-studies.html#ticket-sales-data"><i class="fa fa-check"></i><b>5.1</b> Ticket Sales Data</a><ul>
<li class="chapter" data-level="5.1.1" data-path="importing-cleaning-data-in-r-case-studies.html"><a href="importing-cleaning-data-in-r-case-studies.html#removing-redundant-info"><i class="fa fa-check"></i><b>5.1.1</b> Removing redundant info</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="importing-cleaning-data-in-r-case-studies.html"><a href="importing-cleaning-data-in-r-case-studies.html#working-with-dates"><i class="fa fa-check"></i><b>5.2</b> Working with dates</a></li>
<li class="chapter" data-level="5.3" data-path="importing-cleaning-data-in-r-case-studies.html"><a href="importing-cleaning-data-in-r-case-studies.html#mbta-ridership-data"><i class="fa fa-check"></i><b>5.3</b> MBTA Ridership Data</a></li>
<li class="chapter" data-level="5.4" data-path="importing-cleaning-data-in-r-case-studies.html"><a href="importing-cleaning-data-in-r-case-studies.html#world-food-facts"><i class="fa fa-check"></i><b>5.4</b> World Food Facts</a></li>
<li class="chapter" data-level="5.5" data-path="importing-cleaning-data-in-r-case-studies.html"><a href="importing-cleaning-data-in-r-case-studies.html#school-attendance-data"><i class="fa fa-check"></i><b>5.5</b> School Attendance Data</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="introduction-to-data.html"><a href="introduction-to-data.html"><i class="fa fa-check"></i><b>6</b> Introduction to Data</a><ul>
<li class="chapter" data-level="6.1" data-path="introduction-to-data.html"><a href="introduction-to-data.html#language-of-data"><i class="fa fa-check"></i><b>6.1</b> Language of Data</a></li>
<li class="chapter" data-level="6.2" data-path="introduction-to-data.html"><a href="introduction-to-data.html#observational-studies-and-experiments"><i class="fa fa-check"></i><b>6.2</b> Observational Studies and Experiments</a></li>
<li class="chapter" data-level="6.3" data-path="introduction-to-data.html"><a href="introduction-to-data.html#sampling-strategies-and-experimental-design"><i class="fa fa-check"></i><b>6.3</b> Sampling strategies and experimental design</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="7" data-path="foundations-of-inference.html"><a href="foundations-of-inference.html"><i class="fa fa-check"></i><b>7</b> Foundations of Inference</a><ul>
<li class="chapter" data-level="7.1" data-path="foundations-of-inference.html"><a href="foundations-of-inference.html#introduction-to-inference"><i class="fa fa-check"></i><b>7.1</b> Introduction to Inference</a></li>
<li class="chapter" data-level="7.2" data-path="foundations-of-inference.html"><a href="foundations-of-inference.html#home-ownership-by-gender"><i class="fa fa-check"></i><b>7.2</b> Home Ownership by Gender</a></li>
<li class="chapter" data-level="7.3" data-path="foundations-of-inference.html"><a href="foundations-of-inference.html#density-plots"><i class="fa fa-check"></i><b>7.3</b> Density Plots</a></li>
<li class="chapter" data-level="7.4" data-path="foundations-of-inference.html"><a href="foundations-of-inference.html#gender-discrimination-p-values"><i class="fa fa-check"></i><b>7.4</b> Gender Discrimination (p-values)</a></li>
<li class="chapter" data-level="7.5" data-path="foundations-of-inference.html"><a href="foundations-of-inference.html#opportunity-cost"><i class="fa fa-check"></i><b>7.5</b> Opportunity Cost</a></li>
<li class="chapter" data-level="7.6" data-path="foundations-of-inference.html"><a href="foundations-of-inference.html#type-i-and-type-ii-errors"><i class="fa fa-check"></i><b>7.6</b> Type I and Type II errors</a></li>
<li class="chapter" data-level="7.7" data-path="foundations-of-inference.html"><a href="foundations-of-inference.html#bootstrapping"><i class="fa fa-check"></i><b>7.7</b> Bootstrapping</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-2.html"><a href="references-2.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="8" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>8</b> Exploratory Data Analysis</a><ul>
<li class="chapter" data-level="8.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#categorical-data"><i class="fa fa-check"></i><b>8.1</b> Categorical Data</a></li>
<li class="chapter" data-level="8.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#numerical-data"><i class="fa fa-check"></i><b>8.2</b> Numerical Data</a></li>
<li class="chapter" data-level="8.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#numerical-summaries"><i class="fa fa-check"></i><b>8.3</b> Numerical Summaries</a><ul>
<li class="chapter" data-level="8.3.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#transformations"><i class="fa fa-check"></i><b>8.3.1</b> Transformations</a></li>
<li class="chapter" data-level="8.3.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#outliers"><i class="fa fa-check"></i><b>8.3.2</b> Outliers</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#email-case-study"><i class="fa fa-check"></i><b>8.4</b> Email Case Study</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html"><i class="fa fa-check"></i><b>9</b> Correlation and Regression</a><ul>
<li class="chapter" data-level="9.1" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#visualizing-two-variables"><i class="fa fa-check"></i><b>9.1</b> Visualizing two variables</a><ul>
<li class="chapter" data-level="9.1.1" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#transformations-1"><i class="fa fa-check"></i><b>9.1.1</b> Transformations</a></li>
<li class="chapter" data-level="9.1.2" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#identifying-outliers"><i class="fa fa-check"></i><b>9.1.2</b> Identifying Outliers</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#correlation"><i class="fa fa-check"></i><b>9.2</b> Correlation</a><ul>
<li class="chapter" data-level="9.2.1" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#anscombe-dataset"><i class="fa fa-check"></i><b>9.2.1</b> Anscombe Dataset</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#linear-regression"><i class="fa fa-check"></i><b>9.3</b> Linear Regression</a><ul>
<li class="chapter" data-level="9.3.1" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#regression-to-the-mean"><i class="fa fa-check"></i><b>9.3.1</b> Regression to the Mean</a></li>
<li class="chapter" data-level="9.3.2" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#fitting-linear-models"><i class="fa fa-check"></i><b>9.3.2</b> Fitting linear models</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#model-fit"><i class="fa fa-check"></i><b>9.4</b> Model fit</a><ul>
<li class="chapter" data-level="9.4.1" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#unusual-points"><i class="fa fa-check"></i><b>9.4.1</b> Unusual points</a></li>
<li class="chapter" data-level="9.4.2" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#high-leverage-points"><i class="fa fa-check"></i><b>9.4.2</b> High leverage Points</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="supervised-learning.html"><a href="supervised-learning.html"><i class="fa fa-check"></i><b>10</b> Supervised Learning</a><ul>
<li class="chapter" data-level="10.1" data-path="supervised-learning.html"><a href="supervised-learning.html#tree-based-models"><i class="fa fa-check"></i><b>10.1</b> Tree Based Models</a><ul>
<li class="chapter" data-level="10.1.1" data-path="supervised-learning.html"><a href="supervised-learning.html#random-forests"><i class="fa fa-check"></i><b>10.1.1</b> Random Forests</a></li>
<li class="chapter" data-level="10.1.2" data-path="supervised-learning.html"><a href="supervised-learning.html#one-hot-encoding-categorical-variables"><i class="fa fa-check"></i><b>10.1.2</b> One-Hot-Encoding Categorical Variables</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="supervised-learning.html"><a href="supervised-learning.html#gradient-boosting-machines"><i class="fa fa-check"></i><b>10.2</b> Gradient Boosting Machines</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="dimensional-modelling.html"><a href="dimensional-modelling.html"><i class="fa fa-check"></i><b>11</b> Dimensional Modelling</a><ul>
<li class="chapter" data-level="11.1" data-path="dimensional-modelling.html"><a href="dimensional-modelling.html#introduction-to-dimensional-data"><i class="fa fa-check"></i><b>11.1</b> Introduction to Dimensional Data</a><ul>
<li class="chapter" data-level="11.1.1" data-path="dimensional-modelling.html"><a href="dimensional-modelling.html#data-modelling-levels"><i class="fa fa-check"></i><b>11.1.1</b> Data Modelling levels</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="dimensional-modelling.html"><a href="dimensional-modelling.html#architecture-considerations"><i class="fa fa-check"></i><b>11.2</b> Architecture considerations</a></li>
<li class="chapter" data-level="11.3" data-path="dimensional-modelling.html"><a href="dimensional-modelling.html#graphical-representations"><i class="fa fa-check"></i><b>11.3</b> Graphical Representations</a></li>
<li class="chapter" data-level="11.4" data-path="dimensional-modelling.html"><a href="dimensional-modelling.html#kimball-approach"><i class="fa fa-check"></i><b>11.4</b> Kimball Approach</a></li>
<li class="chapter" data-level="11.5" data-path="dimensional-modelling.html"><a href="dimensional-modelling.html#four-step-dimensional-design-process"><i class="fa fa-check"></i><b>11.5</b> Four-Step Dimensional Design Process</a></li>
<li class="chapter" data-level="11.6" data-path="dimensional-modelling.html"><a href="dimensional-modelling.html#tips"><i class="fa fa-check"></i><b>11.6</b> Tips</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-3.html"><a href="references-3.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Study notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="joining-data-in-r-with-dplyr" class="section level1">
<h1><span class="header-section-number">3</span> Joining Data in R with dplyr</h1>
<hr />
<p>Notes taken during/inspired by the Datacamp course ‘Joining Data in R with dplyr’ by Garrett Grolemund.</p>
<p>Other useful info:</p>
<ul>
<li><a href="http://r4ds.had.co.nz/">R for Data Science Book</a></li>
<li><a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">Data Wrangling Cheatsheet</a></li>
<li><a href="https://cran.r-project.org/web/packages/dplyr/vignettes/two-table.html">dplyr two table verbs vignette</a></li>
<li><a href="https://cran.r-project.org/web/packages/dbplyr/vignettes/dbplyr.html">dbplyr vignette</a></li>
</ul>
<p>Course Slides:</p>
<ul>
<li><a href="https://s3.amazonaws.com/assets.datacamp.com/production/course_1074/slides/ch1-pdf.pdf">Part1 - Mutating Joins</a></li>
<li><a href="https://s3.amazonaws.com/assets.datacamp.com/production/course_1074/slides/ch2-pdf.pdf">Part2 - Filtering joins and set operations</a></li>
<li><a href="https://s3.amazonaws.com/assets.datacamp.com/production/course_1074/slides/ch3-pdf.pdf">Part3 - Assembling data</a></li>
<li><a href="https://s3.amazonaws.com/assets.datacamp.com/production/course_1074/slides/ch4-pdf.pdf">Part4 - Advanced joining</a></li>
<li><a href="https://s3.amazonaws.com/assets.datacamp.com/production/course_1074/slides/ch5-pdf.pdf">Part5 - Case Study</a></li>
</ul>
<div id="mutating-joins" class="section level2">
<h2><span class="header-section-number">3.1</span> Mutating joins</h2>
<p>Data is best used in R when in a single data table. This course introduces a number of techniques to achieve this. Dplyr also has connectors to a range of different databases, so can be used to both extract and manipulate data in databases.</p>
<div id="keys" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Keys</h3>
<p>We often want to join two tables together, adding a set of values or variables from a second table(s). For this to happen, we need a key, whereby we have a key in the initial table (a primary key) that is uniquely identifies rows in that within that table or dataset (we don’t have duplicates) and we then use this key to add in data from a secondary table (the foreign key to that table). The foreign key in the secondary table may be duplicated or not appear at all. Sometimes no single variable acts as a primary key in a dataset. Instead, it takes a combination of variables to uniquely identify each row, for example a table of addresses with different columns representing sections of the address - house number, street name, postcode/zip code.</p>
<p>When working with dplyr, it works with the following tables for the purposes of joining data</p>
<ul>
<li><strong>Tables</strong> in dplyr are one of the following:</li>
<li><strong>data frames</strong></li>
<li><strong>tibbles (tbl_df)</strong> - similar to data frame but only what fits in to your R console window will be displayed but you can use View() all the table if needed</li>
<li><strong>tbl references</strong></li>
</ul>
<div class="figure">
<img src="images/DplyrJoins.png" alt="Joins available in Dplyr"  />
<p class="caption">
(#fig:Dplyr Joins)Joins available in Dplyr
</p>
</div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
</div>
<div id="left-and-right-joins" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Left and right joins</h3>
<p>left_join() is the basic join function in dplyr. You can use it whenever you want to augment a data frame with information from another data frame.</p>
<p>For example, left_join(x, y) joins y to x. The second dataset you specify is joined to the first dataset. In right_join() the order of the datasets reversed</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Join artists to bands</span>
bands2 &lt;-<span class="st"> </span><span class="kw">left_join</span>(bands, artists, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;first&quot;</span>, <span class="st">&quot;last&quot;</span>))

<span class="co"># Examine the results</span>
bands2

<span class="co"># Recreate bands3 with a right join</span>
bands2 &lt;-<span class="st"> </span><span class="kw">left_join</span>(bands, artists, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;first&quot;</span>, <span class="st">&quot;last&quot;</span>))
bands3 &lt;-<span class="st"> </span><span class="kw">right_join</span>(artists, bands, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;first&quot;</span>, <span class="st">&quot;last&quot;</span>))

<span class="co"># Check that bands3 is equal to bands2</span>
<span class="kw">setequal</span>(bands2, bands3)</code></pre></div>
</div>
<div id="inner-and-full-joins" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Inner and full joins</h3>
<p>Left_join and right_join are half of a class of ‘mutating joins’ with the name coming from dplyrs mutate() function which returns a copy of the dataset with one or more columns of the data added to it. The other two functions are:</p>
<ul>
<li><strong>inner_join</strong>: only retains rows from both/all datasets</li>
<li><strong>full_join</strong>: retains any row from both/any data set</li>
<li><strong>%&gt;%</strong>: Can be used to string joins or other functions together</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create goal2 using full_join() and inner_join() </span>
goal2 &lt;-<span class="st"> </span>artists <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">full_join</span>(bands, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;first&quot;</span>,<span class="st">&quot;last&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inner_join</span>(songs, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;first&quot;</span>,<span class="st">&quot;last&quot;</span>))

<span class="co"># Create one table that combines all information</span>
artists <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">full_join</span>(bands, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;first&quot;</span>,<span class="st">&quot;last&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">full_join</span>(songs, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;first&quot;</span>,<span class="st">&quot;last&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">full_join</span>(albums, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;album&quot;</span>, <span class="st">&quot;band&quot;</span>))</code></pre></div>
</div>
</div>
<div id="filtering-joins-and-set-operations" class="section level2">
<h2><span class="header-section-number">3.2</span> Filtering joins and set operations</h2>
<p>Filtering joins returns a copy of the origianl data set rather than an augmented version of the original dataset.</p>
<div class="figure">
<img src="images/FilteringJoins.png" alt="Filtering and Mutating Joins"  />
<p class="caption">
(#fig:Filtering Joins)Filtering and Mutating Joins
</p>
</div>
<p>Semi_join() is one of the filtering join functions, it can be used to check which rows in one table match the rows in another table, perhaps before a mutating join. Semi_join is sometimes easier than many seperate functions together, for instance</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># View the output of semi_join()</span>
artists <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">semi_join</span>(songs, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;first&quot;</span>, <span class="st">&quot;last&quot;</span>))

<span class="co"># Create the same result</span>
artists <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">right_join</span>(songs, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;first&quot;</span>, <span class="st">&quot;last&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(instrument)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(first, last, instrument) </code></pre></div>
<p>Semi-joins provide a useful way to explore the connections between multiple tables of data.</p>
<p>For example, you can use a semi-join to determine the number of albums in the albums dataset that were made by a band in the bands dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">albums <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Collect the albums made by a band</span>
<span class="st">  </span><span class="kw">semi_join</span>(bands, <span class="dt">by =</span> <span class="st">&quot;band&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Count the albums made by a band</span>
<span class="st">  </span><span class="kw">nrow</span>()</code></pre></div>
<p>Anti-joins shows records which are in the primary table but do not have matches in the second data table. This can be useful for checking spelling or key value errors.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Return rows of artists that don&#39;t have bands info</span>
artists <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">anti_join</span>(bands, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;first&quot;</span>, <span class="st">&quot;last&quot;</span>))

<span class="co"># Check whether album names in labels are mis-entered</span>
labels <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">anti_join</span>(albums, <span class="dt">by =</span> <span class="st">&quot;album&quot;</span>)</code></pre></div>
<p>Joins can also be used to count the number of records.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Determine which key joins labels and songs</span>
labels
songs

songs <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Find the rows of songs that match a row in labels</span>
<span class="st">  </span><span class="kw">semi_join</span>(labels, <span class="dt">by =</span> <span class="st">&quot;album&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Number of matches between labels and songs</span>
<span class="st">  </span><span class="kw">nrow</span>()</code></pre></div>
</div>
<div id="set-operations" class="section level2">
<h2><span class="header-section-number">3.3</span> Set Operations</h2>
<p>When two datasets contain the same variables, it can be useful to combine the datasets with set operations (rather than joins). The three set operations can be used to combine observations from two datasets in to a single dataset.</p>
<div class="figure">
<img src="images/SetOps.png" alt="Set Operations"  />
<p class="caption">
(#fig:Set Ops)Set Operations
</p>
</div>
<p>For instance we can count the number of unique songs in two data tables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Import files</span>
aerosmith &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;C:/Users/DEsktop/Nextcloud/Documents/2017/RData/aerosmith.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
greatest_hits &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;C:/Users/DEsktop/Nextcloud/Documents/2017/RData/greatest_hits.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

aerosmith <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Create the new dataset using a set operation</span>
<span class="st">  </span><span class="kw">union</span>(greatest_hits) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Count the total number of songs</span>
<span class="st">  </span><span class="kw">nrow</span>()</code></pre></div>
<pre><code>## [1] 24</code></pre>
<p>Or use it to see which is in both (where the dataset has the exact same variables) - this is similar to the semi_join function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create the new dataset using a set operation</span>
aerosmith <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">intersect</span>(greatest_hits)</code></pre></div>
<pre><code>##       song length
## 1 Dream On   4:28</code></pre>
<p>Or use it to identify which are in one dataset but not the other. Here, we also match on just the variable we are interested in that matches across both datasets.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Import file</span>
live &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;C:/Users/DEsktop/Nextcloud/Documents/2017/RData/live.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

<span class="co"># Select the song names from live</span>
live_songs &lt;-<span class="st"> </span>live <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(song)

<span class="co"># Select the song names from greatest_hits</span>
greatest_songs &lt;-<span class="st"> </span>greatest_hits <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(song)

<span class="co"># Create the new dataset using a set operation - songs in live that are not in greatest_hits</span>
live_songs <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">setdiff</span>(greatest_songs)</code></pre></div>
<pre><code>##                                          song
## 1                          Lord of the Thighs
## 2                           Toys in the Attic
## 3                               Sick as a Dog
## 4                         Sight for Sore Eyes
## 5                            S.O.S. (Too Bad)
## 6                             I Ain&#39;t Got You
## 7                Mother Popcorn/Draw the Line
## 8 Train Kept A-Rollin&#39;/Strangers in the Night</code></pre>
<p>There is no set operation to find rows that appear in one data frame or another, but not both. However, you can accomplish this by combining set operators.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">live_songs &lt;-<span class="st"> </span>live <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(song)
greatest_songs &lt;-<span class="st"> </span>greatest_hits <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(song)

<span class="co"># Return the songs that only exist in one dataset</span>
live_songs <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">setdiff</span>(greatest_songs) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">union</span>(greatest_songs <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">setdiff</span>(live_songs))</code></pre></div>
<pre><code>##                                           song
## 1                                Sick as a Dog
## 2                            Seasons of Winter
## 3                      Same Old Song and Dance
## 4                            Toys in the Attic
## 5                              I Ain&#39;t Got You
## 6                 Mother Popcorn/Draw the Line
## 7                           Lord of the Thighs
## 8                            Lightning Strikes
## 9                        One Way Street (live)
## 10 Train Kept A-Rollin&#39;/Strangers in the Night
## 11              Remember (Walking in the Sand)
## 12                       Sweet Emotion (remix)
## 13                            S.O.S. (Too Bad)
## 14                            Kings and Queens
## 15                         Sight for Sore Eyes
## 16                         Big Ten Inch Record
## 17                               Draw the Line</code></pre>
<p><strong>Note</strong>: The union() function removes duplicate rows, even if a duplicate is desired (perhaps a different record such as someone with the same name).</p>
<p>Its common to want to know if one data set is the same as another dataset dplyr’s setequal will do this easily base R’s identical is will only return true if the datasets have the exact same rows in the exact same order Recap:</p>
<ul>
<li>Mutating Joins: <em>left_join </em>right_join <em>inner_join </em>full_join</li>
</ul>
<p><em>Filtering Joins: </em>semi_join *anti_join</p>
<p><em>Set Operations: </em>union <em>intersect </em>setdiff</p>
<p><em>Comparisions: </em>setequal</p>
<p>The definitive and complete contain the songs that appear in competing Led Zeppelin anthologies: The Definitive Collection and The Complete Studio Recordings, respectively.</p>
<p>Both anthologies claim to contain the complete studio recordings of Led Zeppelin, but do the anthologies contain the same exact songs?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Import files</span>
complete &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;C:/Users/DEsktop/Nextcloud/Documents/2017/RData/complete.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
definitive &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;C:/Users/DEsktop/Nextcloud/Documents/2017/RData/definitive.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

<span class="co"># Check if same order: definitive and complete</span>
<span class="kw">identical</span>(definitive, complete)</code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Check if any order: definitive and complete</span>
<span class="kw">setequal</span>(definitive, complete)</code></pre></div>
<pre><code>## FALSE: Different number of rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Songs in definitive but not complete</span>
complete <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">setdiff</span>(definitive)</code></pre></div>
<pre><code>## [1] song  album
## &lt;0 rows&gt; (or 0-length row.names)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Songs in complete but not definitive</span>
definitive <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setdiff</span>(complete)</code></pre></div>
<pre><code>##                           song                     album
## 1                Rock and Roll The Song Remains the Same
## 2              Celebration Day The Song Remains the Same
## 3                    Black Dog The Song Remains the Same
## 4  Over the Hills and Far Away The Song Remains the Same
## 5           Misty Mountain Hop The Song Remains the Same
## 6   Since I&#39;ve Been Loving You The Song Remains the Same
## 7                   No Quarter The Song Remains the Same
## 8    The Song Remains the Same The Song Remains the Same
## 9                The Rain Song The Song Remains the Same
## 10                   The Ocean The Song Remains the Same
## 11          Dazed and Confused The Song Remains the Same
## 12          Stairway to Heaven The Song Remains the Same
## 13                   Moby Dick The Song Remains the Same
## 14                Heartbreaker The Song Remains the Same
## 15            Whole Lotta Love The Song Remains the Same</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Return songs in definitive that are not in complete</span>
definitive <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">anti_join</span>(complete, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;song&quot;</span>, <span class="st">&quot;album&quot;</span>))</code></pre></div>
<pre><code>##                           song                     album
## 1                Rock and Roll The Song Remains the Same
## 2              Celebration Day The Song Remains the Same
## 3                    Black Dog The Song Remains the Same
## 4  Over the Hills and Far Away The Song Remains the Same
## 5           Misty Mountain Hop The Song Remains the Same
## 6   Since I&#39;ve Been Loving You The Song Remains the Same
## 7                   No Quarter The Song Remains the Same
## 8    The Song Remains the Same The Song Remains the Same
## 9                The Rain Song The Song Remains the Same
## 10                   The Ocean The Song Remains the Same
## 11          Dazed and Confused The Song Remains the Same
## 12          Stairway to Heaven The Song Remains the Same
## 13                   Moby Dick The Song Remains the Same
## 14                Heartbreaker The Song Remains the Same
## 15            Whole Lotta Love The Song Remains the Same</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Return songs in complete that are not in definitive</span>
complete <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">anti_join</span>(definitive, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;song&quot;</span>, <span class="st">&quot;album&quot;</span>))</code></pre></div>
<pre><code>## [1] song  album
## &lt;0 rows&gt; (or 0-length row.names)</code></pre>
<p>It appears that The Definitive Collection contains songs from the soundtrack of The Song Remains the Same, a movie filmed during a live Led Zeppelin concert. Is this the only difference between The Definitive Collection and The Complete Studio Recordings?</p>
<ul>
<li><strong>Remember</strong>: base R’s identical is will only return true if the datasets have the exact same rows in the <em>exact</em> same order.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Import file sounddtrack</span>
soundtrack &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;C:/Users/DEsktop/Nextcloud/Documents/2017/RData/soundtrack.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

<span class="co"># Check if same order: definitive and union of complete and soundtrack</span>
complete <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">union</span>(soundtrack) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">identical</span>(definitive)</code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Check if any order: definitive and union of complete and soundtrack</span>
complete <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">union</span>(soundtrack) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setequal</span>(definitive)</code></pre></div>
<pre><code>## TRUE</code></pre>
</div>
<div id="bind-in-dplyr" class="section level2">
<h2><span class="header-section-number">3.4</span> Bind in Dplyr</h2>
<p>Whilst base R has rbrind and cbind, dplyr has bind_rows and bind_cols as equivalents. Bind_rows adds the second dataset underneath the first, bind_cols assumes the datasets are in the exact same order and can be thought of as a ‘lazy join’.</p>
<p>The benefits of dplyr binds are:</p>
<ul>
<li>Faster</li>
<li>Return a tibble</li>
<li>Can handle lists of data frames</li>
<li>.id</li>
</ul>
<p>The last one (.id) will return a name to indicate which source the data in the new data frame (tibble) the data came from, particularly useful for things like ggplot and keeping track of your data overall.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Examine side_one and side_two</span>
side_one
side_two

<span class="co"># Bind side_one and side_two into a single dataset</span>
side_one <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">bind_rows</span>(side_two)</code></pre></div>
<p>discography and jimi contain all of the information you need to create an anthology dataset for the band The Jimi Hendrix Experience.</p>
<p>discography contains a data frame of each album by The Jimi Hendrix Experience and the year of the album.</p>
<p>jimi contains a list of data frames of album tracks, one for each album released by The Jimi Hendrix Experience. You can pass bind_rows() a list of data frames like jimi to bind together into a single data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Examine discography and jimi</span>
discography
jimi

jimi <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Bind jimi into a single data frame</span>
<span class="st">  </span><span class="kw">bind_rows</span>(<span class="dt">.id =</span> <span class="st">&quot;album&quot;</span>)  <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Make a complete data frame</span>
<span class="st">  </span><span class="kw">left_join</span>(discography)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Import file sounddtrack</span>
hank_years &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;C:/Users/DEsktop/Nextcloud/Documents/2017/RData/hank_years.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
hank_charts &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;C:/Users/DEsktop/Nextcloud/Documents/2017/RData/hank_charts.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

<span class="co"># Examine hank_years and hank_charts</span>
hank_years</code></pre></div>
<pre><code>##    year                                            song
## 1  1947                                 Move It On Over
## 2  1947            My Love for You (Has Turned to Hate)
## 3  1947         Never Again (Will I Knock on Your Door)
## 4  1947            On the Banks of the Old Ponchartrain
## 5  1947                                    Pan American
## 6  1947                     Wealth Won&#39;t Save Your Soul
## 7  1948                           A Mansion on the Hill
## 8  1948                                   Honky Tonkin&#39;
## 9  1948                                 I Saw the Light
## 10 1948                           I&#39;m a Long Gone Daddy
## 11 1948                      My Sweet Love Ain&#39;t Around
## 12 1949                     I&#39;m So Lonesome I Could Cry
## 13 1949                                    Lost Highway
## 14 1949                                  Lovesick Blues
## 15 1949                          Mind Your Own Business
## 16 1949                    My Bucket&#39;s Got a Hole in It
## 17 1949         Never Again (Will I Knock on Your Door)
## 18 1949                                   Wedding Bells
## 19 1949        You&#39;re Gonna Change (Or I&#39;m Gonna Leave)
## 20 1950           I Just Don&#39;t Like This Kind of Living
## 21 1950                        Long Gone Lonesome Blues
## 22 1950                               Moanin&#39; the Blues
## 23 1950                  My Son Calls Another Man Daddy
## 24 1950                        Nobody&#39;s Lonesome for Me
## 25 1950             They&#39;ll Never Take Her Love from Me
## 26 1950                           Why Don&#39;t You Love Me
## 27 1950                       Why Should We Try Anymore
## 28 1951                 (I Heard That) Lonesome Whistle
## 29 1951                      Baby, We&#39;re Really in Love
## 30 1951                                Cold, Cold Heart
## 31 1951                                     Crazy Heart
## 32 1951                                       Dear John
## 33 1951                                Hey Good Lookin&#39;
## 34 1951                             Howlin&#39; At the Moon
## 35 1951 I Can&#39;t Help It (If I&#39;m Still in Love With You)
## 36 1952                                    Half as Much
## 37 1952                                Honky Tonk Blues
## 38 1952          I&#39;ll Never Get Out of This World Alive
## 39 1952                        Jambalaya (On the Bayou)
## 40 1952                       Settin&#39; the Woods on Fire
## 41 1952                                   You Win Again
## 42 1953                                     Calling You
## 43 1953                         I Won&#39;t Be Home No More
## 44 1953                                        Kaw-Liga
## 45 1953                 Take These Chains from My Heart
## 46 1953                        Weary Blues from Waitin&#39;
## 47 1953                             Your Cheatin&#39; Heart
## 48 1954                    (I&#39;m Gonna) Sing, Sing, Sing
## 49 1954                      How Can You Refuse Him Now
## 50 1954                          I&#39;m Satisfied with You
## 51 1954                 You Better Keep It on Your Mind
## 52 1955                            A Teardrop on a Rose
## 53 1955                       At the First Fall of Snow
## 54 1955                                  Mother Is Gone
## 55 1955                    Please Don&#39;t Let Me Love You
## 56 1955                                       Thank God
## 57 1956                                A Home in Heaven
## 58 1956                               California Zephyr
## 59 1956                               Singing Waterfall
## 60 1956       There&#39;s No Room in My Heart for the Blues
## 61 1957                   Leave Me Alone with the Blues
## 62 1957                                Ready to Go Home
## 63 1957                           The Waltz of the Wind
## 64 1958                                    Just Waitin&#39;
## 65 1965                    The Pale Horse and His Rider
## 66 1966                                        Kaw-Liga
## 67 1989                       There&#39;s a Tear in My Beer</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hank_charts</code></pre></div>
<pre><code>##                                               song peak
## 1                  (I Heard That) Lonesome Whistle    9
## 2                     (I&#39;m Gonna) Sing, Sing, Sing   NA
## 3                                 A Home in Heaven   NA
## 4                            A Mansion on the Hill   12
## 5                             A Teardrop on a Rose   NA
## 6                        At the First Fall of Snow   NA
## 7                       Baby, We&#39;re Really in Love    4
## 8                                California Zephyr   NA
## 9                                      Calling You   NA
## 10                                Cold, Cold Heart    1
## 11                                     Crazy Heart    4
## 12                                       Dear John    8
## 13                                    Half as Much    2
## 14                                Hey Good Lookin&#39;    1
## 15                                Honky Tonk Blues    2
## 16                                   Honky Tonkin&#39;   14
## 17                      How Can You Refuse Him Now   NA
## 18                             Howlin&#39; At the Moon    3
## 19 I Can&#39;t Help It (If I&#39;m Still in Love With You)    2
## 20           I Just Don&#39;t Like This Kind of Living    5
## 21                                 I Saw the Light   NA
## 22                         I Won&#39;t Be Home No More    4
## 23          I&#39;ll Never Get Out of This World Alive    1
## 24                           I&#39;m a Long Gone Daddy    6
## 25                          I&#39;m Satisfied with You   NA
## 26                     I&#39;m So Lonesome I Could Cry    2
## 27                        Jambalaya (On the Bayou)    1
## 28                                    Just Waitin&#39;   NA
## 29                                        Kaw-Liga    1
## 30                                        Kaw-Liga   NA
## 31                   Leave Me Alone with the Blues   NA
## 32                        Long Gone Lonesome Blues    1
## 33                                    Lost Highway   12
## 34                                  Lovesick Blues    1
## 35                          Mind Your Own Business    5
## 36                               Moanin&#39; the Blues    1
## 37                                  Mother Is Gone   NA
## 38                                 Move It On Over    4
## 39                    My Bucket&#39;s Got a Hole in It    2
## 40            My Love for You (Has Turned to Hate)   NA
## 41                  My Son Calls Another Man Daddy    9
## 42                      My Sweet Love Ain&#39;t Around   NA
## 43         Never Again (Will I Knock on Your Door)   NA
## 44         Never Again (Will I Knock on Your Door)    6
## 45                        Nobody&#39;s Lonesome for Me    9
## 46            On the Banks of the Old Ponchartrain   NA
## 47                                    Pan American   NA
## 48                    Please Don&#39;t Let Me Love You    9
## 49                                Ready to Go Home   NA
## 50                       Settin&#39; the Woods on Fire    2
## 51                               Singing Waterfall   NA
## 52                 Take These Chains from My Heart    1
## 53                                       Thank God   NA
## 54                    The Pale Horse and His Rider   NA
## 55                           The Waltz of the Wind   NA
## 56                       There&#39;s a Tear in My Beer    7
## 57       There&#39;s No Room in My Heart for the Blues   NA
## 58             They&#39;ll Never Take Her Love from Me    5
## 59                     Wealth Won&#39;t Save Your Soul   NA
## 60                        Weary Blues from Waitin&#39;    7
## 61                                   Wedding Bells    2
## 62                           Why Don&#39;t You Love Me    1
## 63                       Why Should We Try Anymore    9
## 64                 You Better Keep It on Your Mind   NA
## 65                                   You Win Again   10
## 66        You&#39;re Gonna Change (Or I&#39;m Gonna Leave)    4
## 67                             Your Cheatin&#39; Heart    1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hank_years <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Reorder hank_years alphabetically by song title</span>
<span class="st">  </span><span class="kw">arrange</span>(song) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Select just the year column</span>
<span class="st">  </span><span class="kw">select</span>(year) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Bind the year column</span>
<span class="st">  </span><span class="kw">bind_cols</span>(hank_charts) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Arrange the finished dataset</span>
<span class="st">  </span><span class="kw">arrange</span>(year, song)</code></pre></div>
<pre><code>##    year                                            song peak
## 1  1947                                 Move It On Over    4
## 2  1947            My Love for You (Has Turned to Hate)   NA
## 3  1947         Never Again (Will I Knock on Your Door)   NA
## 4  1947            On the Banks of the Old Ponchartrain   NA
## 5  1947                                    Pan American   NA
## 6  1947                     Wealth Won&#39;t Save Your Soul   NA
## 7  1948                           A Mansion on the Hill   12
## 8  1948                                   Honky Tonkin&#39;   14
## 9  1948                          I&#39;m Satisfied with You   NA
## 10 1948           I Just Don&#39;t Like This Kind of Living    5
## 11 1948                      My Sweet Love Ain&#39;t Around   NA
## 12 1949                         I Won&#39;t Be Home No More    4
## 13 1949                                    Lost Highway   12
## 14 1949                                  Lovesick Blues    1
## 15 1949                          Mind Your Own Business    5
## 16 1949                    My Bucket&#39;s Got a Hole in It    2
## 17 1949         Never Again (Will I Knock on Your Door)    6
## 18 1949                                   Wedding Bells    2
## 19 1949                 You Better Keep It on Your Mind   NA
## 20 1950                           I&#39;m a Long Gone Daddy    6
## 21 1950                        Long Gone Lonesome Blues    1
## 22 1950                               Moanin&#39; the Blues    1
## 23 1950                  My Son Calls Another Man Daddy    9
## 24 1950                        Nobody&#39;s Lonesome for Me    9
## 25 1950             They&#39;ll Never Take Her Love from Me    5
## 26 1950                           Why Don&#39;t You Love Me    1
## 27 1950                       Why Should We Try Anymore    9
## 28 1951                    (I&#39;m Gonna) Sing, Sing, Sing   NA
## 29 1951                      Baby, We&#39;re Really in Love    4
## 30 1951                                Cold, Cold Heart    1
## 31 1951                                     Crazy Heart    4
## 32 1951                                       Dear John    8
## 33 1951                                Hey Good Lookin&#39;    1
## 34 1951                             Howlin&#39; At the Moon    3
## 35 1951          I&#39;ll Never Get Out of This World Alive    1
## 36 1952                                    Half as Much    2
## 37 1952                                Honky Tonk Blues    2
## 38 1952 I Can&#39;t Help It (If I&#39;m Still in Love With You)    2
## 39 1952                        Jambalaya (On the Bayou)    1
## 40 1952                       Settin&#39; the Woods on Fire    2
## 41 1952        You&#39;re Gonna Change (Or I&#39;m Gonna Leave)    4
## 42 1953                                     Calling You   NA
## 43 1953                     I&#39;m So Lonesome I Could Cry    2
## 44 1953                                        Kaw-Liga    1
## 45 1953                 Take These Chains from My Heart    1
## 46 1953                        Weary Blues from Waitin&#39;    7
## 47 1953                             Your Cheatin&#39; Heart    1
## 48 1954                 (I Heard That) Lonesome Whistle    9
## 49 1954                      How Can You Refuse Him Now   NA
## 50 1954                                 I Saw the Light   NA
## 51 1954                                   You Win Again   10
## 52 1955                            A Teardrop on a Rose   NA
## 53 1955                       At the First Fall of Snow   NA
## 54 1955                                  Mother Is Gone   NA
## 55 1955                    Please Don&#39;t Let Me Love You    9
## 56 1955                                       Thank God   NA
## 57 1956                                A Home in Heaven   NA
## 58 1956                               California Zephyr   NA
## 59 1956                               Singing Waterfall   NA
## 60 1956       There&#39;s No Room in My Heart for the Blues   NA
## 61 1957                   Leave Me Alone with the Blues   NA
## 62 1957                                Ready to Go Home   NA
## 63 1957                           The Waltz of the Wind   NA
## 64 1958                                    Just Waitin&#39;   NA
## 65 1965                    The Pale Horse and His Rider   NA
## 66 1966                                        Kaw-Liga   NA
## 67 1989                       There&#39;s a Tear in My Beer    7</code></pre>
<p>Unfortunately, there is usually no clear way to tell whether or not the rows in two datasets align unless the datasets contain a mutual key. In that scenario, you can use a mutating join to bind the datasets in a foolproof way.</p>
<div id="data-frames" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Data frames</h3>
<p>data.frame() defaults</p>
<ul>
<li>Changes strings to factors</li>
<li>Adds row names</li>
<li>Changes unusual column names</li>
</ul>
<p>However sometimes we do not want this behaviour, so we can use data_frame() from dplyr</p>
<p>data_frame() will not…</p>
<ul>
<li>Change the data type of vectors (e.g. strings to factors)</li>
<li>Add row names</li>
<li>Change column names</li>
<li>Recycle vectors greater than length one</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Make combined data frame using data_frame()</span>
<span class="kw">data_frame</span>(<span class="dt">year =</span> hank_year, <span class="dt">song =</span> hank_song, <span class="dt">peak =</span> hank_peak) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Extract songs where peak equals 1</span>
<span class="st">  </span><span class="kw">filter</span>(peak <span class="op">==</span><span class="st"> &quot;1&quot;</span>)


<span class="co"># Or if the data was a list of vectors</span>

<span class="co"># Convert the hank list into a data frame</span>
<span class="kw">as_data_frame</span>(hank)  <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Extract songs where peak equals 1</span>
<span class="st">  </span><span class="kw">filter</span>(peak <span class="op">==</span><span class="st"> &quot;1&quot;</span>)

<span class="co"># Or if we had nested data tables as a list of vectors</span>

<span class="kw">bind_rows</span>(michael, <span class="dt">.id =</span> <span class="st">&quot;album&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(album) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rank =</span> <span class="kw">min_rank</span>(peak)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(rank <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>rank, <span class="op">-</span>peak)</code></pre></div>
</div>
<div id="data-types" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Data Types</h3>
<p>Usually R will do sensible things when working with data, linke 1 + 1 = 2, but “one” + “one” = error. You should be aware of some of the data types when working in R.</p>
<p>Every piece of data in R is a vector, even if it only has a single value in it. Unless the data is in a list, all elements in the vector are going to be in one of six data types - known as atomic data types. You can use typeof() to identfy what is in a vector.</p>
<table>
<caption><span id="tab:simple-table">Table 3.1: </span> Atomic Data Types in R</caption>
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Output</th>
<th>Atomic data type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">&gt;typeof(TRUE)</td>
<td align="left">[1] “logical”</td>
<td>Logical</td>
</tr>
<tr class="even">
<td align="left">&gt;typeof(“hello”)</td>
<td align="left">[1] “character”</td>
<td>Character (i.e. string)</td>
</tr>
<tr class="odd">
<td align="left">&gt;typeof(3.14)</td>
<td align="left">[1] “double”</td>
<td>Double (i.e. numeric w/ decimal)</td>
</tr>
<tr class="even">
<td align="left">&gt;typeof(1L)</td>
<td align="left">[1] “integer”</td>
<td>Integer (i.e. numeric w/o decimal)</td>
</tr>
<tr class="odd">
<td align="left">&gt;typeof(1 + 2i)</td>
<td align="left">[1] “complex”</td>
<td>Complex</td>
</tr>
<tr class="even">
<td align="left">&gt;typeof(raw(1))</td>
<td align="left">[1] “raw”</td>
<td>Raw</td>
</tr>
</tbody>
</table>
<p>New classes of data, such as factors which are used for categorical variables, are created from one of the six types above giving it a class attributing and other metadata stored as attributes. A factor is a an integer vector with a factor class atribute, a levels attribute and sometimes a level attribute. Whilst they contain a sequence of integers, they are dispalyed as the asssocicated labels.</p>
<p><strong>In R, each column in a data frame must be of a single type or class of data</strong> because each column is stored as a single vector. If mutliple tables or columns are being combined, R uses coercion rules to decide what to do.</p>
<ul>
<li>If any variable being combined has a character, it stores it as a character string</li>
<li>Doubles being combined with Integers or logicals gets stored as a double (T = 1, F = 0)</li>
<li>If integers are being combined with a logical, it gets stored as a integer (T = 1, F = 0)</li>
<li>factors with charecters, the factor lables gets converted to strings (A = “A”, B = “B”)</li>
<li>factors with doubles or integers, the factor gets converted to their numeric values (A = 1, B = 2)</li>
</ul>
<p><strong>Note</strong> pay particular attention to factor data with numeric labels - e.g. if 4, 5 and 6 values have factor levels of 1, 2 and 3, when combining or coercing with or to a numeric, the result will be 4, 5 and 6 rather than the factor lables. To get the lables which are numeric values, convert the factor to a character string then convert those to a double or integer e.g. as.numeric(as.character(x)).</p>
<p>Dplyr won’t try and coerce different data but will throw an error and let you manually determine what you want to do with the data. If combining factors, dplyr will convert them to charecters then give a warning message.</p>
<p>For example, sixties contains the top selling albums in the US in the 1960s. It stores year as a numeric (double). When you combine it with seventies, which stores year as a factor, bind_rows() returns an error.</p>
<p>You can fix this by coercing seventies$year to a numeric. But if you seventies %&gt;% mutate(year = as.numeric(year)) will not return the correct year. We need to convert the factor to a string.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">seventies <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Coerce seventies$year into a useful numeric</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">as.numeric</span>(<span class="kw">as.character</span>(year))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Bind the updated version of seventies to sixties</span>
<span class="st">  </span><span class="kw">bind_rows</span>(sixties) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(year)</code></pre></div>
</div>
</div>
<div id="advanced-joining" class="section level2">
<h2><span class="header-section-number">3.5</span> Advanced Joining</h2>
<p>Sometimes joins can fail for one of two principle reasons - missing keys or duplicate keys. These can be either related to the values or the columns.</p>
<p>One common problem can be that column names are missing and that the rows are called by their actual value. R’s data frames can store important information in the row.names attribute. This is not a tidy way to store data, but it does happen quite commonly. If the primary key of your dataset is stored in row.names, you will have trouble joining it to other datasets.</p>
<p>For example, stage_songs contains information about songs that appear in musicals. However, it stores the primary key (song name) in the row.names attribute. As a result, you cannot access the key with a join function.</p>
<p>One way to remedy this problem is to use the function rownames_to_column() from the tibble package. rownames_to_column() returns a copy of a dataset with the row names added to the data as a column.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Import the data</span>
stage_songs &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;C:/Users/DEsktop/Nextcloud/Documents/2017/RData/stage_songs.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
stage_writers &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;C:/Users/DEsktop/Nextcloud/Documents/2017/RData/stage_writers.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

<span class="co"># And view</span>
stage_songs</code></pre></div>
<pre><code>##                        X              musical year
## 1   Children Will Listen       Into the Woods 1986
## 2                  Maria      West Side Story 1957
## 3                 Memory                 Cats 1981
## 4 The Music of the Night Phantom of the Opera 1986</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stage_writers</code></pre></div>
<pre><code>##                     song            composer
## 1   Children Will Listen    Stephen Sondheim
## 2                  Maria   Leonard Bernstein
## 3                 Memory Andrew Lloyd Webber
## 4 The Music of the Night Andrew Lloyd Webber</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load the tibble package</span>
<span class="kw">library</span>(tibble)

stage_songs <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Add row names as a column named song</span>
<span class="st">  </span><span class="kw">rownames_to_column</span>(<span class="dt">var =</span> <span class="st">&quot;song&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Left join stage_writers to stage_songs</span>
<span class="st">  </span><span class="kw">left_join</span>(stage_writers)</code></pre></div>
<pre><code>## Joining, by = &quot;song&quot;</code></pre>
<pre><code>##   song                      X              musical year composer
## 1    1   Children Will Listen       Into the Woods 1986     &lt;NA&gt;
## 2    2                  Maria      West Side Story 1957     &lt;NA&gt;
## 3    3                 Memory                 Cats 1981     &lt;NA&gt;
## 4    4 The Music of the Night Phantom of the Opera 1986     &lt;NA&gt;</code></pre>
<p>If there are duplicate rows in the primary table, there will be duplicate joins to the second table, resulting in a mutiple of new rows. Equally, if there are multiple rows in the secondary table there will be duplicate entries. This can be made worse if there are what appear to be duplicate key values in both sets of tables resulting in n^2 rows.</p>
<p>In the case of missing data, it is best to remove the data with a filter first, before joining.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Remove NA&#39;s from key before joining</span>
two_songs <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(movie)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">inner_join</span>(singers, <span class="dt">by =</span> <span class="st">&quot;movie&quot;</span>)</code></pre></div>
<p>It is not always needed to add the by = argument when joining, dplyr when compare both tables looking for a common field. However, where the column names differ (but have the same contents) when can explicitly state the columns to join by. Equally, sometimes you may have to specify the by = argument when column names are the same, but contain different data, so you specify which column to actually join on.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Import the data</span>
movie_studios &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;C:/Users/DEsktop/Nextcloud/Documents/2017/RData/movie_studios.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
movie_years &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;C:/Users/DEsktop/Nextcloud/Documents/2017/RData/movie_years.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

<span class="co"># View the data</span>
movie_studios</code></pre></div>
<pre><code>##                      movie                  name
## 1      The Road to Morocco    Paramount Pictures
## 2             Going My Way    Paramount Pictures
## 3           Anchors Aweigh   Metro-Goldwyn-Mayer
## 4  Till the Clouds Roll By   Metro-Goldwyn-Mayer
## 5          White Christmas    Paramount Pictures
## 6          The Tender Trap   Metro-Goldwyn-Mayer
## 7             High Society   Metro-Goldwyn-Mayer
## 8        The Joker is Wild    Paramount Pictures
## 9                 Pal Joey     Columbia Pictures
## 10                 Can-Can Twentieth-Century Fox</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">movie_years</code></pre></div>
<pre><code>##                      movie          name year
## 1      The Road to Morocco   Bing Crosby 1942
## 2             Going My Way   Bing Crosby 1944
## 3           Anchors Aweigh Frank Sinatra 1945
## 4  Till the Clouds Roll By Frank Sinatra 1946
## 5          White Christmas   Bing Crosby 1954
## 6          The Tender Trap Frank Sinatra 1955
## 7             High Society   Bing Crosby 1956
## 8        The Joker is Wild Frank Sinatra 1957
## 9                 Pal Joey Frank Sinatra 1957
## 10                 Can-Can Frank Sinatra 1960</code></pre>
<p>In this instance, name refers to the studio and the name of the actor in each data table. By default, dplyr will ignore duplicate column names if you set the by argument and do not include the duplicated name in the argument. When you do this, dplyr will treat the columns in the normal fashion, but it will add .x and .y to the duplicated names to help you tell the columns apart. We can use rename(data, new_name = old_name) renames old_name to new_name in data to something else if desired.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">movie_years <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Left join movie_studios to movie_years</span>
<span class="st">  </span><span class="kw">left_join</span>(movie_studios, <span class="dt">by =</span> <span class="st">&quot;movie&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Rename the columns: artist and studio</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">artist =</span> name.x, <span class="dt">studio =</span> name.y)</code></pre></div>
<pre><code>##                      movie        artist year                studio
## 1      The Road to Morocco   Bing Crosby 1942    Paramount Pictures
## 2             Going My Way   Bing Crosby 1944    Paramount Pictures
## 3           Anchors Aweigh Frank Sinatra 1945   Metro-Goldwyn-Mayer
## 4  Till the Clouds Roll By Frank Sinatra 1946   Metro-Goldwyn-Mayer
## 5          White Christmas   Bing Crosby 1954    Paramount Pictures
## 6          The Tender Trap Frank Sinatra 1955   Metro-Goldwyn-Mayer
## 7             High Society   Bing Crosby 1956   Metro-Goldwyn-Mayer
## 8        The Joker is Wild Frank Sinatra 1957    Paramount Pictures
## 9                 Pal Joey Frank Sinatra 1957     Columbia Pictures
## 10                 Can-Can Frank Sinatra 1960 Twentieth-Century Fox</code></pre>
<p>In the next example, name refers to different objects. To make the join, set by to a named vector. The names of the vector will refer to column names in the primary dataset (x). The values of the vector will correspond to the column names in the secondary dataset (y), e.g.</p>
<blockquote>
<p>x %&gt;% left_join(y, by = c(“x.name1” = “y.name2”))</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Import the data</span>
elvis_songs &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;C:/Users/DEsktop/Nextcloud/Documents/2017/RData/elvis_songs.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
elvis_movies &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;C:/Users/DEsktop/Nextcloud/Documents/2017/RData/elvis_movies.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

<span class="co"># And view</span>
elvis_songs</code></pre></div>
<pre><code>##                                   name          movie
## 1 (You&#39;re So Square) Baby I Don&#39;t Care Jailhouse Rock
## 2         I Can&#39;t Help Falling in Love    Blue Hawaii
## 3                       Jailhouse Rock Jailhouse Rock
## 4                       Viva Las Vegas Viva Las Vegas
## 5                    You Don&#39;t Know Me       Clambake</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">elvis_movies</code></pre></div>
<pre><code>##             name year
## 1 Jailhouse Rock 1957
## 2    Blue Hawaii 1961
## 3 Viva Las Vegas 1963
## 4       Clambake 1967</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">elvis_movies <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Left join elvis_songs to elvis_movies by this column</span>
<span class="st">  </span><span class="kw">left_join</span>(elvis_songs, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;name&quot;</span> =<span class="st"> &quot;movie&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Rename columns</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">movie =</span> name, <span class="dt">song =</span> name.y)</code></pre></div>
<pre><code>##            movie year                                 song
## 1 Jailhouse Rock 1957 (You&#39;re So Square) Baby I Don&#39;t Care
## 2 Jailhouse Rock 1957                       Jailhouse Rock
## 3    Blue Hawaii 1961         I Can&#39;t Help Falling in Love
## 4 Viva Las Vegas 1963                       Viva Las Vegas
## 5       Clambake 1967                    You Don&#39;t Know Me</code></pre>
<p>In the following example, the two datasets in question have the same key variable, however the has a different column name that connects the datasets. We also rename one of the columns within the select statement to aid understanding in the dplyr pipeline.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Import the data</span>
movie_directors &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;C:/Users/DEsktop/Nextcloud/Documents/2017/RData/movie_directors.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

<span class="co"># Identify the key columns</span>
movie_directors</code></pre></div>
<pre><code>##                       name        director                studio
## 1           Anchors Aweigh   George Sidney   Metro-Goldwyn-Mayer
## 2                  Can-Can     Walter Lang Twentieth-Century Fox
## 3             Going My Way     Leo McCarey    Paramount Pictures
## 4             High Society Charles Walters   Metro-Goldwyn-Mayer
## 5                 Pal Joey   George Sidney     Columbia Pictures
## 6        The Joker is Wild   Charles Vidor    Paramount Pictures
## 7      The Road to Morocco    David Butler    Paramount Pictures
## 8          The Tender Trap Charles Walters   Metro-Goldwyn-Mayer
## 9  Till the Clouds Roll By   Richard Whorf   Metro-Goldwyn-Mayer
## 10         White Christmas  Michael Curtiz    Paramount Pictures</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">movie_years</code></pre></div>
<pre><code>##                      movie          name year
## 1      The Road to Morocco   Bing Crosby 1942
## 2             Going My Way   Bing Crosby 1944
## 3           Anchors Aweigh Frank Sinatra 1945
## 4  Till the Clouds Roll By Frank Sinatra 1946
## 5          White Christmas   Bing Crosby 1954
## 6          The Tender Trap Frank Sinatra 1955
## 7             High Society   Bing Crosby 1956
## 8        The Joker is Wild Frank Sinatra 1957
## 9                 Pal Joey Frank Sinatra 1957
## 10                 Can-Can Frank Sinatra 1960</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">movie_years <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Left join movie_directors to movie_years</span>
<span class="st">  </span><span class="kw">left_join</span>(movie_directors, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;movie&quot;</span> =<span class="st"> &quot;name&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Arrange the columns using select()</span>
<span class="st">  </span><span class="kw">select</span>(year, movie, <span class="dt">artist =</span> name, director, studio)</code></pre></div>
<pre><code>##    year                   movie        artist        director
## 1  1942     The Road to Morocco   Bing Crosby    David Butler
## 2  1944            Going My Way   Bing Crosby     Leo McCarey
## 3  1945          Anchors Aweigh Frank Sinatra   George Sidney
## 4  1946 Till the Clouds Roll By Frank Sinatra   Richard Whorf
## 5  1954         White Christmas   Bing Crosby  Michael Curtiz
## 6  1955         The Tender Trap Frank Sinatra Charles Walters
## 7  1956            High Society   Bing Crosby Charles Walters
## 8  1957       The Joker is Wild Frank Sinatra   Charles Vidor
## 9  1957                Pal Joey Frank Sinatra   George Sidney
## 10 1960                 Can-Can Frank Sinatra     Walter Lang
##                   studio
## 1     Paramount Pictures
## 2     Paramount Pictures
## 3    Metro-Goldwyn-Mayer
## 4    Metro-Goldwyn-Mayer
## 5     Paramount Pictures
## 6    Metro-Goldwyn-Mayer
## 7    Metro-Goldwyn-Mayer
## 8     Paramount Pictures
## 9      Columbia Pictures
## 10 Twentieth-Century Fox</code></pre>
</div>
<div id="joining-mutiple-tables" class="section level2">
<h2><span class="header-section-number">3.6</span> Joining mutiple tables</h2>
<p>Whilst it would be possible to join multiple tables iteratively, for instance</p>
<blockquote>
<p>df1 %&gt;% left_join(df2) %&gt;% left_join(df3) %&gt;% left_join(df4)</p>
</blockquote>
<p>We can use the purrr package instead. We list the dataframes as a vector first, then pass the vector as the first argument to the reduce() function, the second argument should be the dplyr function (e.g. left_join without brackets), the third argument should be the by = var to specify what to join on.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load the purrr library</span>
<span class="kw">library</span>(purrr)

<span class="co"># Place supergroups, more_bands, and more_artists into a list</span>
<span class="kw">list</span>(supergroups, more_bands, more_artists) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Use reduce to join together the contents of the list</span>
<span class="st">  </span><span class="kw">reduce</span>(left_join, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;first&quot;</span>, <span class="st">&quot;last&quot;</span>))

<span class="co"># Or to list just those appear in all three tables</span>
<span class="kw">list</span>(more_artists, more_bands, supergroups) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Return rows of more_artists in all three datasets</span>
<span class="st">  </span><span class="kw">reduce</span>(semi_join, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;first&quot;</span>, <span class="st">&quot;last&quot;</span>))</code></pre></div>
</div>
<div id="other-implentations" class="section level2">
<h2><span class="header-section-number">3.7</span> Other implentations</h2>
<p>Dplyr join functions are similar to SQL statements, as shown below.</p>
<div class="figure">
<img src="images/DplyrSQL.png" alt="Joins available in Dplyr"  />
<p class="caption">
(#fig:SQL functions Dplyr)Joins available in Dplyr
</p>
</div>
<p>With dplyr it is possible to create a connection to a database using the DBI package:</p>
<ul>
<li><strong>src_sqlite()</strong>: for SQLite datbases</li>
<li><strong>src_mysql</strong>: mySQL and MariaDB</li>
<li><strong>src_postgres</strong>: PostgreSQL</li>
</ul>
</div>
<div id="case-study---lahman-db" class="section level2">
<h2><span class="header-section-number">3.8</span> Case Study - Lahman DB</h2>
<p>In this seciton we will use the Sean Lahman baseball statistics data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load names and the package</span>
lahmanNames &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;C:/Users/DEsktop/Nextcloud/Documents/2017/RData/lahmanNames.rds&quot;</span>)
<span class="kw">library</span>(purrr)
<span class="kw">library</span>(Lahman)

<span class="co"># Find variables in common</span>
<span class="kw">reduce</span>(lahmanNames, intersect)</code></pre></div>
<pre><code>## # A tibble: 0 x 1
## # ... with 1 variables: var &lt;chr&gt;</code></pre>
<p>There are no common (intersecting) variables across the datasets. But perhaps some variables are in more than one table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lahmanNames <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">  </span><span class="co"># Bind the data frames in lahmanNames</span>
<span class="st">  </span><span class="kw">bind_rows</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># Group the result by var</span>
<span class="st">  </span><span class="kw">group_by</span>(var) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># Tally the number of appearances</span>
<span class="st">  </span><span class="kw">tally</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># Filter the data</span>
<span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Arrange the results</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n))</code></pre></div>
<pre><code>## # A tibble: 59 x 2
##         var     n
##       &lt;chr&gt; &lt;int&gt;
##  1   yearID    21
##  2 playerID    19
##  3     lgID    17
##  4   teamID    13
##  5        G    10
##  6        L     6
##  7        W     6
##  8       BB     5
##  9       CS     5
## 10       GS     5
## # ... with 49 more rows</code></pre>
<p>So PlayerID appears regularly, but in which tables?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lahmanNames <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Bind the data frames</span>
<span class="st">  </span><span class="kw">bind_rows</span>(<span class="dt">.id =</span> <span class="st">&#39;dataframe&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># Filter the results</span>
<span class="st">  </span><span class="kw">filter</span>(var <span class="op">==</span><span class="st"> &quot;playerID&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Extract the dataframe variable</span>
<span class="st">  `</span><span class="dt">$</span><span class="st">`</span>(dataframe)</code></pre></div>
<pre><code>##  [1] &quot;AllstarFull&quot;         &quot;Appearances&quot;         &quot;AwardsManagers&quot;     
##  [4] &quot;AwardsPlayers&quot;       &quot;AwardsShareManagers&quot; &quot;AwardsSharePlayers&quot; 
##  [7] &quot;Batting&quot;             &quot;BattingPost&quot;         &quot;CollegePlaying&quot;     
## [10] &quot;Fielding&quot;            &quot;FieldingOF&quot;          &quot;FieldingPost&quot;       
## [13] &quot;HallOfFame&quot;          &quot;Managers&quot;            &quot;ManagersHalf&quot;       
## [16] &quot;Master&quot;              &quot;Pitching&quot;            &quot;PitchingPost&quot;       
## [19] &quot;Salaries&quot;</code></pre>
<p>Next we can begin to look at the salaries data. First, let’s begin by ensuring that we have salary information for each player in the database, or at least no systematic holes in our coverage. Our new table will be concise and players contains only one row for each distinct player.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">players &lt;-<span class="st"> </span>Master <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Return one row for each distinct player</span>
<span class="st">  </span><span class="kw">distinct</span>(playerID, nameFirst, nameLast)</code></pre></div>
<p>Next, how many missing values do we have?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">players <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Find all players who do not appear in Salaries</span>
<span class="st">  </span><span class="kw">anti_join</span>(Salaries, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># Count them</span>
<span class="st">  </span><span class="kw">count</span>()</code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1 13958</code></pre>
<p>The answer - a lot! Is it possible that these players somehow did not play (and hence did not earn a salary)?</p>
<p>We can check with the Appearances data frame. Appearances contains information about every game played in major league baseball. That is, if a player played a game, it would show up as a row in Appearances.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">players <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">anti_join</span>(Salaries, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># How many unsalaried players appear in Appearances?</span>
<span class="st">  </span><span class="kw">semi_join</span>(Appearances, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>()</code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1 13765</code></pre>
<p>So a large number of players played a game but are missing salary information. Interestingly, 193 players neither played a game nor have a recorded salary. Perhaps the unsalaried players only played one or two games, and hence did not earn a full salary.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">players <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Find all players who do not appear in Salaries</span>
<span class="st">  </span><span class="kw">anti_join</span>(Salaries, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Join them to Appearances</span>
<span class="st">  </span><span class="kw">left_join</span>(Appearances, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Calculate total_games for each player</span>
<span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_games =</span> <span class="kw">sum</span>(G_all, <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># Arrange in descending order by total_games</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(total_games))</code></pre></div>
<pre><code>## # A tibble: 13,958 x 2
##     playerID total_games
##        &lt;chr&gt;       &lt;int&gt;
##  1 yastrca01        3308
##  2 aaronha01        3298
##  3  cobbty01        3034
##  4 musiast01        3026
##  5  mayswi01        2992
##  6 robinbr01        2896
##  7 kalinal01        2834
##  8 collied01        2824
##  9 robinfr02        2808
## 10 wagneho01        2795
## # ... with 13,948 more rows</code></pre>
<p>Here we some some players played thousands of games, so the idea that some didn’t play enough games doesn’t seem to hold.</p>
<p>Is it possible that the unsalaried players did not actually play in the games that they appeared in? One way to check would be to determine if the players had an at-bat (i.e. batted) in the games that they appeared in.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">players <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># Find unsalaried players</span>
<span class="st">  </span><span class="kw">anti_join</span>(Salaries, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Join Batting to the unsalaried players</span>
<span class="st">  </span><span class="kw">left_join</span>(Batting, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Group by player</span>
<span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Sum at-bats for each player</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_at_bat =</span> <span class="kw">sum</span>(AB, <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Arrange in descending order</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(total_at_bat))</code></pre></div>
<pre><code>## # A tibble: 13,958 x 2
##     playerID total_at_bat
##        &lt;chr&gt;        &lt;int&gt;
##  1 aaronha01        12364
##  2 yastrca01        11988
##  3  cobbty01        11434
##  4 musiast01        10972
##  5  mayswi01        10881
##  6 robinbr01        10654
##  7 wagneho01        10430
##  8 brocklo01        10332
##  9 ansonca01        10277
## 10 aparilu01        10230
## # ... with 13,948 more rows</code></pre>
<p>The unpaid players definitely participated in the games. The highest number of at bats is Hank Aaron so it looks like we are dealing with missing data here and not unsalaried players.</p>
<p>Next, lets look at the Hall of Fame players</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Find the distinct players that appear in HallOfFame</span>
nominated &lt;-<span class="st"> </span>HallOfFame <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">distinct</span>(playerID)

nominated <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Count the number of players in nominated</span>
<span class="st">  </span><span class="kw">count</span>()</code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1  1260</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nominated_full &lt;-<span class="st"> </span>nominated <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Join to Master</span>
<span class="st">  </span><span class="kw">left_join</span>(Master, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Return playerID, nameFirst, nameLast</span>
<span class="st">  </span><span class="kw">select</span>(playerID, nameFirst, nameLast)</code></pre></div>
<p>Next, let’s find out how many of those nominated are now inducted in to the HoF</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Find distinct players in HallOfFame with inducted == &quot;Y&quot;</span>
inducted &lt;-<span class="st"> </span>HallOfFame <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(inducted <span class="op">==</span><span class="st"> &quot;Y&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">distinct</span>(playerID)

inducted <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Count the number of players in inducted</span>
<span class="st">  </span><span class="kw">count</span>()</code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1   317</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">inducted_full &lt;-<span class="st"> </span>inducted <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Join to Master</span>
<span class="st">  </span><span class="kw">left_join</span>(Master, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Return playerID, nameFirst, nameLast</span>
<span class="st">  </span><span class="kw">select</span>(playerID, nameFirst, nameLast)</code></pre></div>
<p>Now that we know who was inducted and who was nominated, let’s examine what separates the nominees who were inducted from the nominees who were not. Let’s start with a simple question: Did nominees who were inducted get more awards than nominees who were not inducted?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Tally the number of awards in AwardsPlayers by playerID</span>
nAwards &lt;-<span class="st"> </span>AwardsPlayers <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">tally</span>()

nAwards <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Filter to just the players in inducted </span>
<span class="st">  </span><span class="kw">semi_join</span>(inducted, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Calculate the mean number of awards per player</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">avg_n =</span> <span class="kw">mean</span>(n, <span class="dt">na.rm =</span> T))</code></pre></div>
<pre><code>## # A tibble: 1 x 1
##      avg_n
##      &lt;dbl&gt;
## 1 12.14583</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nAwards <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Filter to just the players in nominated </span>
<span class="st">  </span><span class="kw">semi_join</span>(nominated, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Filter to players NOT in inducted </span>
<span class="st">  </span><span class="kw">anti_join</span>(inducted, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Calculate the mean number of awards per player</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">avg_n =</span> <span class="kw">mean</span>(n, <span class="dt">na.rm =</span> T))</code></pre></div>
<pre><code>## # A tibble: 1 x 1
##      avg_n
##      &lt;dbl&gt;
## 1 4.231054</code></pre>
<p>The answer is yes - it looks like about 3 times the number. Was the salary much higher for those who were inducted?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Find the players who are in nominated, but not inducted</span>
notInducted &lt;-<span class="st"> </span>nominated <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">   </span><span class="kw">setdiff</span>(inducted)

Salaries <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Find the players who are in notInducted</span>
<span class="st">  </span><span class="kw">semi_join</span>(notInducted, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Calculate the max salary by player</span>
<span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">max_salary =</span> <span class="kw">max</span>(salary, <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Calculate the average of the max salaries</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">avg_salary =</span> <span class="kw">mean</span>(max_salary, <span class="dt">na.rm =</span> T))</code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   avg_salary
##        &lt;dbl&gt;
## 1    5124653</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Repeat for players who were inducted</span>
Salaries <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">semi_join</span>(inducted, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Calculate the max salary by player</span>
<span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">max_salary =</span> <span class="kw">max</span>(salary, <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Calculate the average of the max salaries</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">avg_salary =</span> <span class="kw">mean</span>(max_salary, <span class="dt">na.rm =</span> T))</code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   avg_salary
##        &lt;dbl&gt;
## 1    6092038</code></pre>
<p>So the salaries of the players who were inducted was higher. Were any players nominated 5 years before they retired?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">players &lt;-<span class="st"> </span>Appearances <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Filter Appearances against nominated</span>
<span class="st">  </span><span class="kw">semi_join</span>(nominated, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Find last year played by player</span>
<span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">last_year =</span> <span class="kw">max</span>(yearID, <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Join to full HallOfFame</span>
<span class="st">  </span><span class="kw">left_join</span>(HallOfFame, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Filter for unusual observations</span>
<span class="st">  </span><span class="kw">filter</span>((yearID <span class="op">-</span><span class="st"> </span>last_year) <span class="op">&lt;</span><span class="st"> </span><span class="dv">5</span> ) 

players</code></pre></div>
<pre><code>## # A tibble: 194 x 10
##     playerID last_year yearID votedBy ballots needed votes inducted
##        &lt;chr&gt;     &lt;int&gt;  &lt;int&gt;   &lt;chr&gt;   &lt;int&gt;  &lt;int&gt; &lt;int&gt;   &lt;fctr&gt;
##  1 altroni01      1933   1937   BBWAA     201    151     3        N
##  2 applilu01      1950   1953   BBWAA     264    198     2        N
##  3 bartedi01      1946   1948   BBWAA     121     91     1        N
##  4  beckro01      2004   2008   BBWAA     543    408     2        N
##  5 boudrlo01      1952   1956   BBWAA     193    145     2        N
##  6 camildo01      1945   1948   BBWAA     121     91     1        N
##  7 chandsp01      1947   1950   BBWAA     168    126     2        N
##  8 chandsp01      1947   1951   BBWAA     226    170     1        N
##  9 chapmbe01      1946   1949   BBWAA     153    115     1        N
## 10 cissebi01      1938   1937   BBWAA     201    151     1        N
## # ... with 184 more rows, and 2 more variables: category &lt;fctr&gt;,
## #   needed_note &lt;chr&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">players <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">tally</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># Arrange the results</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n))</code></pre></div>
<pre><code>## # A tibble: 92 x 2
##     playerID     n
##        &lt;chr&gt; &lt;int&gt;
##  1  deandi01     9
##  2 dickebi01     7
##  3  foxxji01     6
##  4 lyonste01     6
##  5 greenha01     5
##  6 ruffire01     5
##  7 cronijo01     4
##  8 dimagjo01     4
##  9 gehrich01     4
## 10  hackst01     4
## # ... with 82 more rows</code></pre>
<p>So we get a list of 194 players who were nominated within 5 years of having last played, with some players being nominated many times. And of those, how many were nominated whilst still playing?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Appearances <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Filter Appearances against nominated</span>
<span class="st">  </span><span class="kw">semi_join</span>(nominated, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Find last year played by player</span>
<span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">last_year =</span> <span class="kw">max</span>(yearID, <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Join to full HallOfFame</span>
<span class="st">  </span><span class="kw">left_join</span>(HallOfFame, <span class="dt">by =</span> <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Filter for unusual observations</span>
<span class="st">  </span><span class="kw">filter</span>(yearID <span class="op">&lt;=</span><span class="st"> </span>last_year) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># look for the most recent incident of nomination before reirement</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(yearID))</code></pre></div>
<pre><code>## # A tibble: 39 x 10
##     playerID last_year yearID votedBy ballots needed votes inducted
##        &lt;chr&gt;     &lt;int&gt;  &lt;int&gt;   &lt;chr&gt;   &lt;int&gt;  &lt;int&gt; &lt;int&gt;   &lt;fctr&gt;
##  1 francju02      2014   2013   BBWAA     569    427     6        N
##  2  rijojo01      2002   2001   BBWAA     515    387     1        N
##  3 stephjo03      2002   1979   BBWAA     432    324     0        N
##  4 minosmi01      1980   1969   BBWAA     340    255     6        N
##  5 spahnwa01      1965   1958   BBWAA     266    200     1        N
##  6 rizzuph01      1956   1956   BBWAA     193    145     1        N
##  7 paigesa01      1965   1951   BBWAA     226    170     1        N
##  8 waltebu01      1950   1950   BBWAA     168    126     4        N
##  9 medwijo01      1948   1948   BBWAA     121     91     1        N
## 10  deandi01      1947   1947   BBWAA     161    121    88        N
## # ... with 29 more rows, and 2 more variables: category &lt;fctr&gt;,
## #   needed_note &lt;chr&gt;</code></pre>
<p>So around 40 players were nominated whilst still plaing</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="references.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cleaning-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["Study-Notes.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
